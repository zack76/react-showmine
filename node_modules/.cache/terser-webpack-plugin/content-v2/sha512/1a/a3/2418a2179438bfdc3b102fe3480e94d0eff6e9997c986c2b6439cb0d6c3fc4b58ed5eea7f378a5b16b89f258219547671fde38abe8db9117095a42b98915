{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{LdrS:function(e,t,a){\"use strict\";var n=a(\"0iUn\"),i=a(\"vYYK\"),l=a(\"yHdQ\"),s=a(\"aZpa\"),c=new function e(){Object(n.default)(this,e),Object(i.a)(this,\"getItemDetail\",function(e){return l.a.get(s.a.webApi+\"item/\"+e)}),Object(i.a)(this,\"getRelatedProducts\",function(e){return l.a.get(s.a.webApi+\"item/company/\"+e)}),Object(i.a)(this,\"getCompanyJieLongList\",function(e,t){return l.a.get(s.a.webApi+\"item/company/\"+e+\"/jielong\",t)}),Object(i.a)(this,\"getCompanyConsultationList\",function(e,t){return l.a.get(s.a.webApi+\"item/company/\"+e+\"/consultation\",t)})};t.a=c},Q9sO:function(e,t,a){\"use strict\";a.r(t);var n=a(\"9Jkg\"),i=a.n(n),l=a(\"0iUn\"),s=a(\"sLSF\"),c=a(\"MI3g\"),o=a(\"a7VT\"),r=a(\"AT/M\"),h=a(\"Tit0\"),m=a(\"vYYK\"),u=a(\"q1tI\"),d=a.n(u),p=(a(\"p94v\"),a(\"1oaW\")),y=a(\"LdrS\"),f=a(\"sO60\"),C=a(\"yHdQ\"),E=a(\"aZpa\"),g=new function e(){Object(l.default)(this,e),Object(m.a)(this,\"getToPay\",function(e){return C.a.post(E.a.webApi+\"payment/paymentUrl\",e)})},v=(a(\"BUDJ\"),a(\"eDds\"),a(\"tXcZ\")),w=a(\"nOHt\"),b=a.n(w),O=function(e){function t(e){var a;return Object(l.default)(this,t),a=Object(c.default)(this,Object(o.default)(t).call(this,e)),Object(m.a)(Object(r.default)(a),\"addJielong\",function(){a.setState({showLoading:!0});for(var e=a.state.itemId,t={comments:a.state.notes,config:i()({}),item_url:\"https://www.showmine66.com/ma/i/\"+a.state.item.id,location:a.state.item.company.pickup_locations[a.state.locationId].id,is_private:a.state.hideAvatar,quantity:[],state_redirect_obj:{url:E.a.webAddress},voucher_base_url:\"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",wechat_auth_url:\"https://www.showmine66.com/a/wu?domain=https%253A%252F%252Fwww.showmine66.com&origurl=https%253A%252F%252Fwww.showmine66.com%252Fma%252Fi%252Fdbfcefa936b4cd6d5709953b5ea12673%2523app-top\"},n=0;n<=a.state.quantityOfChildren.length;n++)null!==a.state.quantityOfChildren[n]&&void 0!==a.state.quantityOfChildren[n]&&t.quantity.push({item_id:a.state.item.children[n].id,quantity:a.state.quantityOfChildren[n],price:a.state.priceOfChildren[n].toString()});a.state.is_update?f.a.updateJielong(t,e).then(function(e){return e.json()}).then(function(e){a.setState({jielong:e}),\"NoPayment\"==a.state.payment_method?a.generateVoucher():a.processPayment()}).catch(function(e){console.error(e)}):f.a.addJielong(t,e).then(function(e){return e.json()}).then(function(e){a.setState({jielong:e}),\"NoPayment\"==a.state.payment_method?a.generateVoucher():a.processPayment()}).catch(function(e){console.error(e)})}),Object(m.a)(Object(r.default)(a),\"processPayment\",function(){var e={source:\"jielong_payment\",item_comment_id:a.state.jielong.id,item_id:a.state.jielong.item_id},t={config:i()(e),item_comment_id:a.state.jielong.id,payment_method:a.state.payment_method,redirectUrl:E.a.webAddress+\"index?itemId=\"+a.state.jielong.item_id};g.getToPay(t).then(function(e){return e.json()}).then(function(e){a.setState({payment:e}),window.open(e.pay_url,\"_self\"),a.setState({showLoading:!1})}).catch(function(e){console.error(e)})}),a.state={jielong:\"none\",payment:\"none\",processPayment:!1,showLocation:!1,ios_show:!1,actions:[{label:\"取消\",onClick:a.hide.bind(Object(r.default)(a))}],quantity:0,itemId:\"\",name:\"\",contact_number:\"\",address:\"\",notes:\"\",hideAvatar:!0,payment_method:null,pickup_location:\"\",quantityOfChildren:[],priceOfChildren:[],totalPrice:0,showLoading:!1,loadingTimer:null,is_update:!1,showVoucher:!1},a.handleChange=a.handleChange.bind(Object(r.default)(a)),a.switch=a.switch.bind(Object(r.default)(a)),a.handlePayment=a.handlePayment.bind(Object(r.default)(a)),a.handleQuantity=a.handleQuantity.bind(Object(r.default)(a)),a}return Object(h.default)(t,e),Object(s.default)(t,[{key:\"placeOrder\",value:function(){this.setState({processPayment:!0})}},{key:\"generateVoucher\",value:function(){var e=this,t=this.state.jielong.id,a={is_update:this.state.is_update,item_url:\"https://www.showmine66.com/ma/i/\"+this.state.item.id,voucher_base_url:\"https://www.showmine66.com/ma/jl/vci/VOUCHERID\"};f.a.generateVoucher(a,t).then(function(e){return e.json()}).then(function(t){e.setState({voucher:t}),e.setState({showLoading:!1,showVoucher:!0})}).catch(function(e){console.error(e)})}},{key:\"handleChange\",value:function(e){this.setState(Object(m.a)({},e.target.name,e.target.value))}},{key:\"handleTotalPrice\",value:function(){this.state.totalPrice=0;for(var e=0;e<=this.state.priceOfChildren.length;e++)this.state.priceOfChildren[e]&&(this.state.totalPrice=this.state.totalPrice+this.state.priceOfChildren[e]);this.setState({totalPrice:this.state.totalPrice})}},{key:\"handleQuantity\",value:function(e){this.state.quantityOfChildren[e.target.name]=Number(e.target.value),this.state.priceOfChildren[e.target.name]=this.state.quantityOfChildren[e.target.name]*this.state.item.children[e.target.name].price,this.setState({quantityOfChildren:this.state.quantityOfChildren,priceOfChildren:this.state.priceOfChildren}),this.handleTotalPrice()}},{key:\"minus\",value:function(e){this.state.quantityOfChildren[e]&&null!==this.state.quantityOfChildren[e]&&void 0!==this.state.quantityOfChildren[e]&&0!==this.state.quantityOfChildren[e]?(this.state.quantityOfChildren[e]=this.state.quantityOfChildren[e]-1,this.state.priceOfChildren[e]=this.state.quantityOfChildren[e]*this.state.item.children[e].price,this.setState({quantityOfChildren:this.state.quantityOfChildren,priceOfChildren:this.state.priceOfChildren}),this.handleTotalPrice()):console.log(\"Cannot minus\")}},{key:\"plus\",value:function(e){this.state.quantityOfChildren[e]&&null!==this.state.quantityOfChildren[e]&&void 0!==this.state.quantityOfChildren[e]||(this.state.quantityOfChildren[e]=0),this.state.quantityOfChildren[e]=this.state.quantityOfChildren[e]+1,this.state.priceOfChildren[e]=this.state.quantityOfChildren[e]*this.state.item.children[e].price,this.setState({quantityOfChildren:this.state.quantityOfChildren,priceOfChildren:this.state.priceOfChildren}),this.handleTotalPrice()}},{key:\"handlePayment\",value:function(e){this.setState({payment_method:e.target.value})}},{key:\"switch\",value:function(){this.setState({hideAvatar:!this.state.hideAvatar})}},{key:\"hide\",value:function(){this.setState({ios_show:!1})}},{key:\"componentDidMount\",value:function(){var e=this,t=this.props.url.query.itemId;this.props.url.query.is_update&&this.setState({is_update:this.props.url.query.is_update}),y.a.getItemDetail(t).then(function(e){return e.json()}).then(function(t){e.setState({item:t,itemId:t.id})}).catch(function(e){console.error(e)})}},{key:\"componentWillUnmount\",value:function(){this.state.loadingTimer&&clearTimeout(this.state.loadingTimer)}},{key:\"render\",value:function(){var e=this,t=null;this.state.item&&(t=this.state.item.company.pickup_locations.map(function(t,a){return d.a.createElement(p.ActionSheet,{key:t.id,menus:[{label:t.title,onClick:function(){e.setState({locationId:a,showLocation:!0}),e.hide()}}],actions:e.state.actions,show:e.state.ios_show,type:\"ios\",onRequestClose:function(t){return e.setState({ios_show:!1})}})}));var a=null;this.state.item&&(a=this.state.item.children.map(function(t,a){return d.a.createElement(\"div\",{key:a},d.a.createElement(\"div\",{className:\"checkout-info\"},t.images[0]?d.a.createElement(\"div\",{className:\"checkout-img\"},d.a.createElement(\"img\",{height:150,width:150,src:t.images[0].url,role:\"presentation\"})):null,d.a.createElement(\"div\",{className:\"checkout-content\"},d.a.createElement(\"div\",{className:\"checkout-subtitle\"},t.title),d.a.createElement(\"div\",{className:\"checkout-price\"},\"$\",t.price),d.a.createElement(\"div\",{className:\"Number-Picker\"},d.a.createElement(\"button\",{style:_.pickerButton,onClick:function(){e.minus(a)}},\" － \"),d.a.createElement(\"input\",{style:_.picker,type:\"number\",min:\"0\",max:\"1000\",name:a,value:e.state.quantityOfChildren[a]?e.state.quantityOfChildren[a]:0,onChange:e.handleQuantity}),d.a.createElement(\"button\",{style:_.pickerButton,onClick:function(){e.plus(a)}},\" ＋ \")))),d.a.createElement(\"div\",{className:\"location-tag\"},t.locations[0].title),d.a.createElement(\"div\",{className:\"divider\"}))}));var n=null;return this.state.item&&(n=this.state.item.children.map(function(t,a){return d.a.createElement(\"div\",{key:t.id},e.state.quantityOfChildren[a]&&0!==e.state.quantityOfChildren[a]?d.a.createElement(\"div\",null,d.a.createElement(\"div\",null,t.title,\" × \",e.state.quantityOfChildren[a]),d.a.createElement(\"div\",null,\"商品总额：$\",e.state.priceOfChildren[a])):null)})),this.state.item?d.a.createElement(\"div\",{className:\"App\"},d.a.createElement(v.a,null,d.a.createElement(\"meta\",{name:\"viewport\",content:\"initial-scale=1.0, width=device-width\"})),d.a.createElement(\"header\",{className:\"App-header\"},d.a.createElement(\"div\",null,\"ShowMine\")),this.state.processPayment?d.a.createElement(\"div\",{className:\"App-body\"},d.a.createElement(p.Gallery,{src:this.state.voucher&&this.state.voucher.url?this.state.voucher.url:void 0,show:this.state.showVoucher},d.a.createElement(\"div\",{style:_.galleryButton,onClick:function(t){e.setState({showVoucher:!1}),b.a.push({pathname:\"/index\",query:e.state.itemId})}},\"Cancel\")),d.a.createElement(\"div\",{className:\"payment-block\"},d.a.createElement(\"div\",{className:\"payment-block-title\"},\"支付金额\",d.a.createElement(\"span\",null,\"总计：$\",this.state.totalPrice)),d.a.createElement(\"div\",{className:\"payment-block-content\"},n,d.a.createElement(\"div\",{style:{fontSize:24}},\"总计:\",d.a.createElement(\"span\",{style:{color:\"red\"}},\" $\",this.state.totalPrice)))),d.a.createElement(\"div\",{className:\"payment-block\"},d.a.createElement(\"div\",{className:\"payment-block-title\"},\"请选择支付方式:\"),d.a.createElement(p.Form,{style:{fontSize:16},radio:!0},this.state.item&&1==this.state.item.online_payment?d.a.createElement(\"div\",null,d.a.createElement(p.FormCell,{radio:!0},d.a.createElement(p.CellHeader,null,d.a.createElement(p.Radio,{name:\"radio1\",value:\"OMIPAY_WECHAT\",onChange:this.handlePayment})),d.a.createElement(p.CellBody,null,\"微信支付\"))):d.a.createElement(p.FormCell,{radio:!0},d.a.createElement(p.CellHeader,null,d.a.createElement(p.Radio,{name:\"radio1\",value:\"NoPayment\",onChange:this.handlePayment})),d.a.createElement(p.CellBody,null,\"到店支付\")),d.a.createElement(p.FormCell,null,\"NoPayment\"==this.state.payment_method?d.a.createElement(p.CellBody,null,\"订单已确认，请到店支付。\"):d.a.createElement(p.CellBody,null,\"使用\",this.state.payment_method,\"完成交易。（提示：请在30分钟内完成支付，否则订单会撤销）\")))),this.state.showLocation?d.a.createElement(\"div\",{className:\"payment-block\"},d.a.createElement(\"div\",{className:\"payment-block-title\"},\"取货地点\"),d.a.createElement(p.Form,{style:{fontSize:16},radio:!0},d.a.createElement(p.FormCell,{radio:!0},d.a.createElement(p.CellHeader,null,d.a.createElement(p.Radio,{name:\"radio2\",defaultChecked:!0})),d.a.createElement(p.CellBody,null,this.state.item.children[0].locations[this.state.locationId].title)))):null,this.state.notes?d.a.createElement(\"div\",{className:\"payment-block\"},d.a.createElement(\"div\",{className:\"payment-block-title\"},\"备注\"),d.a.createElement(\"div\",{className:\"payment-block-content\"},d.a.createElement(\"p\",null,this.state.notes))):null,d.a.createElement(\"div\",{className:\"checkout-button\"},d.a.createElement(p.Button,{type:\"primary\",onClick:function(){e.addJielong()},disabled:!(this.state.payment_method&&this.state.name&&this.state.contact_number&&this.state.address&&this.state.showLocation)},\"确认订单\"),d.a.createElement(p.Toast,{icon:\"loading\",show:this.state.showLoading},\"Loading...\"))):d.a.createElement(\"div\",{className:\"App-body\"},d.a.createElement(\"div\",{className:\"checkout-title\"},this.state.item.title),d.a.createElement(\"div\",null,d.a.createElement(p.CellsTitle,null,\"选择产品\"),a,d.a.createElement(\"div\",{className:\"total-price\"},\"总计：\",d.a.createElement(\"span\",{className:\"price-number\"},\"$\",this.state.totalPrice))),d.a.createElement(\"div\",null,d.a.createElement(p.CellsTitle,null,\"取货地点* \"),d.a.createElement(p.Cells,null,d.a.createElement(p.Cell,{href:\"javascript:;\",access:!0},d.a.createElement(p.CellBody,{onClick:function(t){return e.setState({ios_show:!0})}},\"当前选择:\"),t,d.a.createElement(p.CellFooter,null)),this.state.showLocation?d.a.createElement(\"div\",{className:\"location\"},d.a.createElement(\"div\",{className:\"location-label\"},\"名称：\",this.state.item.company.pickup_locations[this.state.locationId].title),d.a.createElement(\"div\",{className:\"location-label\"},\"位置：\",this.state.item.company.pickup_locations[this.state.locationId].address.street),d.a.createElement(\"div\",{className:\"location-label\"},\"描述：\",this.state.item.company.pickup_locations[this.state.locationId].description)):null),d.a.createElement(p.CellsTitle,null,\"联系方式* \"),d.a.createElement(p.Form,null,d.a.createElement(p.FormCell,null,d.a.createElement(p.CellHeader,null,d.a.createElement(p.Label,null,\"姓名\")),d.a.createElement(p.CellBody,null,d.a.createElement(p.Input,{type:\"text\",placeholder:\"请输入姓名\",name:\"name\",value:this.state.name,onChange:this.handleChange}))),d.a.createElement(p.FormCell,null,d.a.createElement(p.CellHeader,null,d.a.createElement(p.Label,null,\"联系方式\")),d.a.createElement(p.CellBody,null,d.a.createElement(p.Input,{type:\"text\",placeholder:\"请输入手机号\",name:\"contact_number\",value:this.state.contact_number,onChange:this.handleChange}))),d.a.createElement(p.FormCell,null,d.a.createElement(p.CellHeader,null,d.a.createElement(p.Label,null,\"地址\")),d.a.createElement(p.CellBody,null,d.a.createElement(p.Input,{type:\"text\",placeholder:\"请输入地址\",name:\"address\",value:this.state.address,onChange:this.handleChange})))),d.a.createElement(p.CellsTitle,null,\"备注\"),d.a.createElement(p.Form,null,d.a.createElement(p.FormCell,null,d.a.createElement(p.CellBody,null,d.a.createElement(p.TextArea,{placeholder:\"请输入文本\",rows:\"5\",name:\"notes\",value:this.state.notes,onChange:this.handleChange})))),d.a.createElement(p.CellsTitle,null,\"私密参加\"),d.a.createElement(p.Form,null,d.a.createElement(p.FormCell,null,d.a.createElement(p.CellBody,null,d.a.createElement(p.FormCell,{switch:!0},d.a.createElement(p.CellBody,null,\"开启后将隐藏您的头像\"),d.a.createElement(p.CellFooter,null,d.a.createElement(p.Switch,{onClick:this.switch})))))),d.a.createElement(\"div\",{className:\"checkout-button\"},d.a.createElement(p.Button,{type:\"primary\",onClick:function(){e.placeOrder()},disabled:!(0!==this.state.totalPrice&&this.state.name&&this.state.contact_number&&this.state.address&&this.state.showLocation)},\"我要下单\"))))):d.a.createElement(\"div\",{className:\"App\"},d.a.createElement(v.a,null,d.a.createElement(\"meta\",{name:\"viewport\",content:\"initial-scale=1.0, width=device-width\"})),d.a.createElement(\"header\",{className:\"App-header\"},d.a.createElement(\"div\",null,\"ShowMine\")),d.a.createElement(p.LoadMore,{loading:!0}))}}]),t}(u.Component),_={galleryButton:{color:\"white\",fontWeight:\"bold\",padding:\"0\"},picker:{textAlign:\"center\",fontSize:\"18px\",height:\"28px\",width:\"60px\",borderRadius:\"0\",border:\"none\"},pickerButton:{fontSize:\"18px\",backgroundColor:\"#efc929\",border:\"none\",width:\"28px\",height:\"28px\",borderRadius:\"0\"}};t.default=O},cMms:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push([\"/checkoutPage\",function(){var e=a(\"Q9sO\");return{page:e.default||e}}])},sO60:function(e,t,a){\"use strict\";var n=a(\"0iUn\"),i=a(\"vYYK\"),l=a(\"yHdQ\"),s=a(\"aZpa\"),c=new function e(){Object(n.default)(this,e),Object(i.a)(this,\"addJielong\",function(e,t){return l.a.post(s.a.webApi+\"jielong/\"+t+\"/subitems\",e)}),Object(i.a)(this,\"generateVoucher\",function(e,t){return l.a.post(s.a.webApi+\"jielong/voucher/\"+t,e)}),Object(i.a)(this,\"getIsInCurrentJieLong\",function(e){return l.a.get2(s.a.webApi+\"jielong/isInJielong/\"+e)}),Object(i.a)(this,\"cancelJielong\",function(e,t,a){return l.a.delete(s.a.webApi+\"comment/\"+e+\"?item_url=\"+t,a)}),Object(i.a)(this,\"updateJielong\",function(e,t){return l.a.put(s.a.webApi+\"jielong/\"+t+\"/subitems\",e)}),Object(i.a)(this,\"getAllJielong\",function(e){return l.a.get2(s.a.webApi+\"jielong/getAllJielong/\"+e)})};t.a=c}},[[\"cMms\",0,1,2]]]);","extractedComments":[]}