{"ast":null,"code":"import _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _typeof from \"@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport BaseService from './BaseService';\nimport { Config } from '../Config';\nimport jQuery from 'jquery';\nimport md5 from 'md5';\nvar local_storage_key = 'wx';\nvar js_expires_in_seconds = 7000;\n\nvar WeChatService =\n/*#__PURE__*/\nfunction () {\n  function WeChatService() {\n    _classCallCheck(this, WeChatService);\n\n    _defineProperty(this, \"getWeChatJsConf\", function (params) {\n      return BaseService.get(Config.webApi + 'wechat/js/conf', params);\n    });\n  }\n\n  _createClass(WeChatService, [{\n    key: \"initWeChatJsConfig\",\n    value: function initWeChatJsConfig(url, jsConfigs) {\n      if (wx && typeof wx.config === 'function') {\n        wx.config(jsConfigs);\n        this.setCachedJsConfig(url, jsConfigs);\n      }\n    }\n  }, {\n    key: \"getJsCacheKey\",\n    value: function getJsCacheKey(url) {\n      return this.md5Hash(url);\n    }\n  }, {\n    key: \"setJsCache\",\n    value: function setJsCache(url, value) {\n      var cached = localStorage.getItem(local_storage_key);\n      var jsonCached = JSON.parse(cached);\n\n      if (!cached) {\n        cached = {};\n      }\n\n      if (!jsonCached) {\n        jsonCached = {};\n      }\n\n      jsonCached[this.getJsCacheKey(url)] = value;\n      localStorage.setItem(local_storage_key, _JSON$stringify(jsonCached));\n      return this;\n    }\n  }, {\n    key: \"getJsCache\",\n    value: function getJsCache(url) {\n      var cached = localStorage.getItem(local_storage_key);\n      var jsonCached = JSON.parse(cached);\n      return jsonCached ? jsonCached[this.getJsCacheKey(url)] : null;\n    }\n  }, {\n    key: \"getCachedJsConfig\",\n    value: function getCachedJsConfig(url) {\n      var tmp = {};\n      tmp.stored_config = this.getJsCache(url);\n\n      if (_typeof(tmp.stored_config) === 'object' && tmp.stored_config && tmp.stored_config.timestamp !== '') {\n        tmp.now_unix_timestamp = Math.floor(_Date$now() / 1000); // cache expired\n\n        if (tmp.now_unix_timestamp * 1 - tmp.stored_config.timestamp * 1 <= js_expires_in_seconds) {\n          return tmp.stored_config;\n        }\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"setCachedJsConfig\",\n    value: function setCachedJsConfig(url, jsConfigs) {\n      this.setJsCache(url, jsConfigs);\n      return this;\n    }\n  }, {\n    key: \"loadWeChatJsConf\",\n    value: function loadWeChatJsConf(url, configs) {\n      var _this = this;\n\n      var cachedConfig = this.getCachedJsConfig(url);\n\n      if (cachedConfig) {\n        this.initWeChatJsConfig(url, cachedConfig);\n\n        if (configs && configs.loaded) {\n          configs.loaded();\n        }\n\n        return this;\n      }\n\n      this.getWeChatJsConf({\n        'url': url\n      }).then(function (response) {\n        return response.json();\n      }).then(function (resp) {\n        if (resp.js) {\n          _this.initWeChatJsConfig(url, resp.js);\n\n          if (configs !== undefined) {\n            _this.runJs(configs);\n          }\n        }\n      });\n      return this;\n    }\n  }, {\n    key: \"runWhenWXReady\",\n    value: function runWhenWXReady(func) {\n      if (wx && typeof wx.ready === 'function' && typeof func === 'function') {\n        wx.ready(function () {\n          func();\n        });\n      }\n    }\n  }, {\n    key: \"runJs\",\n    value: function runJs(configs) {\n      jQuery(document).ready(function () {\n        // delay 500 ms to execute wx.ready\n        setTimeout(function () {\n          wx.ready(function (res) {\n            if (configs.menuShareAppMessage) {\n              wx.onMenuShareAppMessage(configs.menuShareAppMessage);\n            }\n\n            if (configs.menuShareTimeline) {\n              wx.onMenuShareTimeline(configs.menuShareTimeline);\n            }\n\n            if (configs.getLocation) {\n              wx.getLocation({\n                type: 'wgs84',\n                // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'\n                success: function success(res) {\n                  if (typeof configs.getLocation.success === 'function') {\n                    configs.getLocation.success(res);\n                  }\n                },\n                fail: function fail(res) {\n                  if (typeof configs.getLocation.fail === 'function') {\n                    configs.getLocation.fail(res);\n                  }\n                }\n              });\n            }\n\n            if (configs.loaded && typeof configs.loaded === 'function') {\n              configs.loaded(res);\n            }\n          });\n        }, 1000);\n      });\n    }\n  }, {\n    key: \"md5Hash\",\n    value: function md5Hash(string) {\n      return md5(string);\n    }\n  }]);\n\n  return WeChatService;\n}();\n\nvar weChatService = new WeChatService();\nexport default weChatService;","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM_React/shm-react/my-app/service/WeChatService.js"],"names":["BaseService","Config","jQuery","md5","local_storage_key","js_expires_in_seconds","WeChatService","params","get","webApi","url","jsConfigs","wx","config","setCachedJsConfig","md5Hash","value","cached","localStorage","getItem","jsonCached","JSON","parse","getJsCacheKey","setItem","tmp","stored_config","getJsCache","timestamp","now_unix_timestamp","Math","floor","undefined","setJsCache","configs","cachedConfig","getCachedJsConfig","initWeChatJsConfig","loaded","getWeChatJsConf","then","response","json","resp","js","runJs","func","ready","document","setTimeout","res","menuShareAppMessage","onMenuShareAppMessage","menuShareTimeline","onMenuShareTimeline","getLocation","type","success","fail","string","weChatService"],"mappings":"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","sourcesContent":["import BaseService from './BaseService';\nimport {Config} from '../Config';\nimport jQuery from 'jquery';\nimport md5 from 'md5';\n\nconst local_storage_key = 'wx';\nconst js_expires_in_seconds = 7000;\nclass WeChatService {\n\n    getWeChatJsConf = params => BaseService.get(Config.webApi + 'wechat/js/conf', params);\n\n    initWeChatJsConfig (url, jsConfigs) {\n        if (wx && typeof(wx.config) === 'function') {\n            wx.config(jsConfigs);\n            this.setCachedJsConfig(url, jsConfigs);\n        }\n    };\n\n    getJsCacheKey (url) {\n        return this.md5Hash(url);\n    };\n\n    setJsCache (url, value) {\n        let cached = localStorage.getItem(local_storage_key);\n        let jsonCached = JSON.parse(cached);\n        if (!cached) {\n            cached = {};\n        }\n        if (!jsonCached) {\n            jsonCached = {};\n        }\n        jsonCached[this.getJsCacheKey(url)] = value;\n        localStorage.setItem(local_storage_key, JSON.stringify(jsonCached));\n        return this;\n    };\n\n    getJsCache (url) {\n        let cached = localStorage.getItem(local_storage_key);\n        let jsonCached = JSON.parse(cached);\n        return jsonCached ? jsonCached[this.getJsCacheKey(url)] : null;\n    };\n\n    getCachedJsConfig (url) {\n        let tmp = {};\n        tmp.stored_config = this.getJsCache(url);\n        if (typeof(tmp.stored_config) === 'object' && tmp.stored_config && tmp.stored_config.timestamp !== '') {\n            tmp.now_unix_timestamp = Math.floor(Date.now() / 1000);\n            // cache expired\n            if (((tmp.now_unix_timestamp * 1) - (tmp.stored_config.timestamp * 1)) <= js_expires_in_seconds) {\n                return tmp.stored_config;\n            }\n        }\n        return undefined;\n    };\n\n    setCachedJsConfig (url, jsConfigs) {\n        this.setJsCache(url, jsConfigs);\n        return this;\n    };\n\n    loadWeChatJsConf (url, configs) {\n        let cachedConfig = this.getCachedJsConfig(url);\n        if (cachedConfig) {\n            this.initWeChatJsConfig(url, cachedConfig);\n            if (configs && configs.loaded) {\n                configs.loaded();\n            }\n            return this;\n        }\n\n        this.getWeChatJsConf({'url': url})\n            .then((response) => response.json())\n            .then((resp) => {\n                if (resp.js) {\n                    this.initWeChatJsConfig(url, resp.js);\n                    if (configs !== undefined) {\n                        this.runJs(configs);\n                    }\n                }\n            });\n        return this;\n    };\n\n    runWhenWXReady (func) {\n        if (wx && typeof(wx.ready) === 'function' && typeof(func) === 'function') {\n            wx.ready(function () {\n                func();\n            });\n        }\n    };\n\n    runJs (configs) {\n        jQuery(document).ready(function () {\n            // delay 500 ms to execute wx.ready\n            setTimeout(() => {\n                wx.ready(function (res) {\n                    if (configs.menuShareAppMessage) {\n                        wx.onMenuShareAppMessage(configs.menuShareAppMessage);\n                    }\n                    if (configs.menuShareTimeline) {\n                        wx.onMenuShareTimeline(configs.menuShareTimeline);\n                    }\n                    if (configs.getLocation) {\n                        wx.getLocation({\n                            type: 'wgs84', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'\n                            success: function (res) {\n                                if (typeof(configs.getLocation.success) === 'function') {\n                                    configs.getLocation.success(res);\n                                }\n                            },\n                            fail: function (res) {\n                                if (typeof(configs.getLocation.fail) === 'function') {\n                                    configs.getLocation.fail(res);\n                                }\n                            }\n                        });\n                    }\n                    if (configs.loaded && typeof (configs.loaded) === 'function') {\n                        configs.loaded(res);\n                    }\n                });\n            }, 1000);\n        });\n    };\n\n    md5Hash (string) {\n        return md5(string);\n    };\n}\nconst weChatService = new WeChatService();\nexport default weChatService;\n"]},"metadata":{},"sourceType":"module"}