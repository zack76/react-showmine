{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/ArticleDetails/ArticleComments.js\";\nimport React, { Component } from \"react\";\nimport Colors from \"../../../constants/Colors\";\nimport ItemService from \"../../../service/ItemService\";\nimport \"weui\";\nimport \"react-weui/build/packages/react-weui.css\";\nimport { Button, Popup, Article, CellsTitle, Form, FormCell, CellBody, TextArea, Dialog, Toast } from \"react-weui/build/packages\";\nimport UtilsService from \"../../../service/UtilsService\";\nimport { Config } from \"../../../Config\";\nimport AuthService from \"../../../service/AuthService\";\nimport Modal from \"react-modal\";\n\nvar ArticleComments =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ArticleComments, _Component);\n\n  function ArticleComments(props) {\n    var _this;\n\n    _classCallCheck(this, ArticleComments);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ArticleComments).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"getItemNormalCommentList\", function () {\n      var params = {};\n      ItemService.getItemNormalCommentList(_this.state.item.id, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          commentList: responseJson.data\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"postItemNormalComment\", function () {\n      _this.setState({\n        disabled: true,\n        showLoading: true\n      });\n\n      var params = {\n        comments: _this.state.newComment,\n        item_url: \"https://react.showmine66.com/itemDetails?itemId=\" + _this.state.item.id,\n        is_broadcast: false,\n        is_private: false,\n        state_redirect_obj: {\n          url: UtilsService.getWebAddress() // url: \"http://localhost:3000\",\n\n        },\n        wechat_auth_url: \"http://localhost:8888/a/wu?domain=http%253A%252F%252Flocalhost%253A8888&origurl=http%253A%252F%252Flocalhost%253A8888%252Fma%252Fi%252Ff187861730fbfe9cf62b110013bcfc4d%252F%2523app-top\"\n      };\n      ItemService.postItemNormalComment(_this.state.item.id, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          res: responseJson,\n          newComment: false\n        });\n\n        _this.state.loadingTimer = setTimeout(function () {\n          _this.setState({\n            showLoading: false\n          }, function () {\n            _this.setState({\n              fullpage_show: false,\n              disabled: false\n            }, function () {\n              _this.showToast();\n            });\n          });\n        }, 1000);\n\n        _this.getItemNormalCommentList();\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getLoginStatus\", function () {\n      if (_this.state.subscribeLoginLogId) {\n        AuthService.checkLoginStatus(_this.state.subscribeLoginLogId || null).then(function (response) {\n          return response.text();\n        }).then(function (resp) {\n          var res = JSON.parse(resp);\n\n          if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n            _this.setState({\n              loading: true\n            });\n\n            _this.loginWithTempCode(res.log.tmp_token.trim());\n          }\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginWithTempCode\", function (tmpToken) {\n      AuthService.loginWithTempCode(tmpToken).then(function (response) {\n        return response.text();\n      }).then(function (resp) {\n        var res = JSON.parse(resp);\n\n        if (res.return_code) {\n          localStorage.setItem('userToken', res.return_code);\n          localStorage.setItem('isLogIn', true);\n        }\n\n        var params = {};\n        AuthService.getMe(params).then(function (response) {\n          return response.json();\n        }).then(function (responseJson) {\n          localStorage.setItem('userObject', _JSON$stringify(responseJson));\n        }).then(function () {\n          location.reload();\n        }).catch(function (error) {\n          console.error(error);\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleLogin\", function () {\n      var item = _this.props.item;\n\n      if (UtilsService.openedInWeChat()) {\n        _this.weChatLogin();\n      } else {\n        var getLoginStatus = _this.getLoginStatus;\n        var params = {\n          companyId: item && item.company && item.company.id,\n          itemId: item && item.id\n        };\n        AuthService.getLoginSubscribeQrCode(params).then(function (response) {\n          return response.text();\n        }).then(function (resp) {\n          var res = JSON.parse(resp);\n          var interval = setInterval(getLoginStatus, 1000);\n\n          _this.setState({\n            qrUrl: res.qrcode,\n            subscribeLoginLogId: res.subscribeLoginLogId,\n            showModal: true,\n            interval: interval\n          });\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleClick\", function () {\n      if (_this.props.isLogin) {\n        _this.setState({\n          fullpage_show: true\n        });\n      } else {\n        _this.handleLogin();\n      }\n    });\n\n    _this.state = {\n      disabled: false,\n      showToast: false,\n      showLoading: false,\n      toastTimer: null,\n      loadingTimer: null,\n      item: _this.props.item,\n      defaultImage: \"../../../static/assets/default_item.png\",\n      newComment: false,\n      showDialog: false,\n      dialog: {\n        title: \"确认删除此条留言？\",\n        buttons: [{\n          type: \"default\",\n          label: \"取消\",\n          onClick: _this.hideDialog.bind(_assertThisInitialized(_this))\n        }, {\n          type: \"warn\",\n          label: \"确认\",\n          onClick: _this.deleteComment.bind(_assertThisInitialized(_this))\n        }]\n      }\n    };\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.showToast = _this.showToast.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(ArticleComments, [{\n    key: \"hideDialog\",\n    value: function hideDialog() {\n      this.setState({\n        showDialog: false\n      });\n    }\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(e) {\n      this.setState({\n        newComment: e.target.value\n      });\n    }\n  }, {\n    key: \"deleteComment\",\n    value: function deleteComment() {\n      var _this2 = this;\n\n      this.setState({\n        showLoading: true\n      });\n      this.hideDialog();\n      var params = {\n        item_url: \"https://www.showmine66.com/ma/i/\" + this.state.item.id\n      };\n      ItemService.updateItemNormalComment(this.state.targetComment, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this2.setState({\n          showLoading: false,\n          res: responseJson\n        }, function () {\n          _this2.showToast();\n        });\n\n        _this2.getItemNormalCommentList();\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getItemNormalCommentList();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.state.loadingTimer && clearTimeout(this.state.loadingTimer);\n      this.state.toastTimer && clearTimeout(this.state.toastTimer);\n      clearInterval(this.state.interval);\n    }\n  }, {\n    key: \"showToast\",\n    value: function showToast() {\n      var _this3 = this;\n\n      this.setState({\n        showToast: true\n      });\n      this.state.toastTimer = setTimeout(function () {\n        _this3.setState({\n          showToast: false\n        });\n      }, 1500);\n    }\n  }, {\n    key: \"weChatLogin\",\n    value: function weChatLogin() {\n      var origUrl = window.location.href;\n      var authUrl = Config.webAddress + \"AuthPage\";\n      AuthService.wechatLogin(origUrl, authUrl, {}).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        window.open(responseJson.auth_url, \"_self\");\n      }).catch(function (error) {\n        alert(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var isAdmin = this.props.isAdmin ? this.props.isAdmin : false;\n      var commentList = this.state.commentList;\n      var commentListComponent = undefined;\n\n      if (commentList && commentList.length > 0) {\n        commentListComponent = commentList.map(function (comment, id) {\n          var user = comment.created_by;\n          var imageUrl = user.avatar_img && user.avatar_img > \"\" ? user.avatar_img : _this4.state.defaultImage;\n          return React.createElement(\"div\", {\n            key: id,\n            style: styles.commentBody,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 245\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            style: styles.avatarWrapper,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 246\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            src: imageUrl,\n            style: styles.avatar,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 247\n            },\n            __self: this\n          })), React.createElement(\"div\", {\n            style: styles.nameNComment,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 250\n            },\n            __self: this\n          }, React.createElement(\"p\", {\n            style: styles.name,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 251\n            },\n            __self: this\n          }, user.nick_name), React.createElement(\"p\", {\n            style: styles.commentText,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 252\n            },\n            __self: this\n          }, comment.comments)), isAdmin ? React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 255\n            },\n            __self: this\n          }, React.createElement(Button, {\n            type: \"warn\",\n            size: \"small\",\n            onClick: function onClick(e) {\n              return _this4.setState({\n                showDialog: true,\n                targetComment: comment.id\n              });\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 256\n            },\n            __self: this\n          }, \"\\u5220\\u9664\"), React.createElement(Dialog, {\n            type: \"ios\",\n            title: _this4.state.dialog.title,\n            buttons: _this4.state.dialog.buttons,\n            show: _this4.state.showDialog,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 268\n            },\n            __self: this\n          }, \"\\u5220\\u9664\\u540E\\u65E0\\u6CD5\\u64A4\\u56DE\")) : \"\");\n        });\n      }\n\n      var customStyles = {\n        content: {\n          top: '50%',\n          left: '50%',\n          right: 'auto',\n          bottom: 'auto',\n          marginRight: '-50%',\n          transform: 'translate(-50%, -50%)'\n        }\n      };\n      return React.createElement(\"div\", {\n        style: styles.commentWrapper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297\n        },\n        __self: this\n      }, React.createElement(Toast, {\n        icon: \"loading\",\n        show: this.state.showLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, \"\\u8BF7\\u7A0D\\u540E...\"), React.createElement(Toast, {\n        icon: \"success-no-circle\",\n        show: this.state.showToast,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301\n        },\n        __self: this\n      }, \"\\u6210\\u529F\"), commentListComponent ? React.createElement(\"div\", {\n        style: styles.commentHeader,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      }, \"\\u7CBE\\u9009\\u7559\\u8A00\"), React.createElement(\"div\", {\n        style: {\n          color: Colors.fontColorLink\n        },\n        onClick: function onClick(e) {\n          return _this4.handleClick();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307\n        },\n        __self: this\n      }, \"\\u5199\\u7559\\u8A00\")) : React.createElement(\"div\", {\n        style: styles.noCommentHint,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          color: Colors.fontColorLink\n        },\n        onClick: function onClick(e) {\n          return _this4.handleClick();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316\n        },\n        __self: this\n      }, \"\\u5199\\u7559\\u8A00\")), React.createElement(\"div\", {\n        style: styles.commentHeader,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324\n        },\n        __self: this\n      }, React.createElement(Popup, {\n        show: this.state.fullpage_show,\n        onRequestClose: function onRequestClose(e) {\n          return _this4.setState({\n            fullpage_show: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          height: \"100vh\",\n          overflow: \"scroll\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329\n        },\n        __self: this\n      }, React.createElement(Article, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330\n        },\n        __self: this\n      }, React.createElement(Toast, {\n        icon: \"loading\",\n        show: this.state.showLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 331\n        },\n        __self: this\n      }, \"\\u8BF7\\u7A0D\\u540E...\"), React.createElement(CellsTitle, {\n        style: {\n          marginTop: \"40px\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334\n        },\n        __self: this\n      }, \"\\u65B0\\u5EFA\\u7559\\u8A00\"), React.createElement(Form, {\n        style: {\n          marginBottom: \"20px\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335\n        },\n        __self: this\n      }, React.createElement(FormCell, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 336\n        },\n        __self: this\n      }, React.createElement(CellBody, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 337\n        },\n        __self: this\n      }, React.createElement(TextArea, {\n        placeholder: \"\\u7559\\u8A00\\u540E\\u5C06\\u5BF9\\u6240\\u6709\\u4EBA\\u53EF\\u89C1\\uFF0C\\u6700\\u591A50\\u5B57\",\n        rows: \"3\",\n        maxlength: \"50\",\n        onChange: this.handleChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 338\n        },\n        __self: this\n      })))), React.createElement(Button, {\n        type: \"primary\",\n        plain: true,\n        disabled: !this.state.newComment || this.state.disabled,\n        onClick: function onClick(e) {\n          return _this4.postItemNormalComment();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 347\n        },\n        __self: this\n      }, \"\\u53D1\\u5E03\\u7559\\u8A00\"), React.createElement(Button, {\n        type: \"warn\",\n        onClick: function onClick(e) {\n          return _this4.setState({\n            fullpage_show: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 355\n        },\n        __self: this\n      }, \"\\u53D6\\u6D88\"))))), commentListComponent, React.createElement(Modal, {\n        isOpen: this.state.showModal // onAfterOpen={() => {this.getQrCode(item)}}\n        ,\n        onRequestClose: function onRequestClose() {\n          _this4.setState({\n            showModal: false\n          });\n        },\n        style: customStyles,\n        contentLabel: \"Example Modal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 366\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: styles.qrTitle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 373\n        },\n        __self: this\n      }, \"\\u626B\\u7801\\u5173\\u6CE8\\u8BE5\\u516C\\u53F8\"), React.createElement(\"div\", {\n        style: styles.qrTitle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 374\n        },\n        __self: this\n      }, React.createElement(\"small\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 374\n        },\n        __self: this\n      }, \"\\u5C06\\u66F4\\u53CA\\u65F6\\u7684\\u6536\\u5230\\u63A8\\u9001\")), React.createElement(\"img\", {\n        style: styles.qrcode,\n        src: this.state.qrUrl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 375\n        },\n        __self: this\n      })), React.createElement(Toast, {\n        icon: \"success-no-circle\",\n        show: this.state.success,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 377\n        },\n        __self: this\n      }, \"Success\"), React.createElement(Toast, {\n        icon: \"loading\",\n        show: this.state.loading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 378\n        },\n        __self: this\n      }, \"Loading...\"));\n    }\n  }]);\n\n  return ArticleComments;\n}(Component);\n\nvar styles = {\n  commentWrapper: {\n    backgroundColor: Colors.formBackground,\n    padding: \"4vw\",\n    fontSize: \"14px\"\n  },\n  commentHeader: {\n    color: Colors.formFontGray,\n    paddingBottom: \"20px\",\n    display: \"flex\",\n    WebkitBoxPack: \"justify\",\n    WebkitJustifyContent: \"space-between\",\n    MsFlexPack: \"justify\",\n    justifyContent: \"space-between\"\n  },\n  noCommentHint: {\n    color: Colors.formFontGray,\n    textAlign: \"center\",\n    paddingBottom: \"20px\"\n  },\n  commentBody: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    paddingBottom: \"20px\"\n  },\n  avatarWrapper: {\n    flex: \"1\"\n  },\n  avatar: {\n    width: \"32px\",\n    height: \"32px\",\n    borderRadius: \"4px\"\n  },\n  nameNComment: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    flex: \"10\",\n    paddingLeft: \"3vw\",\n    lineHeight: \"normal\"\n  },\n  name: {\n    color: Colors.formFontGray\n  },\n  commentText: {\n    color: Colors.fontColor,\n    paddingRight: \"5vw\"\n  }\n};\nexport default ArticleComments;","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/ArticleDetails/ArticleComments.js"],"names":["React","Component","Colors","ItemService","Button","Popup","Article","CellsTitle","Form","FormCell","CellBody","TextArea","Dialog","Toast","UtilsService","Config","AuthService","Modal","ArticleComments","props","params","getItemNormalCommentList","state","item","id","then","response","json","responseJson","setState","commentList","data","catch","error","console","disabled","showLoading","comments","newComment","item_url","is_broadcast","is_private","state_redirect_obj","url","getWebAddress","wechat_auth_url","postItemNormalComment","res","loadingTimer","setTimeout","fullpage_show","showToast","subscribeLoginLogId","checkLoginStatus","text","resp","JSON","parse","log","tmp_token","trim","loading","loginWithTempCode","tmpToken","return_code","localStorage","setItem","getMe","location","reload","openedInWeChat","weChatLogin","getLoginStatus","companyId","company","itemId","getLoginSubscribeQrCode","interval","setInterval","qrUrl","qrcode","showModal","isLogin","handleLogin","toastTimer","defaultImage","showDialog","dialog","title","buttons","type","label","onClick","hideDialog","bind","deleteComment","handleChange","e","target","value","updateItemNormalComment","targetComment","clearTimeout","clearInterval","origUrl","window","href","authUrl","webAddress","wechatLogin","open","auth_url","alert","isAdmin","commentListComponent","undefined","length","map","comment","user","created_by","imageUrl","avatar_img","styles","commentBody","avatarWrapper","avatar","nameNComment","name","nick_name","commentText","customStyles","content","top","left","right","bottom","marginRight","transform","commentWrapper","commentHeader","color","fontColorLink","handleClick","noCommentHint","height","overflow","marginTop","marginBottom","qrTitle","success","backgroundColor","formBackground","padding","fontSize","formFontGray","paddingBottom","display","WebkitBoxPack","WebkitJustifyContent","MsFlexPack","justifyContent","textAlign","flexDirection","flex","width","borderRadius","paddingLeft","lineHeight","fontColor","paddingRight"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Colors from \"../../../constants/Colors\";\nimport ItemService from \"../../../service/ItemService\";\nimport \"weui\";\nimport \"react-weui/build/packages/react-weui.css\";\nimport {\n    Button,\n    Popup,\n    Article,\n    CellsTitle,\n    Form,\n    FormCell,\n    CellBody,\n    TextArea,\n    Dialog,\n    Toast\n} from \"react-weui/build/packages\";\nimport UtilsService from \"../../../service/UtilsService\";\nimport { Config } from \"../../../Config\";\nimport AuthService from \"../../../service/AuthService\";\nimport Modal from \"react-modal\";\nclass ArticleComments extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            disabled: false,\n            showToast: false,\n            showLoading: false,\n            toastTimer: null,\n            loadingTimer: null,\n            item: this.props.item,\n            defaultImage: \"../../../static/assets/default_item.png\",\n            newComment: false,\n            showDialog: false,\n            dialog: {\n                title: \"确认删除此条留言？\",\n                buttons: [\n                    {\n                        type: \"default\",\n                        label: \"取消\",\n                        onClick: this.hideDialog.bind(this)\n                    },\n                    {\n                        type: \"warn\",\n                        label: \"确认\",\n                        onClick: this.deleteComment.bind(this)\n                    }\n                ]\n            }\n        };\n        this.handleChange = this.handleChange.bind(this);\n        this.showToast = this.showToast.bind(this);\n    }\n    hideDialog() {\n        this.setState({\n            showDialog: false\n        });\n    }\n    handleChange(e) {\n        this.setState({ newComment: e.target.value });\n    }\n    deleteComment() {\n        this.setState({ showLoading: true });\n        this.hideDialog();\n        let params = {\n            item_url: \"https://www.showmine66.com/ma/i/\" + this.state.item.id\n        };\n        ItemService.updateItemNormalComment(this.state.targetComment, params)\n            .then(response => response.json())\n            .then(responseJson => {\n                this.setState(\n                    {\n                        showLoading: false,\n                        res: responseJson\n                    },\n                    () => {\n                        this.showToast();\n                    }\n                );\n                this.getItemNormalCommentList();\n            })\n            .catch(error => {\n                console.error(error);\n            });\n    }\n\n    componentDidMount() {\n        this.getItemNormalCommentList();\n    }\n    componentWillUnmount() {\n        this.state.loadingTimer && clearTimeout(this.state.loadingTimer);\n        this.state.toastTimer && clearTimeout(this.state.toastTimer);\n        clearInterval(this.state.interval)\n\n    }\n    showToast() {\n        this.setState({ showToast: true });\n\n        this.state.toastTimer = setTimeout(() => {\n            this.setState({ showToast: false });\n        }, 1500);\n    }\n    getItemNormalCommentList = () => {\n        let params = {};\n        ItemService.getItemNormalCommentList(this.state.item.id, params)\n            .then(response => response.json())\n            .then(responseJson => {\n                this.setState({\n                    commentList: responseJson.data\n                });\n            })\n            .catch(error => {\n                console.error(error);\n            });\n    };\n    postItemNormalComment = () => {\n        this.setState({ disabled: true, showLoading: true });\n        let params = {\n            comments: this.state.newComment,\n            item_url: \"https://react.showmine66.com/itemDetails?itemId=\" + this.state.item.id,\n            is_broadcast: false,\n            is_private: false,\n            state_redirect_obj: {\n                url: UtilsService.getWebAddress()\n                // url: \"http://localhost:3000\",\n            },\n            wechat_auth_url:\n                \"http://localhost:8888/a/wu?domain=http%253A%252F%252Flocalhost%253A8888&origurl=http%253A%252F%252Flocalhost%253A8888%252Fma%252Fi%252Ff187861730fbfe9cf62b110013bcfc4d%252F%2523app-top\"\n        };\n        ItemService.postItemNormalComment(this.state.item.id, params)\n            .then(response => response.json())\n            .then(responseJson => {\n                this.setState({\n                    res: responseJson,\n                    newComment: false\n                });\n                this.state.loadingTimer = setTimeout(() => {\n                    this.setState({ showLoading: false }, () => {\n                        this.setState({ fullpage_show: false, disabled: false }, () => {\n                            this.showToast();\n                        });\n                    });\n                }, 1000);\n                this.getItemNormalCommentList();\n            })\n            .catch(error => {\n                console.error(error);\n            });\n    };\n    weChatLogin() {\n        let origUrl = window.location.href;\n        let authUrl = Config.webAddress + \"AuthPage\";\n        AuthService.wechatLogin(origUrl, authUrl, {})\n            .then(response => response.json())\n            .then(responseJson => {\n                window.open(responseJson.auth_url, \"_self\");\n            })\n            .catch(error => {\n                alert(error);\n            });\n    }\n\n    getLoginStatus= () => {\n        if(this.state.subscribeLoginLogId) {\n            AuthService.checkLoginStatus(this.state.subscribeLoginLogId || null)\n                .then(response => response.text())\n                .then(resp => {\n                    var res = JSON.parse(resp)\n                    if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n                        this.setState({\n                            loading: true\n                        })\n                        this.loginWithTempCode(res.log.tmp_token.trim())\n                    }\n                })\n        }\n    }\n\n    loginWithTempCode = (tmpToken) => {\n        AuthService.loginWithTempCode(tmpToken)\n            .then(response => response.text())\n            .then(resp => {\n                var res = JSON.parse(resp)\n                if (res.return_code){\n                    localStorage.setItem('userToken', res.return_code);\n                    localStorage.setItem('isLogIn', true);\n                }\n                let params ={};\n                AuthService.getMe(params)\n                    .then((response) => response.json())\n                    .then((responseJson) => {\n                        localStorage.setItem('userObject', JSON.stringify(responseJson));\n                    })\n                    .then(() => {location.reload();\n                    })\n                    .catch((error) => {\n                        console.error(error);\n                    });\n            })\n    }\n\n    handleLogin =() => {\n        let item = this.props.item\n        if (UtilsService.openedInWeChat()) {\n            this.weChatLogin()\n        } else {\n            let getLoginStatus = this.getLoginStatus\n            var params = {\n                companyId: item && item.company && item.company.id,\n                itemId: item && item.id\n            }\n            AuthService.getLoginSubscribeQrCode(params)\n                .then(response => response.text())\n                .then(resp => {\n                    var res = JSON.parse(resp)\n                    let interval = setInterval(getLoginStatus,1000);\n                    this.setState({\n                        qrUrl: res.qrcode,\n                        subscribeLoginLogId: res.subscribeLoginLogId,\n                        showModal: true,\n                        interval: interval\n                    })\n                })\n        }\n    }\n    handleClick = () => {\n        if (this.props.isLogin) {\n            this.setState({ fullpage_show: true });\n        } else {\n            this.handleLogin()\n        }\n    };\n    render() {\n        const isAdmin = this.props.isAdmin ? this.props.isAdmin : false;\n        const commentList = this.state.commentList;\n        let commentListComponent = undefined;\n        if (commentList && commentList.length > 0) {\n            commentListComponent = commentList.map((comment, id) => {\n                let user = comment.created_by;\n                let imageUrl =\n                    user.avatar_img && user.avatar_img > \"\"\n                        ? user.avatar_img\n                        : this.state.defaultImage;\n                return (\n                    <div key={id} style={styles.commentBody}>\n                        <div style={styles.avatarWrapper}>\n                            <img src={imageUrl} style={styles.avatar} />\n                        </div>\n\n                        <div style={styles.nameNComment}>\n                            <p style={styles.name}>{user.nick_name}</p>\n                            <p style={styles.commentText}>{comment.comments}</p>\n                        </div>\n                        {isAdmin ? (\n                            <div>\n                                <Button\n                                    type=\"warn\"\n                                    size=\"small\"\n                                    onClick={e =>\n                                        this.setState({\n                                            showDialog: true,\n                                            targetComment: comment.id\n                                        })\n                                    }\n                                >\n                                    删除\n                                </Button>\n                                <Dialog\n                                    type=\"ios\"\n                                    title={this.state.dialog.title}\n                                    buttons={this.state.dialog.buttons}\n                                    show={this.state.showDialog}\n                                >\n                                    删除后无法撤回\n                                </Dialog>\n                            </div>\n                        ) : (\n                            \"\"\n                        )}\n                    </div>\n                );\n            });\n        }\n\n        const customStyles = {\n            content : {\n                top                   : '50%',\n                left                  : '50%',\n                right                 : 'auto',\n                bottom                : 'auto',\n                marginRight           : '-50%',\n                transform             : 'translate(-50%, -50%)'\n            }\n        };\n\n        return (\n            <div style={styles.commentWrapper}>\n                <Toast icon=\"loading\" show={this.state.showLoading}>\n                    请稍后...\n                </Toast>\n                <Toast icon=\"success-no-circle\" show={this.state.showToast}>\n                    成功\n                </Toast>\n                {commentListComponent ? (\n                    <div style={styles.commentHeader}>\n                        <div>精选留言</div>\n                        <div\n                            style={{ color: Colors.fontColorLink }}\n                            onClick={e => this.handleClick()}\n                        >\n                            写留言\n                        </div>\n                    </div>\n                ) : (\n                    <div style={styles.noCommentHint}>\n                        <div\n                            style={{ color: Colors.fontColorLink }}\n                            onClick={e => this.handleClick()}\n                        >\n                            写留言\n                        </div>\n                    </div>\n                )}\n                <div style={styles.commentHeader}>\n                    <Popup\n                        show={this.state.fullpage_show}\n                        onRequestClose={e => this.setState({ fullpage_show: false })}\n                    >\n                        <div style={{ height: \"100vh\", overflow: \"scroll\" }}>\n                            <Article>\n                                <Toast icon=\"loading\" show={this.state.showLoading}>\n                                    请稍后...\n                                </Toast>\n                                <CellsTitle style={{ marginTop: \"40px\" }}>新建留言</CellsTitle>\n                                <Form style={{ marginBottom: \"20px\" }}>\n                                    <FormCell>\n                                        <CellBody>\n                                            <TextArea\n                                                placeholder=\"留言后将对所有人可见，最多50字\"\n                                                rows=\"3\"\n                                                maxlength=\"50\"\n                                                onChange={this.handleChange}\n                                            ></TextArea>\n                                        </CellBody>\n                                    </FormCell>\n                                </Form>\n                                <Button\n                                    type=\"primary\"\n                                    plain\n                                    disabled={!this.state.newComment || this.state.disabled}\n                                    onClick={e => this.postItemNormalComment()}\n                                >\n                                    发布留言\n                                </Button>\n                                <Button\n                                    type=\"warn\"\n                                    onClick={e => this.setState({ fullpage_show: false })}\n                                >\n                                    取消\n                                </Button>\n                            </Article>\n                        </div>\n                    </Popup>\n                </div>\n                {commentListComponent}\n                <Modal\n                    isOpen={this.state.showModal}\n                    // onAfterOpen={() => {this.getQrCode(item)}}\n                    onRequestClose={()=>{this.setState({showModal: false})}}\n                    style={customStyles}\n                    contentLabel=\"Example Modal\"\n                >\n                    <div style={styles.qrTitle}>扫码关注该公司</div>\n                    <div style={styles.qrTitle}><small>将更及时的收到推送</small></div>\n                    <img style={styles.qrcode} src={this.state.qrUrl}/>\n                </Modal>\n                <Toast icon=\"success-no-circle\" show={this.state.success}>Success</Toast>\n                <Toast icon=\"loading\" show={this.state.loading}>Loading...</Toast>\n            </div>\n        );\n    }\n}\n\nconst styles = {\n    commentWrapper: {\n        backgroundColor: Colors.formBackground,\n        padding: \"4vw\",\n        fontSize: \"14px\"\n    },\n    commentHeader: {\n        color: Colors.formFontGray,\n        paddingBottom: \"20px\",\n        display: \"flex\",\n        WebkitBoxPack: \"justify\",\n        WebkitJustifyContent: \"space-between\",\n        MsFlexPack: \"justify\",\n        justifyContent: \"space-between\"\n    },\n    noCommentHint: {\n        color: Colors.formFontGray,\n        textAlign: \"center\",\n        paddingBottom: \"20px\"\n    },\n    commentBody: {\n        display: \"flex\",\n        flexDirection: \"row\",\n        paddingBottom: \"20px\"\n    },\n    avatarWrapper: {\n        flex: \"1\"\n    },\n    avatar: {\n        width: \"32px\",\n        height: \"32px\",\n        borderRadius: \"4px\"\n    },\n    nameNComment: {\n        display: \"flex\",\n        flexDirection: \"column\",\n        flex: \"10\",\n        paddingLeft: \"3vw\",\n        lineHeight: \"normal\"\n    },\n    name: {\n        color: Colors.formFontGray\n    },\n    commentText: {\n        color: Colors.fontColor,\n        paddingRight: \"5vw\"\n    }\n};\n\nexport default ArticleComments;\n"]},"metadata":{},"sourceType":"module"}