{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/Zac/Sysbox/SHM/react/shm-react/my-app/pages/index.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport { Button, Cells, Cell, CellBody, CellFooter, ActionSheet, Toast } from 'react-weui';\nimport CompanyService from '../service/CompanyService';\nimport UtilsService from '../service/UtilsService';\nimport 'weui';\nimport 'react-weui/build/packages/react-weui.css';\nimport { Config } from '../Config';\nimport Footer from \"../components/Common/SiteFooter\";\nimport CompanyBanner from '../components/Company/CompanyBanner';\nimport SiteHeader from '../components/Common/SiteHeader';\nimport CompanyTitle from '../components/Company/CompanyTitle';\nimport SlideableJieLongList from \"../components/Company/SlideableList/SlideableJieLongList\";\nimport ConsultationList from \"../components/Company/ConsultationList/ConsultationList\";\nimport CompanyInfoSection from \"../components/Company/CompanyInfoSection\";\nimport WeChatService from \"../service/WeChatService\";\nimport { Row, Col, Container } from 'react-bootstrap';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport AuthService from \"../service/AuthService\";\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"weChatShare\", function () {\n      var company = _this.state.company;\n      var currentUrl = _this.state.currentUrl;\n      WeChatService.runWhenWXReady(function () {\n        wx.onMenuShareAppMessage({\n          title: company.name,\n          desc: company.description,\n          link: currentUrl,\n          imgUrl: company.logo_img && company.logo_img.url ? company.logo_img.url : '../static/assets/default_item.png'\n        });\n        wx.onMenuShareTimeline({\n          title: company.name,\n          link: currentUrl,\n          imgUrl: company.logo_img && company.logo_img.url ? company.logo_img.url : '../static/assets/default_item.png'\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginWithTempCode\", function (tmpToken) {\n      AuthService.loginWithTempCode(tmpToken).then(function (response) {\n        return response.text();\n      }).then(function (resp) {\n        var res = JSON.parse(resp);\n\n        if (res.return_code) {\n          localStorage.setItem('userToken', res.return_code);\n          localStorage.setItem('isLogIn', true);\n        }\n\n        var params = {};\n        AuthService.getMe(params).then(function (response) {\n          return response.json();\n        }).then(function (responseJson) {\n          localStorage.setItem('userObject', _JSON$stringify(responseJson));\n        }).then(function () {\n          location.reload();\n        }).catch(function (error) {\n          console.error(error);\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getLoginStatus\", function () {\n      if (!UtilsService.openedInWeChat() && !localStorage.getItem('userToken')) {\n        if (_this.state.subscribeLoginLogId) {\n          AuthService.checkLoginStatus(_this.state.subscribeLoginLogId || null).then(function (response) {\n            return response.text();\n          }).then(function (resp) {\n            var res = JSON.parse(resp);\n\n            if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n              _this.setState({\n                loading: true\n              });\n\n              _this.loginWithTempCode(res.log.tmp_token.trim());\n            }\n          });\n        }\n      } else {\n        clearInterval(_this.state.interval);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCompanyQrCode\", function (company) {\n      var getLoginStatus = _this.getLoginStatus;\n      var params = {\n        companyId: company.id\n      };\n      AuthService.getLoginSubscribeQrCode(params).then(function (response) {\n        return response.text();\n      }).then(function (response) {\n        var res = JSON.parse(response);\n        var interval = setInterval(getLoginStatus, 1000);\n\n        _this.setState({\n          qrUrl: res.qrcode,\n          subscribeLoginLogId: res.subscribeLoginLogId,\n          interval: interval\n        });\n      });\n    });\n\n    _this.state = {\n      company: _this.props.company,\n      showLoading: false,\n      isLogin: false\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setState({\n        isLogin: localStorage.getItem('isLogIn')\n      }, function () {\n        setTimeout(function () {\n          _this2.weChatShare();\n        }, 500);\n      });\n      this.getCompanyQrCode(this.state.company);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var company = this.state.company ? this.state.company : undefined;\n      return React.createElement(\"div\", {\n        style: styles.companyWrapper,\n        className: 'custom-font',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, React.createElement(Col, {\n        sm: 12,\n        lg: 8,\n        lgOffset: 2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, React.createElement(SiteHeader, {\n        company: company,\n        show: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }), React.createElement(CompanyBanner, {\n        companyId: company.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }), React.createElement(CompanyTitle, {\n        company: company,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }), React.createElement(CompanyInfoSection, {\n        company: company,\n        showDivider: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }), React.createElement(SlideableJieLongList, {\n        companyId: company.id,\n        isOngoing: true,\n        showDivider: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }), React.createElement(SlideableJieLongList, {\n        companyId: company.id,\n        isOngoing: false,\n        showDivider: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }), React.createElement(ConsultationList, {\n        companyId: company.id,\n        showDivider: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }), React.createElement(Footer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      })), React.createElement(Col, {\n        sm: 12,\n        lg: 2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"stick\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: styles.qrTitle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }, \"\\u626B\\u7801\\u5173\\u6CE8\\u8BE5\\u516C\\u53F8\"), React.createElement(\"div\", {\n        style: styles.qrTitle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, React.createElement(\"small\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, \"\\u5C06\\u66F4\\u53CA\\u65F6\\u7684\\u6536\\u5230\\u63A8\\u9001\")), React.createElement(\"img\", {\n        style: styles.qrcode,\n        src: this.state.qrUrl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }))))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\n_defineProperty(App, \"getInitialProps\",\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(_ref) {\n    var res, req, query, homePageUrl, resp, json;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            res = _ref.res, req = _ref.req, query = _ref.query;\n\n            if (query.companyId) {\n              _context.next = 5;\n              break;\n            }\n\n            homePageUrl = 'https://www.showmine.com';\n\n            if (res) {\n              res.writeHead(301, {\n                Location: homePageUrl\n              });\n              res.end();\n            } else {\n              window.location = homePageUrl;\n            }\n\n            return _context.abrupt(\"return\", {});\n\n          case 5:\n            _context.next = 7;\n            return CompanyService.getCompanyDetails(query.companyId);\n\n          case 7:\n            resp = _context.sent;\n            _context.next = 10;\n            return resp.json();\n\n          case 10:\n            json = _context.sent;\n            return _context.abrupt(\"return\", {\n              company: UtilsService.formatRawCompany(json)\n            });\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}());\n\nvar styles = {\n  companyWrapper: {\n    width: '100%'\n  },\n  qrcode: {\n    width: '100%'\n  },\n  qrTitle: {\n    width: '100%',\n    textAlign: 'center'\n  }\n};\nexport default App;","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM/react/shm-react/my-app/pages/index.js"],"names":["React","Component","Button","Cells","Cell","CellBody","CellFooter","ActionSheet","Toast","CompanyService","UtilsService","Config","Footer","CompanyBanner","SiteHeader","CompanyTitle","SlideableJieLongList","ConsultationList","CompanyInfoSection","WeChatService","Row","Col","Container","AuthService","App","props","company","state","currentUrl","runWhenWXReady","wx","onMenuShareAppMessage","title","name","desc","description","link","imgUrl","logo_img","url","onMenuShareTimeline","tmpToken","loginWithTempCode","then","response","text","resp","res","JSON","parse","return_code","localStorage","setItem","params","getMe","json","responseJson","location","reload","catch","error","console","openedInWeChat","getItem","subscribeLoginLogId","checkLoginStatus","log","tmp_token","trim","setState","loading","clearInterval","interval","getLoginStatus","companyId","id","getLoginSubscribeQrCode","setInterval","qrUrl","qrcode","showLoading","isLogin","setTimeout","weChatShare","getCompanyQrCode","undefined","styles","companyWrapper","qrTitle","req","query","homePageUrl","writeHead","Location","end","window","getCompanyDetails","formatRawCompany","width","textAlign"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport {Button, Cells, Cell, CellBody, CellFooter, ActionSheet, Toast} from 'react-weui';\nimport CompanyService from '../service/CompanyService';\nimport UtilsService from '../service/UtilsService';\nimport 'weui';\nimport 'react-weui/build/packages/react-weui.css';\nimport { Config } from '../Config';\nimport Footer from \"../components/Common/SiteFooter\";\nimport CompanyBanner from '../components/Company/CompanyBanner';\nimport SiteHeader from '../components/Common/SiteHeader';\nimport CompanyTitle from '../components/Company/CompanyTitle';\nimport SlideableJieLongList from \"../components/Company/SlideableList/SlideableJieLongList\";\nimport ConsultationList from \"../components/Company/ConsultationList/ConsultationList\";\nimport CompanyInfoSection from \"../components/Company/CompanyInfoSection\";\nimport WeChatService from \"../service/WeChatService\";\nimport { Row, Col, Container } from 'react-bootstrap';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport AuthService from \"../service/AuthService\";\n\n\nclass App extends Component {\n    constructor(props){\n        super(props);\n        this.state = {\n            company: this.props.company,\n            showLoading: false,\n            isLogin: false,\n        };\n    }\n\n    static getInitialProps = async({ res, req, query }) => {\n        if (!query.companyId) {\n            const homePageUrl = 'https://www.showmine.com'\n            if (res) {\n                res.writeHead(301, {\n                    Location: homePageUrl\n                })\n                res.end()\n            } else {\n                window.location = homePageUrl\n            }\n            return {}\n        }\n        let resp = await CompanyService.getCompanyDetails(query.companyId);\n        const json = await resp.json();\n        return {company: UtilsService.formatRawCompany(json)};\n        // let params = {domain: req.headers.host};\n        // let res = await CompanyService.getCompanyFromDomain(params);\n        // const json = await res.json();\n        // return {\n        //     company: UtilsService.formatRawCompany(json),\n        // };\n    };\n\n\n    componentDidMount() {\n        this.setState({\n            isLogin: localStorage.getItem('isLogIn'),\n        }, () => {\n            setTimeout(()=>{\n                this.weChatShare()\n            }, 500);\n        });\n        this.getCompanyQrCode(this.state.company)\n    }\n\n    weChatShare = () => {\n        let company = this.state.company;\n        let currentUrl = this.state.currentUrl;\n        WeChatService.runWhenWXReady(function () {\n            wx.onMenuShareAppMessage({\n                title: company.name,\n                desc: company.description,\n                link: currentUrl,\n                imgUrl: company.logo_img && company.logo_img.url ? company.logo_img.url : '../static/assets/default_item.png',\n            });\n            wx.onMenuShareTimeline({\n                title: company.name,\n                link: currentUrl,\n                imgUrl: company.logo_img && company.logo_img.url ? company.logo_img.url : '../static/assets/default_item.png',\n            });\n        });\n    };\n\n    // getCompanyQrCode =  company => {\n    //     let params = {};\n    //     CompanyService.getCompanyQrCode(company.id, params)\n    //         .then(response => response.text())\n    //         .then(response => {\n    //             this.setState({\n    //                 qrUrl: response\n    //             })\n    //         })\n    // }\n\n    loginWithTempCode = (tmpToken) => {\n        AuthService.loginWithTempCode(tmpToken)\n            .then(response => response.text())\n            .then(resp => {\n                var res = JSON.parse(resp)\n                if (res.return_code){\n                    localStorage.setItem('userToken', res.return_code);\n                    localStorage.setItem('isLogIn', true);\n                }\n                let params ={};\n                AuthService.getMe(params)\n                    .then((response) => response.json())\n                    .then((responseJson) => {\n                        localStorage.setItem('userObject', JSON.stringify(responseJson));\n                    })\n                    .then(() => {location.reload();\n                    })\n                    .catch((error) => {\n                        console.error(error);\n                    });\n            })\n    }\n\n    getLoginStatus = () => {\n        if (!UtilsService.openedInWeChat() && !localStorage.getItem('userToken')) {\n            if(this.state.subscribeLoginLogId) {\n                AuthService.checkLoginStatus(this.state.subscribeLoginLogId || null)\n                    .then(response => response.text())\n                    .then(resp => {\n                        var res = JSON.parse(resp)\n                        if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n                            this.setState({\n                                loading: true\n                            })\n                            this.loginWithTempCode(res.log.tmp_token.trim())\n                        }\n                    })\n            }\n        } else {\n            clearInterval(this.state.interval)\n        }\n    }\n\n    getCompanyQrCode =  company => {\n        var getLoginStatus = this.getLoginStatus\n        var params = {\n            companyId: company.id\n        }\n        AuthService.getLoginSubscribeQrCode( params)\n            .then(response => response.text())\n            .then(response => {\n                var res = JSON.parse(response)\n                let interval = setInterval(getLoginStatus,1000);\n                this.setState({\n                    qrUrl: res.qrcode,\n                    subscribeLoginLogId: res.subscribeLoginLogId,\n                    interval: interval\n                })\n            })\n    }\n\n    render() {\n        const company = this.state.company ? this.state.company : undefined;\n        return (\n            <div style={styles.companyWrapper} className={'custom-font'}>\n                <Container>\n                    <Row>\n                        <Col sm={12} lg={8} lgOffset={2}>\n                            <SiteHeader company={company} show={false}/>\n                            <CompanyBanner companyId={company.id}/>\n                            <CompanyTitle company={company}/>\n                            <CompanyInfoSection company={company} showDivider={true}/>\n                            <SlideableJieLongList companyId={company.id} isOngoing={true} showDivider={true}/>\n                            <SlideableJieLongList companyId={company.id} isOngoing={false} showDivider={true}/>\n                            <ConsultationList companyId={company.id} showDivider={true}/>\n                            <Footer/>\n                        </Col>\n                        <Col sm={12} lg={2}>\n                            <div className='stick'>\n                                <div style={styles.qrTitle}>扫码关注该公司</div>\n                                <div style={styles.qrTitle}><small>将更及时的收到推送</small></div>\n                                <img style={styles.qrcode} src={this.state.qrUrl}/>\n                            </div>\n                        </Col>\n                    </Row>\n                </Container>\n            </div>\n        );\n    }\n}\n\n\nconst styles = {\n    companyWrapper: {\n        width: '100%'\n    },\n    qrcode: {\n        width: '100%',\n    },\n    qrTitle: {\n        width: '100%',\n        textAlign: 'center'\n    },\n};\n\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}