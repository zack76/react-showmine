{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/RegistrationDetails/RegistrationButtonArea.js\";\nimport React from 'react';\nimport { Dialog } from \"react-weui\";\nimport UtilsService from '../../../service/UtilsService';\nimport Colors from '../../../constants/Colors';\nimport JielongService from \"../../../service/JielongService\";\nimport Btn from \"../../Common/form/Btn\";\n\nvar RegistrationButtonArea =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(RegistrationButtonArea, _React$Component);\n\n  function RegistrationButtonArea(props) {\n    var _this;\n\n    _classCallCheck(this, RegistrationButtonArea);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(RegistrationButtonArea).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"createJielongComment\", function () {\n      _this.setState({\n        isLoading: true\n      });\n\n      var itemId = _this.state.item.id;\n      var params = {\n        'config': _JSON$stringify(_this.state.formValues),\n        'comments': '',\n        'quantity': 1,\n        'state_redirect_obj': {\n          url: UtilsService.getWebAddress()\n        },\n        'wechat_auth_url': \"https://www.showmine66.com/a/wu?domain=https%253A%252F%252Fwww.showmine66.com&origurl=https%253A%252F%252Fwww.showmine66.com%252Fma%252Fi%252Fdbfcefa936b4cd6d5709953b5ea12673%2523app-top\",\n        'item_url': \"https://react.showmine66.com/itemDetails?itemId=\" + itemId,\n        // 'item_url': \"https://www.showmine66.com/ma/i/\" + itemId,\n        'voucher_base_url': \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",\n        'is_private': false\n      };\n      JielongService.createJielongComment(itemId, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          currentJieLong: responseJson\n        });\n\n        _this.generateVoucher(responseJson.id, _this.state.item);\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updateJielongComment\", function () {\n      _this.setState({\n        isLoading: true\n      }); // TODO change to jieLongId\n\n\n      var jieLongId = _this.state.registrationId;\n      var params = {\n        'config': _JSON$stringify(_this.state.formValues),\n        'comments': '',\n        'quantity': 1,\n        'state_redirect_obj': {\n          url: UtilsService.getWebAddress()\n        },\n        'wechat_auth_url': \"https://www.showmine66.com/a/wu?domain=https%253A%252F%252Fwww.showmine66.com&origurl=https%253A%252F%252Fwww.showmine66.com%252Fma%252Fi%252Fdbfcefa936b4cd6d5709953b5ea12673%2523app-top\",\n        'item_url': \"https://www.showmine66.com/ma/i/\" + _this.state.item.id,\n        'voucher_base_url': \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",\n        'is_private': false\n      };\n      JielongService.updateJielongComment(jieLongId, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          currentJieLong: responseJson\n        });\n\n        _this.generateVoucher(responseJson.id, _this.state.item);\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"generateVoucher\", function (jieLongId, item) {\n      var itemUrl = \"https://www.showmine66.com/ma/i/\" + item.id;\n      var params = {\n        is_update: false,\n        item_url: itemUrl,\n        voucher_base_url: \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\"\n      };\n      JielongService.generateVoucher(params, jieLongId).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          voucher: responseJson,\n          isLoading: false\n        }, function () {\n          window.location.reload();\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showHideConfirmDialog\", function () {\n      _this.setState(function (prevState) {\n        return {\n          showConfirmDialog: !prevState.showConfirmDialog\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updateIsEditingStatus\", function () {\n      _this.state.callbackUpdateIsEditing();\n    });\n\n    _this.state = {\n      item: _this.props.item,\n      formValues: _this.props.formValues,\n      isLoading: false,\n      isLogin: _this.props.isLogin,\n      isParticipated: _this.props.isParticipated,\n      registrationId: _this.props.registrationId,\n      showConfirmDialog: false,\n      currentJieLong: {},\n      isValidForm: _this.props.isValidForm,\n      isEditing: _this.props.isEditing,\n      callbackUpdateIsEditing: _this.props.callbackUpdateIsEditing\n    };\n    return _this;\n  }\n\n  _createClass(RegistrationButtonArea, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps, nextContext) {\n      this.setState({\n        item: nextProps.item,\n        isLogin: nextProps.isLogin,\n        formValues: nextProps.formValues,\n        isParticipated: nextProps.isParticipated,\n        registrationId: nextProps.registrationId,\n        isValidForm: nextProps.isValidForm,\n        isEditing: nextProps.isEditing\n      });\n    }\n  }, {\n    key: \"cancelJielong\",\n    value: function cancelJielong() {\n      var _this2 = this;\n\n      this.showHideConfirmDialog();\n      this.setState({\n        isLoading: true\n      });\n      var jieLongId = this.state.registrationId;\n      var url = \"https://www.showmine66.com/ma/i/\" + this.state.item.id;\n      JielongService.cancelJielong(jieLongId, url, {}).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this2.setState({\n          showLoading: false\n        }, function () {\n          window.location.reload();\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          isParticipated = _this$state.isParticipated,\n          isEditing = _this$state.isEditing,\n          isValidForm = _this$state.isValidForm,\n          isLoading = _this$state.isLoading,\n          showConfirmDialog = _this$state.showConfirmDialog;\n      var confirmClearButtons = {\n        title: '取消报名',\n        buttons: [{\n          type: 'default',\n          label: '再想想',\n          onClick: function onClick() {\n            return _this3.showHideConfirmDialog();\n          }\n        }, {\n          type: 'primary',\n          label: '确定',\n          onClick: function onClick() {\n            return _this3.cancelJielong();\n          }\n        }]\n      };\n\n      if (isParticipated) {\n        if (isEditing) {\n          return React.createElement(\"div\", {\n            style: styles.buttonGroupContainer,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 167\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            style: styles.buttonArea,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 168\n            },\n            __self: this\n          }, React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.updateIsEditingStatus();\n            },\n            title: \"\\u53D6\\u6D88\\u4FEE\\u6539\",\n            loading: isLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 169\n            },\n            __self: this\n          }), React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.updateJielongComment();\n            },\n            disabled: !isValidForm,\n            title: \"\\u786E\\u8BA4\\u4FEE\\u6539\",\n            loading: isLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 170\n            },\n            __self: this\n          })), React.createElement(Dialog, {\n            style: styles.dialog,\n            type: \"ios\",\n            title: confirmClearButtons.title,\n            buttons: confirmClearButtons.buttons,\n            show: showConfirmDialog,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 172\n            },\n            __self: this\n          }, \"\\u786E\\u5B9A\\u53D6\\u6D88\\u62A5\\u540D\\uFF1F\"));\n        } else {\n          return React.createElement(\"div\", {\n            style: styles.buttonGroupContainer,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 178\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            style: styles.buttonArea,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 179\n            },\n            __self: this\n          }, React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.showHideConfirmDialog();\n            },\n            title: \"\\u53D6\\u6D88\\u62A5\\u540D\",\n            loading: isLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 180\n            },\n            __self: this\n          }), React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.updateIsEditingStatus();\n            },\n            title: \"\\u4FEE\\u6539\\u62A5\\u540D\",\n            loading: isLoading,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 181\n            },\n            __self: this\n          })), React.createElement(Dialog, {\n            style: styles.dialog,\n            type: \"ios\",\n            title: confirmClearButtons.title,\n            buttons: confirmClearButtons.buttons,\n            show: showConfirmDialog,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 183\n            },\n            __self: this\n          }, \"\\u786E\\u5B9A\\u53D6\\u6D88\\u62A5\\u540D\\uFF1F\"));\n        }\n      } else {\n        return React.createElement(\"div\", {\n          style: styles.buttonGroupContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190\n          },\n          __self: this\n        }, React.createElement(Btn, {\n          onClick: function onClick() {\n            _this3.createJielongComment();\n          },\n          disabled: !isValidForm,\n          title: \"\\u7ACB\\u523B\\u62A5\\u540D\",\n          loading: isLoading,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191\n          },\n          __self: this\n        }));\n      }\n    }\n  }]);\n\n  return RegistrationButtonArea;\n}(React.Component);\n\nvar styles = {\n  buttonGroupContainer: {\n    position: 'fixed',\n    left: 0,\n    bottom: 0,\n    width: '100%',\n    color: '#fff',\n    textAlign: 'center'\n  },\n  dialog: {\n    color: Colors.fontColor\n  },\n  buttonArea: {\n    display: 'flex',\n    flexDirection: 'row'\n  }\n};\nexport default RegistrationButtonArea;","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/RegistrationDetails/RegistrationButtonArea.js"],"names":["React","Dialog","UtilsService","Colors","JielongService","Btn","RegistrationButtonArea","props","setState","isLoading","itemId","state","item","id","params","formValues","url","getWebAddress","createJielongComment","then","response","json","responseJson","currentJieLong","generateVoucher","catch","error","console","jieLongId","registrationId","updateJielongComment","itemUrl","is_update","item_url","voucher_base_url","voucher","window","location","reload","prevState","showConfirmDialog","callbackUpdateIsEditing","isLogin","isParticipated","isValidForm","isEditing","nextProps","nextContext","showHideConfirmDialog","cancelJielong","showLoading","confirmClearButtons","title","buttons","type","label","onClick","styles","buttonGroupContainer","buttonArea","updateIsEditingStatus","dialog","Component","position","left","bottom","width","color","textAlign","fontColor","display","flexDirection"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Dialog,} from \"react-weui\"\nimport UtilsService from '../../../service/UtilsService'\nimport Colors from '../../../constants/Colors'\nimport JielongService from \"../../../service/JielongService\"\n\nimport Btn from \"../../Common/form/Btn\"\n\nclass RegistrationButtonArea extends React.Component {\n    constructor(props){\n        super(props)\n        this.state = {\n            item: this.props.item,\n            formValues: this.props.formValues,\n            isLoading: false,\n            isLogin: this.props.isLogin,\n            isParticipated: this.props.isParticipated,\n            registrationId: this.props.registrationId,\n            showConfirmDialog: false,\n            currentJieLong: {},\n            isValidForm: this.props.isValidForm,\n            isEditing: this.props.isEditing,\n            callbackUpdateIsEditing: this.props.callbackUpdateIsEditing\n        }\n    }\n\n    componentWillReceiveProps(nextProps, nextContext) {\n        this.setState({\n            item: nextProps.item,\n            isLogin: nextProps.isLogin,\n            formValues: nextProps.formValues,\n            isParticipated: nextProps.isParticipated,\n            registrationId: nextProps.registrationId,\n            isValidForm: nextProps.isValidForm,\n            isEditing: nextProps.isEditing\n        })\n    }\n\n    createJielongComment = () => {\n        this.setState({ isLoading: true })\n        let itemId = this.state.item.id\n        let params = {\n            'config': JSON.stringify(this.state.formValues),\n            'comments': '',\n            'quantity': 1,\n            'state_redirect_obj': {\n                url: UtilsService.getWebAddress(),\n            },\n            'wechat_auth_url': \"https://www.showmine66.com/a/wu?domain=https%253A%252F%252Fwww.showmine66.com&origurl=https%253A%252F%252Fwww.showmine66.com%252Fma%252Fi%252Fdbfcefa936b4cd6d5709953b5ea12673%2523app-top\",\n            'item_url': \"https://react.showmine66.com/itemDetails?itemId=\" + itemId,\n            // 'item_url': \"https://www.showmine66.com/ma/i/\" + itemId,\n            'voucher_base_url': \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",\n            'is_private': false\n        }\n\n        JielongService.createJielongComment(itemId, params)\n            .then((response) => response.json())\n            .then((responseJson) => {\n                this.setState({ currentJieLong: responseJson })\n                this.generateVoucher(responseJson.id, this.state.item)\n            })\n            .catch((error) => {\n                console.error(error)\n            })\n    }\n\n    updateJielongComment = () => {\n        this.setState({ isLoading: true })\n        // TODO change to jieLongId\n        let jieLongId = this.state.registrationId\n        let params = {\n            'config': JSON.stringify(this.state.formValues),\n            'comments': '',\n            'quantity': 1,\n            'state_redirect_obj': {\n                url: UtilsService.getWebAddress(),\n            },\n            'wechat_auth_url': \"https://www.showmine66.com/a/wu?domain=https%253A%252F%252Fwww.showmine66.com&origurl=https%253A%252F%252Fwww.showmine66.com%252Fma%252Fi%252Fdbfcefa936b4cd6d5709953b5ea12673%2523app-top\",\n            'item_url': \"https://www.showmine66.com/ma/i/\" + this.state.item.id,\n            'voucher_base_url': \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",\n            'is_private': false\n        }\n\n        JielongService.updateJielongComment(jieLongId, params)\n            .then((response) => response.json())\n            .then((responseJson) => {\n                this.setState({ currentJieLong: responseJson })\n                this.generateVoucher(responseJson.id, this.state.item)\n            })\n            .catch((error) => {\n                console.error(error)\n            })\n    }\n\n    cancelJielong() {\n        this.showHideConfirmDialog()\n        this.setState({ isLoading: true })\n        let jieLongId = this.state.registrationId\n        let url = \"https://www.showmine66.com/ma/i/\" + this.state.item.id\n        JielongService.cancelJielong(jieLongId, url, {})\n            .then((response) => response.json())\n            .then((responseJson) => {\n                this.setState({showLoading: false\n                }, () =>{ window.location.reload()\n                })\n            })\n            .catch((error) => {\n                console.error(error)\n            })\n    }\n\n    generateVoucher = (jieLongId, item) => {\n        let itemUrl = \"https://www.showmine66.com/ma/i/\" + item.id\n        let params = {\n            is_update: false,\n            item_url: itemUrl,\n            voucher_base_url: \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",\n        }\n        JielongService.generateVoucher(params, jieLongId)\n            .then((response) => response.json())\n            .then((responseJson) => {\n                this.setState({\n                    voucher: responseJson,\n                    isLoading: false,\n                }, () => {\n                    window.location.reload()\n                })\n            })\n            .catch((error) => {\n                console.error(error)\n            })\n    }\n\n    showHideConfirmDialog = () => {\n        this.setState((prevState) => (\n            {\n                showConfirmDialog: !prevState.showConfirmDialog\n            })\n        )\n    }\n\n    updateIsEditingStatus = () => {\n        this.state.callbackUpdateIsEditing()\n    }\n\n    render(){\n        const { isParticipated, isEditing, isValidForm, isLoading, showConfirmDialog } = this.state\n        const confirmClearButtons= {\n            title: '取消报名',\n            buttons: [\n                {\n                    type: 'default',\n                    label: '再想想',\n                    onClick: () => this.showHideConfirmDialog()\n                },\n                {\n                    type: 'primary',\n                    label: '确定',\n                    onClick: ()=>this.cancelJielong()\n                }\n            ]\n        }\n\n        if (isParticipated) {\n            if (isEditing) {\n                return (\n                    <div style={styles.buttonGroupContainer}>\n                        <div style={styles.buttonArea}>\n                            <Btn onClick={()=>this.updateIsEditingStatus()} title='取消修改' loading={isLoading} />\n                            <Btn onClick={()=>this.updateJielongComment()} disabled={!isValidForm} title='确认修改' loading={isLoading} />\n                        </div>\n                        <Dialog style={styles.dialog} type=\"ios\" title={confirmClearButtons.title} buttons={confirmClearButtons.buttons} show={showConfirmDialog}>确定取消报名？</Dialog>\n                    </div>\n                )\n            }\n            else {\n                return (\n                    <div style={styles.buttonGroupContainer}>\n                        <div style={styles.buttonArea}>\n                            <Btn onClick={()=>this.showHideConfirmDialog()} title='取消报名' loading={isLoading} />\n                            <Btn onClick={()=>this.updateIsEditingStatus()} title='修改报名' loading={isLoading} />\n                        </div>\n                        <Dialog style={styles.dialog} type=\"ios\" title={confirmClearButtons.title} buttons={confirmClearButtons.buttons} show={showConfirmDialog}>确定取消报名？</Dialog>\n                    </div>\n                )\n            }\n        }\n        else {\n            return (\n                <div style={ styles.buttonGroupContainer }>\n                    <Btn onClick={()=>{ this.createJielongComment() }} disabled={ !isValidForm } title='立刻报名' loading={isLoading}/>\n                </div>\n            )\n        }\n    }\n}\n\nconst styles = {\n    buttonGroupContainer: {\n        position: 'fixed',\n        left: 0,\n        bottom: 0,\n        width: '100%',\n        color: '#fff',\n        textAlign: 'center',\n    },\n    dialog: {\n        color: Colors.fontColor\n    },\n    buttonArea: {\n        display:'flex',\n        flexDirection: 'row',\n    }\n}\n\n\nexport default RegistrationButtonArea\n"]},"metadata":{},"sourceType":"module"}