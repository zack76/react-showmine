{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/ArticleDetails/ArticleComments.js\";\nimport React, { Component } from \"react\";\nimport Colors from \"../../../constants/Colors\";\nimport ItemService from \"../../../service/ItemService\";\nimport \"weui\";\nimport \"react-weui/build/packages/react-weui.css\";\nimport { Button, Popup, Article, CellsTitle, Form, FormCell, CellBody, TextArea, Dialog, Toast } from \"react-weui/build/packages\";\nimport UtilsService from \"../../../service/UtilsService\";\nimport { Config } from \"../../../Config\";\nimport AuthService from \"../../../service/AuthService\";\nimport Modal from \"react-modal\";\n\nvar ArticleComments =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ArticleComments, _Component);\n\n  function ArticleComments(props) {\n    var _this;\n\n    _classCallCheck(this, ArticleComments);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ArticleComments).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"getLoginStatus\", function () {\n      if (_this.state.subscribeLoginLogId) {\n        AuthService.checkLoginStatus(_this.state.subscribeLoginLogId || null).then(function (response) {\n          return response.text();\n        }).then(function (resp) {\n          var res = JSON.parse(resp);\n\n          if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n            _this.setState({\n              loading: true\n            });\n\n            _this.loginWithTempCode(res.log.tmp_token.trim());\n          }\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginWithTempCode\", function (tmpToken) {\n      AuthService.loginWithTempCode(tmpToken).then(function (response) {\n        return response.text();\n      }).then(function (resp) {\n        var res = JSON.parse(resp);\n\n        if (res.return_code) {\n          localStorage.setItem('userToken', res.return_code);\n          localStorage.setItem('isLogIn', true);\n        }\n\n        var params = {};\n        AuthService.getMe(params).then(function (response) {\n          return response.json();\n        }).then(function (responseJson) {\n          localStorage.setItem('userObject', _JSON$stringify(responseJson));\n        }).then(function () {\n          location.reload();\n        }).catch(function (error) {\n          console.error(error);\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getItemNormalCommentList\", function () {\n      var params = {};\n      ItemService.getItemNormalCommentList(_this.state.item.id, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          commentList: responseJson.data\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"postItemNormalComment\", function () {\n      _this.setState({\n        disabled: true,\n        showLoading: true\n      });\n\n      var params = {\n        comments: _this.state.newComment,\n        item_url: \"https://react.showmine66.com/itemDetails?itemId=\" + _this.state.item.id,\n        is_broadcast: false,\n        is_private: false,\n        state_redirect_obj: {\n          url: UtilsService.getWebAddress() // url: \"http://localhost:3000\",\n\n        },\n        wechat_auth_url: \"http://localhost:8888/a/wu?domain=http%253A%252F%252Flocalhost%253A8888&origurl=http%253A%252F%252Flocalhost%253A8888%252Fma%252Fi%252Ff187861730fbfe9cf62b110013bcfc4d%252F%2523app-top\"\n      };\n      ItemService.postItemNormalComment(_this.state.item.id, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          res: responseJson,\n          newComment: false\n        });\n\n        _this.state.loadingTimer = setTimeout(function () {\n          _this.setState({\n            showLoading: false\n          }, function () {\n            _this.setState({\n              fullpage_show: false,\n              disabled: false\n            }, function () {\n              _this.showToast();\n            });\n          });\n        }, 1000);\n\n        _this.getItemNormalCommentList();\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleClick\", function () {\n      if (_this.props.isLogin) {\n        _this.setState({\n          fullpage_show: true\n        });\n      } else {\n        if (UtilsService.openedInWeChat()) {\n          _this.weChatLogin();\n        } else {\n          var getLoginStatus = _this.getLoginStatus;\n          var params = {\n            companyId: company.id,\n            itemId: item && item.id\n          };\n          AuthService.getLoginSubscribeQrCode(params).then(function (response) {\n            return response.text();\n          }).then(function (resp) {\n            var res = JSON.parse(resp);\n            var interval = setInterval(getLoginStatus, 1000);\n\n            _this.setState({\n              qrUrl: res.qrcode,\n              subscribeLoginLogId: res.subscribeLoginLogId,\n              showModal: true,\n              interval: interval\n            });\n          });\n        }\n      }\n    });\n\n    _this.state = {\n      disabled: false,\n      showToast: false,\n      showLoading: false,\n      toastTimer: null,\n      loadingTimer: null,\n      item: _this.props.item,\n      defaultImage: \"../../../static/assets/default_item.png\",\n      newComment: false,\n      showDialog: false,\n      dialog: {\n        title: \"确认删除此条留言？\",\n        buttons: [{\n          type: \"default\",\n          label: \"取消\",\n          onClick: _this.hideDialog.bind(_assertThisInitialized(_this))\n        }, {\n          type: \"warn\",\n          label: \"确认\",\n          onClick: _this.deleteComment.bind(_assertThisInitialized(_this))\n        }]\n      }\n    };\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.showToast = _this.showToast.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(ArticleComments, [{\n    key: \"hideDialog\",\n    value: function hideDialog() {\n      this.setState({\n        showDialog: false\n      });\n    }\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(e) {\n      this.setState({\n        newComment: e.target.value\n      });\n    }\n  }, {\n    key: \"deleteComment\",\n    value: function deleteComment() {\n      var _this2 = this;\n\n      this.setState({\n        showLoading: true\n      });\n      this.hideDialog();\n      var params = {\n        item_url: \"https://www.showmine66.com/ma/i/\" + this.state.item.id\n      };\n      ItemService.updateItemNormalComment(this.state.targetComment, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this2.setState({\n          showLoading: false,\n          res: responseJson\n        }, function () {\n          _this2.showToast();\n        });\n\n        _this2.getItemNormalCommentList();\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.state.interval);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getItemNormalCommentList();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.state.loadingTimer && clearTimeout(this.state.loadingTimer);\n      this.state.toastTimer && clearTimeout(this.state.toastTimer);\n    }\n  }, {\n    key: \"showToast\",\n    value: function showToast() {\n      var _this3 = this;\n\n      this.setState({\n        showToast: true\n      });\n      this.state.toastTimer = setTimeout(function () {\n        _this3.setState({\n          showToast: false\n        });\n      }, 1500);\n    }\n  }, {\n    key: \"weChatLogin\",\n    value: function weChatLogin() {\n      var origUrl = window.location.href;\n      var authUrl = Config.webAddress + \"AuthPage\";\n      AuthService.wechatLogin(origUrl, authUrl, {}).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        window.open(responseJson.auth_url, \"_self\");\n      }).catch(function (error) {\n        alert(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var isAdmin = this.props.isAdmin ? this.props.isAdmin : false;\n      var commentList = this.state.commentList;\n      var commentListComponent = undefined;\n\n      if (commentList && commentList.length > 0) {\n        commentListComponent = commentList.map(function (comment, id) {\n          var user = comment.created_by;\n          var imageUrl = user.avatar_img && user.avatar_img > \"\" ? user.avatar_img : _this4.state.defaultImage;\n          return React.createElement(\"div\", {\n            key: id,\n            style: styles.commentBody,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 241\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            style: styles.avatarWrapper,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 242\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            src: imageUrl,\n            style: styles.avatar,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 243\n            },\n            __self: this\n          })), React.createElement(\"div\", {\n            style: styles.nameNComment,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 246\n            },\n            __self: this\n          }, React.createElement(\"p\", {\n            style: styles.name,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 247\n            },\n            __self: this\n          }, user.nick_name), React.createElement(\"p\", {\n            style: styles.commentText,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 248\n            },\n            __self: this\n          }, comment.comments)), isAdmin ? React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 251\n            },\n            __self: this\n          }, React.createElement(Button, {\n            type: \"warn\",\n            size: \"small\",\n            onClick: function onClick(e) {\n              return _this4.setState({\n                showDialog: true,\n                targetComment: comment.id\n              });\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 252\n            },\n            __self: this\n          }, \"\\u5220\\u9664\"), React.createElement(Dialog, {\n            type: \"ios\",\n            title: _this4.state.dialog.title,\n            buttons: _this4.state.dialog.buttons,\n            show: _this4.state.showDialog,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 264\n            },\n            __self: this\n          }, \"\\u5220\\u9664\\u540E\\u65E0\\u6CD5\\u64A4\\u56DE\")) : \"\");\n        });\n      }\n\n      return React.createElement(\"div\", {\n        style: styles.commentWrapper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282\n        },\n        __self: this\n      }, React.createElement(Toast, {\n        icon: \"loading\",\n        show: this.state.showLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283\n        },\n        __self: this\n      }, \"\\u8BF7\\u7A0D\\u540E...\"), React.createElement(Toast, {\n        icon: \"success-no-circle\",\n        show: this.state.showToast,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286\n        },\n        __self: this\n      }, \"\\u6210\\u529F\"), commentListComponent ? React.createElement(\"div\", {\n        style: styles.commentHeader,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 290\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291\n        },\n        __self: this\n      }, \"\\u7CBE\\u9009\\u7559\\u8A00\"), React.createElement(\"div\", {\n        style: {\n          color: Colors.fontColorLink\n        },\n        onClick: function onClick(e) {\n          return _this4.handleClick();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292\n        },\n        __self: this\n      }, \"\\u5199\\u7559\\u8A00\")) : React.createElement(\"div\", {\n        style: styles.noCommentHint,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          color: Colors.fontColorLink\n        },\n        onClick: function onClick(e) {\n          return _this4.handleClick();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301\n        },\n        __self: this\n      }, \"\\u5199\\u7559\\u8A00\")), React.createElement(\"div\", {\n        style: styles.commentHeader,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309\n        },\n        __self: this\n      }, React.createElement(Popup, {\n        show: this.state.fullpage_show,\n        onRequestClose: function onRequestClose(e) {\n          return _this4.setState({\n            fullpage_show: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          height: \"100vh\",\n          overflow: \"scroll\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314\n        },\n        __self: this\n      }, React.createElement(Article, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315\n        },\n        __self: this\n      }, React.createElement(Toast, {\n        icon: \"loading\",\n        show: this.state.showLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316\n        },\n        __self: this\n      }, \"\\u8BF7\\u7A0D\\u540E...\"), React.createElement(CellsTitle, {\n        style: {\n          marginTop: \"40px\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319\n        },\n        __self: this\n      }, \"\\u65B0\\u5EFA\\u7559\\u8A00\"), React.createElement(Form, {\n        style: {\n          marginBottom: \"20px\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320\n        },\n        __self: this\n      }, React.createElement(FormCell, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321\n        },\n        __self: this\n      }, React.createElement(CellBody, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322\n        },\n        __self: this\n      }, React.createElement(TextArea, {\n        placeholder: \"\\u7559\\u8A00\\u540E\\u5C06\\u5BF9\\u6240\\u6709\\u4EBA\\u53EF\\u89C1\\uFF0C\\u6700\\u591A50\\u5B57\",\n        rows: \"3\",\n        maxlength: \"50\",\n        onChange: this.handleChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 323\n        },\n        __self: this\n      })))), React.createElement(Button, {\n        type: \"primary\",\n        plain: true,\n        disabled: !this.state.newComment || this.state.disabled,\n        onClick: function onClick(e) {\n          return _this4.postItemNormalComment();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332\n        },\n        __self: this\n      }, \"\\u53D1\\u5E03\\u7559\\u8A00\"), React.createElement(Button, {\n        type: \"warn\",\n        onClick: function onClick(e) {\n          return _this4.setState({\n            fullpage_show: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 340\n        },\n        __self: this\n      }, \"\\u53D6\\u6D88\"))))), commentListComponent, React.createElement(Modal, {\n        isOpen: this.state.showModal // onAfterOpen={() => {this.getQrCode(item)}}\n        ,\n        onRequestClose: function onRequestClose() {\n          _this4.setState({\n            showModal: false\n          });\n        },\n        style: customStyles,\n        contentLabel: \"Example Modal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: styles.qrTitle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 358\n        },\n        __self: this\n      }, \"\\u626B\\u7801\\u5173\\u6CE8\\u8BE5\\u516C\\u53F8\"), React.createElement(\"div\", {\n        style: styles.qrTitle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 359\n        },\n        __self: this\n      }, React.createElement(\"small\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 359\n        },\n        __self: this\n      }, \"\\u5C06\\u66F4\\u53CA\\u65F6\\u7684\\u6536\\u5230\\u63A8\\u9001\")), React.createElement(\"img\", {\n        style: styles.qrcode,\n        src: this.state.qrUrl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 360\n        },\n        __self: this\n      })), React.createElement(Toast, {\n        icon: \"success-no-circle\",\n        show: this.state.success,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 362\n        },\n        __self: this\n      }, \"Success\"), React.createElement(Toast, {\n        icon: \"loading\",\n        show: this.state.loading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 363\n        },\n        __self: this\n      }, \"Loading...\"));\n    }\n  }]);\n\n  return ArticleComments;\n}(Component);\n\nvar styles = {\n  commentWrapper: {\n    backgroundColor: Colors.formBackground,\n    padding: \"4vw\",\n    fontSize: \"14px\"\n  },\n  commentHeader: {\n    color: Colors.formFontGray,\n    paddingBottom: \"20px\",\n    display: \"flex\",\n    WebkitBoxPack: \"justify\",\n    WebkitJustifyContent: \"space-between\",\n    MsFlexPack: \"justify\",\n    justifyContent: \"space-between\"\n  },\n  noCommentHint: {\n    color: Colors.formFontGray,\n    textAlign: \"center\",\n    paddingBottom: \"20px\"\n  },\n  commentBody: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    paddingBottom: \"20px\"\n  },\n  avatarWrapper: {\n    flex: \"1\"\n  },\n  avatar: {\n    width: \"32px\",\n    height: \"32px\",\n    borderRadius: \"4px\"\n  },\n  nameNComment: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    flex: \"10\",\n    paddingLeft: \"3vw\",\n    lineHeight: \"normal\"\n  },\n  name: {\n    color: Colors.formFontGray\n  },\n  commentText: {\n    color: Colors.fontColor,\n    paddingRight: \"5vw\"\n  }\n};\nexport default ArticleComments;","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/ArticleDetails/ArticleComments.js"],"names":["React","Component","Colors","ItemService","Button","Popup","Article","CellsTitle","Form","FormCell","CellBody","TextArea","Dialog","Toast","UtilsService","Config","AuthService","Modal","ArticleComments","props","state","subscribeLoginLogId","checkLoginStatus","then","response","text","resp","res","JSON","parse","log","tmp_token","trim","setState","loading","loginWithTempCode","tmpToken","return_code","localStorage","setItem","params","getMe","json","responseJson","location","reload","catch","error","console","getItemNormalCommentList","item","id","commentList","data","disabled","showLoading","comments","newComment","item_url","is_broadcast","is_private","state_redirect_obj","url","getWebAddress","wechat_auth_url","postItemNormalComment","loadingTimer","setTimeout","fullpage_show","showToast","isLogin","openedInWeChat","weChatLogin","getLoginStatus","companyId","company","itemId","getLoginSubscribeQrCode","interval","setInterval","qrUrl","qrcode","showModal","toastTimer","defaultImage","showDialog","dialog","title","buttons","type","label","onClick","hideDialog","bind","deleteComment","handleChange","e","target","value","updateItemNormalComment","targetComment","clearInterval","clearTimeout","origUrl","window","href","authUrl","webAddress","wechatLogin","open","auth_url","alert","isAdmin","commentListComponent","undefined","length","map","comment","user","created_by","imageUrl","avatar_img","styles","commentBody","avatarWrapper","avatar","nameNComment","name","nick_name","commentText","commentWrapper","commentHeader","color","fontColorLink","handleClick","noCommentHint","height","overflow","marginTop","marginBottom","customStyles","qrTitle","success","backgroundColor","formBackground","padding","fontSize","formFontGray","paddingBottom","display","WebkitBoxPack","WebkitJustifyContent","MsFlexPack","justifyContent","textAlign","flexDirection","flex","width","borderRadius","paddingLeft","lineHeight","fontColor","paddingRight"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,MAAP,MAAmB,2BAAnB;AACA,OAAOC,WAAP,MAAwB,8BAAxB;AACA,OAAO,MAAP;AACA,OAAO,0CAAP;AACA,SACIC,MADJ,EAEIC,KAFJ,EAGIC,OAHJ,EAIIC,UAJJ,EAKIC,IALJ,EAMIC,QANJ,EAOIC,QAPJ,EAQIC,QARJ,EASIC,MATJ,EAUIC,KAVJ,QAWO,2BAXP;AAYA,OAAOC,YAAP,MAAyB,+BAAzB;AACA,SAASC,MAAT,QAAuB,iBAAvB;AACA,OAAOC,WAAP,MAAwB,8BAAxB;AACA,OAAOC,KAAP,MAAkB,aAAlB;;IACMC,e;;;;;AACF,2BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACf,yFAAMA,KAAN;;AADe,qEAmEH,YAAM;AAClB,UAAG,MAAKC,KAAL,CAAWC,mBAAd,EAAmC;AAC/BL,QAAAA,WAAW,CAACM,gBAAZ,CAA6B,MAAKF,KAAL,CAAWC,mBAAX,IAAkC,IAA/D,EACKE,IADL,CACU,UAAAC,QAAQ;AAAA,iBAAIA,QAAQ,CAACC,IAAT,EAAJ;AAAA,SADlB,EAEKF,IAFL,CAEU,UAAAG,IAAI,EAAI;AACV,cAAIC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAV;;AACA,cAAIC,GAAG,CAACG,GAAJ,IAAWH,GAAG,CAACG,GAAJ,CAAQC,SAAnB,IAAgCJ,GAAG,CAACG,GAAJ,CAAQC,SAAR,CAAkBC,IAAlB,OAA6B,EAAjE,EAAqE;AACjE,kBAAKC,QAAL,CAAc;AACVC,cAAAA,OAAO,EAAE;AADC,aAAd;;AAGA,kBAAKC,iBAAL,CAAuBR,GAAG,CAACG,GAAJ,CAAQC,SAAR,CAAkBC,IAAlB,EAAvB;AACH;AACJ,SAVL;AAWH;AACJ,KAjFkB;;AAAA,wEAmFC,UAACI,QAAD,EAAc;AAC9BpB,MAAAA,WAAW,CAACmB,iBAAZ,CAA8BC,QAA9B,EACKb,IADL,CACU,UAAAC,QAAQ;AAAA,eAAIA,QAAQ,CAACC,IAAT,EAAJ;AAAA,OADlB,EAEKF,IAFL,CAEU,UAAAG,IAAI,EAAI;AACV,YAAIC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAV;;AACA,YAAIC,GAAG,CAACU,WAAR,EAAoB;AAChBC,UAAAA,YAAY,CAACC,OAAb,CAAqB,WAArB,EAAkCZ,GAAG,CAACU,WAAtC;AACAC,UAAAA,YAAY,CAACC,OAAb,CAAqB,SAArB,EAAgC,IAAhC;AACH;;AACD,YAAIC,MAAM,GAAE,EAAZ;AACAxB,QAAAA,WAAW,CAACyB,KAAZ,CAAkBD,MAAlB,EACKjB,IADL,CACU,UAACC,QAAD;AAAA,iBAAcA,QAAQ,CAACkB,IAAT,EAAd;AAAA,SADV,EAEKnB,IAFL,CAEU,UAACoB,YAAD,EAAkB;AACpBL,UAAAA,YAAY,CAACC,OAAb,CAAqB,YAArB,EAAmC,gBAAeI,YAAf,CAAnC;AACH,SAJL,EAKKpB,IALL,CAKU,YAAM;AAACqB,UAAAA,QAAQ,CAACC,MAAT;AACZ,SANL,EAOKC,KAPL,CAOW,UAACC,KAAD,EAAW;AACdC,UAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACH,SATL;AAUH,OAnBL;AAoBH,KAxGkB;;AAAA,+EAwHQ,YAAM;AAC7B,UAAIP,MAAM,GAAG,EAAb;AACArC,MAAAA,WAAW,CAAC8C,wBAAZ,CAAqC,MAAK7B,KAAL,CAAW8B,IAAX,CAAgBC,EAArD,EAAyDX,MAAzD,EACKjB,IADL,CACU,UAAAC,QAAQ;AAAA,eAAIA,QAAQ,CAACkB,IAAT,EAAJ;AAAA,OADlB,EAEKnB,IAFL,CAEU,UAAAoB,YAAY,EAAI;AAClB,cAAKV,QAAL,CAAc;AACVmB,UAAAA,WAAW,EAAET,YAAY,CAACU;AADhB,SAAd;AAGH,OANL,EAOKP,KAPL,CAOW,UAAAC,KAAK,EAAI;AACZC,QAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACH,OATL;AAUH,KApIkB;;AAAA,4EAqIK,YAAM;AAC1B,YAAKd,QAAL,CAAc;AAAEqB,QAAAA,QAAQ,EAAE,IAAZ;AAAkBC,QAAAA,WAAW,EAAE;AAA/B,OAAd;;AACA,UAAIf,MAAM,GAAG;AACTgB,QAAAA,QAAQ,EAAE,MAAKpC,KAAL,CAAWqC,UADZ;AAETC,QAAAA,QAAQ,EAAE,qDAAqD,MAAKtC,KAAL,CAAW8B,IAAX,CAAgBC,EAFtE;AAGTQ,QAAAA,YAAY,EAAE,KAHL;AAITC,QAAAA,UAAU,EAAE,KAJH;AAKTC,QAAAA,kBAAkB,EAAE;AAChBC,UAAAA,GAAG,EAAEhD,YAAY,CAACiD,aAAb,EADW,CAEhB;;AAFgB,SALX;AASTC,QAAAA,eAAe,EACX;AAVK,OAAb;AAYA7D,MAAAA,WAAW,CAAC8D,qBAAZ,CAAkC,MAAK7C,KAAL,CAAW8B,IAAX,CAAgBC,EAAlD,EAAsDX,MAAtD,EACKjB,IADL,CACU,UAAAC,QAAQ;AAAA,eAAIA,QAAQ,CAACkB,IAAT,EAAJ;AAAA,OADlB,EAEKnB,IAFL,CAEU,UAAAoB,YAAY,EAAI;AAClB,cAAKV,QAAL,CAAc;AACVN,UAAAA,GAAG,EAAEgB,YADK;AAEVc,UAAAA,UAAU,EAAE;AAFF,SAAd;;AAIA,cAAKrC,KAAL,CAAW8C,YAAX,GAA0BC,UAAU,CAAC,YAAM;AACvC,gBAAKlC,QAAL,CAAc;AAAEsB,YAAAA,WAAW,EAAE;AAAf,WAAd,EAAsC,YAAM;AACxC,kBAAKtB,QAAL,CAAc;AAAEmC,cAAAA,aAAa,EAAE,KAAjB;AAAwBd,cAAAA,QAAQ,EAAE;AAAlC,aAAd,EAAyD,YAAM;AAC3D,oBAAKe,SAAL;AACH,aAFD;AAGH,WAJD;AAKH,SANmC,EAMjC,IANiC,CAApC;;AAOA,cAAKpB,wBAAL;AACH,OAfL,EAgBKH,KAhBL,CAgBW,UAAAC,KAAK,EAAI;AACZC,QAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACH,OAlBL;AAmBH,KAtKkB;;AAAA,kEAmLL,YAAM;AAChB,UAAI,MAAK5B,KAAL,CAAWmD,OAAf,EAAwB;AACpB,cAAKrC,QAAL,CAAc;AAAEmC,UAAAA,aAAa,EAAE;AAAjB,SAAd;AACH,OAFD,MAEO;AACH,YAAItD,YAAY,CAACyD,cAAb,EAAJ,EAAmC;AAC/B,gBAAKC,WAAL;AACH,SAFD,MAEO;AACH,cAAIC,cAAc,GAAG,MAAKA,cAA1B;AACA,cAAIjC,MAAM,GAAG;AACTkC,YAAAA,SAAS,EAAEC,OAAO,CAACxB,EADV;AAETyB,YAAAA,MAAM,EAAE1B,IAAI,IAAIA,IAAI,CAACC;AAFZ,WAAb;AAIAnC,UAAAA,WAAW,CAAC6D,uBAAZ,CAAoCrC,MAApC,EACKjB,IADL,CACU,UAAAC,QAAQ;AAAA,mBAAIA,QAAQ,CAACC,IAAT,EAAJ;AAAA,WADlB,EAEKF,IAFL,CAEU,UAAAG,IAAI,EAAI;AACV,gBAAIC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAV;AACA,gBAAIoD,QAAQ,GAAGC,WAAW,CAACN,cAAD,EAAgB,IAAhB,CAA1B;;AACA,kBAAKxC,QAAL,CAAc;AACV+C,cAAAA,KAAK,EAAErD,GAAG,CAACsD,MADD;AAEV5D,cAAAA,mBAAmB,EAAEM,GAAG,CAACN,mBAFf;AAGV6D,cAAAA,SAAS,EAAE,IAHD;AAIVJ,cAAAA,QAAQ,EAAEA;AAJA,aAAd;AAMH,WAXL;AAYH;AACJ;AACJ,KA7MkB;;AAEf,UAAK1D,KAAL,GAAa;AACTkC,MAAAA,QAAQ,EAAE,KADD;AAETe,MAAAA,SAAS,EAAE,KAFF;AAGTd,MAAAA,WAAW,EAAE,KAHJ;AAIT4B,MAAAA,UAAU,EAAE,IAJH;AAKTjB,MAAAA,YAAY,EAAE,IALL;AAMThB,MAAAA,IAAI,EAAE,MAAK/B,KAAL,CAAW+B,IANR;AAOTkC,MAAAA,YAAY,EAAE,yCAPL;AAQT3B,MAAAA,UAAU,EAAE,KARH;AAST4B,MAAAA,UAAU,EAAE,KATH;AAUTC,MAAAA,MAAM,EAAE;AACJC,QAAAA,KAAK,EAAE,WADH;AAEJC,QAAAA,OAAO,EAAE,CACL;AACIC,UAAAA,IAAI,EAAE,SADV;AAEIC,UAAAA,KAAK,EAAE,IAFX;AAGIC,UAAAA,OAAO,EAAE,MAAKC,UAAL,CAAgBC,IAAhB;AAHb,SADK,EAML;AACIJ,UAAAA,IAAI,EAAE,MADV;AAEIC,UAAAA,KAAK,EAAE,IAFX;AAGIC,UAAAA,OAAO,EAAE,MAAKG,aAAL,CAAmBD,IAAnB;AAHb,SANK;AAFL;AAVC,KAAb;AA0BA,UAAKE,YAAL,GAAoB,MAAKA,YAAL,CAAkBF,IAAlB,+BAApB;AACA,UAAKxB,SAAL,GAAiB,MAAKA,SAAL,CAAewB,IAAf,+BAAjB;AA7Be;AA8BlB;;;;iCACY;AACT,WAAK5D,QAAL,CAAc;AACVoD,QAAAA,UAAU,EAAE;AADF,OAAd;AAGH;;;iCACYW,C,EAAG;AACZ,WAAK/D,QAAL,CAAc;AAAEwB,QAAAA,UAAU,EAAEuC,CAAC,CAACC,MAAF,CAASC;AAAvB,OAAd;AACH;;;oCACe;AAAA;;AACZ,WAAKjE,QAAL,CAAc;AAAEsB,QAAAA,WAAW,EAAE;AAAf,OAAd;AACA,WAAKqC,UAAL;AACA,UAAIpD,MAAM,GAAG;AACTkB,QAAAA,QAAQ,EAAE,qCAAqC,KAAKtC,KAAL,CAAW8B,IAAX,CAAgBC;AADtD,OAAb;AAGAhD,MAAAA,WAAW,CAACgG,uBAAZ,CAAoC,KAAK/E,KAAL,CAAWgF,aAA/C,EAA8D5D,MAA9D,EACKjB,IADL,CACU,UAAAC,QAAQ;AAAA,eAAIA,QAAQ,CAACkB,IAAT,EAAJ;AAAA,OADlB,EAEKnB,IAFL,CAEU,UAAAoB,YAAY,EAAI;AAClB,QAAA,MAAI,CAACV,QAAL,CACI;AACIsB,UAAAA,WAAW,EAAE,KADjB;AAEI5B,UAAAA,GAAG,EAAEgB;AAFT,SADJ,EAKI,YAAM;AACF,UAAA,MAAI,CAAC0B,SAAL;AACH,SAPL;;AASA,QAAA,MAAI,CAACpB,wBAAL;AACH,OAbL,EAcKH,KAdL,CAcW,UAAAC,KAAK,EAAI;AACZC,QAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACH,OAhBL;AAiBH;;;2CACqB;AAClBsD,MAAAA,aAAa,CAAC,KAAKjF,KAAL,CAAW0D,QAAZ,CAAb;AACH;;;wCAyCmB;AAChB,WAAK7B,wBAAL;AACH;;;2CACsB;AACnB,WAAK7B,KAAL,CAAW8C,YAAX,IAA2BoC,YAAY,CAAC,KAAKlF,KAAL,CAAW8C,YAAZ,CAAvC;AACA,WAAK9C,KAAL,CAAW+D,UAAX,IAAyBmB,YAAY,CAAC,KAAKlF,KAAL,CAAW+D,UAAZ,CAArC;AACH;;;gCACW;AAAA;;AACR,WAAKlD,QAAL,CAAc;AAAEoC,QAAAA,SAAS,EAAE;AAAb,OAAd;AAEA,WAAKjD,KAAL,CAAW+D,UAAX,GAAwBhB,UAAU,CAAC,YAAM;AACrC,QAAA,MAAI,CAAClC,QAAL,CAAc;AAAEoC,UAAAA,SAAS,EAAE;AAAb,SAAd;AACH,OAFiC,EAE/B,IAF+B,CAAlC;AAGH;;;kCAgDa;AACV,UAAIkC,OAAO,GAAGC,MAAM,CAAC5D,QAAP,CAAgB6D,IAA9B;AACA,UAAIC,OAAO,GAAG3F,MAAM,CAAC4F,UAAP,GAAoB,UAAlC;AACA3F,MAAAA,WAAW,CAAC4F,WAAZ,CAAwBL,OAAxB,EAAiCG,OAAjC,EAA0C,EAA1C,EACKnF,IADL,CACU,UAAAC,QAAQ;AAAA,eAAIA,QAAQ,CAACkB,IAAT,EAAJ;AAAA,OADlB,EAEKnB,IAFL,CAEU,UAAAoB,YAAY,EAAI;AAClB6D,QAAAA,MAAM,CAACK,IAAP,CAAYlE,YAAY,CAACmE,QAAzB,EAAmC,OAAnC;AACH,OAJL,EAKKhE,KALL,CAKW,UAAAC,KAAK,EAAI;AACZgE,QAAAA,KAAK,CAAChE,KAAD,CAAL;AACH,OAPL;AAQH;;;6BA4BQ;AAAA;;AACL,UAAMiE,OAAO,GAAG,KAAK7F,KAAL,CAAW6F,OAAX,GAAqB,KAAK7F,KAAL,CAAW6F,OAAhC,GAA0C,KAA1D;AACA,UAAM5D,WAAW,GAAG,KAAKhC,KAAL,CAAWgC,WAA/B;AACA,UAAI6D,oBAAoB,GAAGC,SAA3B;;AACA,UAAI9D,WAAW,IAAIA,WAAW,CAAC+D,MAAZ,GAAqB,CAAxC,EAA2C;AACvCF,QAAAA,oBAAoB,GAAG7D,WAAW,CAACgE,GAAZ,CAAgB,UAACC,OAAD,EAAUlE,EAAV,EAAiB;AACpD,cAAImE,IAAI,GAAGD,OAAO,CAACE,UAAnB;AACA,cAAIC,QAAQ,GACRF,IAAI,CAACG,UAAL,IAAmBH,IAAI,CAACG,UAAL,GAAkB,EAArC,GACMH,IAAI,CAACG,UADX,GAEM,MAAI,CAACrG,KAAL,CAAWgE,YAHrB;AAIA,iBACI;AAAK,YAAA,GAAG,EAAEjC,EAAV;AAAc,YAAA,KAAK,EAAEuE,MAAM,CAACC,WAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACI;AAAK,YAAA,KAAK,EAAED,MAAM,CAACE,aAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACI;AAAK,YAAA,GAAG,EAAEJ,QAAV;AAAoB,YAAA,KAAK,EAAEE,MAAM,CAACG,MAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ,CADJ,EAKI;AAAK,YAAA,KAAK,EAAEH,MAAM,CAACI,YAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACI;AAAG,YAAA,KAAK,EAAEJ,MAAM,CAACK,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAwBT,IAAI,CAACU,SAA7B,CADJ,EAEI;AAAG,YAAA,KAAK,EAAEN,MAAM,CAACO,WAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAA+BZ,OAAO,CAAC7D,QAAvC,CAFJ,CALJ,EASKwD,OAAO,GACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACI,oBAAC,MAAD;AACI,YAAA,IAAI,EAAC,MADT;AAEI,YAAA,IAAI,EAAC,OAFT;AAGI,YAAA,OAAO,EAAE,iBAAAhB,CAAC;AAAA,qBACN,MAAI,CAAC/D,QAAL,CAAc;AACVoD,gBAAAA,UAAU,EAAE,IADF;AAEVe,gBAAAA,aAAa,EAAEiB,OAAO,CAAClE;AAFb,eAAd,CADM;AAAA,aAHd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADJ,EAaI,oBAAC,MAAD;AACI,YAAA,IAAI,EAAC,KADT;AAEI,YAAA,KAAK,EAAE,MAAI,CAAC/B,KAAL,CAAWkE,MAAX,CAAkBC,KAF7B;AAGI,YAAA,OAAO,EAAE,MAAI,CAACnE,KAAL,CAAWkE,MAAX,CAAkBE,OAH/B;AAII,YAAA,IAAI,EAAE,MAAI,CAACpE,KAAL,CAAWiE,UAJrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0DAbJ,CADI,GAwBJ,EAjCR,CADJ;AAsCH,SA5CsB,CAAvB;AA6CH;;AAED,aACI;AAAK,QAAA,KAAK,EAAEqC,MAAM,CAACQ,cAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,KAAD;AAAO,QAAA,IAAI,EAAC,SAAZ;AAAsB,QAAA,IAAI,EAAE,KAAK9G,KAAL,CAAWmC,WAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCADJ,EAII,oBAAC,KAAD;AAAO,QAAA,IAAI,EAAC,mBAAZ;AAAgC,QAAA,IAAI,EAAE,KAAKnC,KAAL,CAAWiD,SAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAJJ,EAOK4C,oBAAoB,GACjB;AAAK,QAAA,KAAK,EAAES,MAAM,CAACS,aAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCADJ,EAEI;AACI,QAAA,KAAK,EAAE;AAAEC,UAAAA,KAAK,EAAElI,MAAM,CAACmI;AAAhB,SADX;AAEI,QAAA,OAAO,EAAE,iBAAArC,CAAC;AAAA,iBAAI,MAAI,CAACsC,WAAL,EAAJ;AAAA,SAFd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAFJ,CADiB,GAWjB;AAAK,QAAA,KAAK,EAAEZ,MAAM,CAACa,aAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AACI,QAAA,KAAK,EAAE;AAAEH,UAAAA,KAAK,EAAElI,MAAM,CAACmI;AAAhB,SADX;AAEI,QAAA,OAAO,EAAE,iBAAArC,CAAC;AAAA,iBAAI,MAAI,CAACsC,WAAL,EAAJ;AAAA,SAFd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADJ,CAlBR,EA2BI;AAAK,QAAA,KAAK,EAAEZ,MAAM,CAACS,aAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,KAAD;AACI,QAAA,IAAI,EAAE,KAAK/G,KAAL,CAAWgD,aADrB;AAEI,QAAA,cAAc,EAAE,wBAAA4B,CAAC;AAAA,iBAAI,MAAI,CAAC/D,QAAL,CAAc;AAAEmC,YAAAA,aAAa,EAAE;AAAjB,WAAd,CAAJ;AAAA,SAFrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAII;AAAK,QAAA,KAAK,EAAE;AAAEoE,UAAAA,MAAM,EAAE,OAAV;AAAmBC,UAAAA,QAAQ,EAAE;AAA7B,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,KAAD;AAAO,QAAA,IAAI,EAAC,SAAZ;AAAsB,QAAA,IAAI,EAAE,KAAKrH,KAAL,CAAWmC,WAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCADJ,EAII,oBAAC,UAAD;AAAY,QAAA,KAAK,EAAE;AAAEmF,UAAAA,SAAS,EAAE;AAAb,SAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAJJ,EAKI,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAE;AAAEC,UAAAA,YAAY,EAAE;AAAhB,SAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,QAAD;AACI,QAAA,WAAW,EAAC,wFADhB;AAEI,QAAA,IAAI,EAAC,GAFT;AAGI,QAAA,SAAS,EAAC,IAHd;AAII,QAAA,QAAQ,EAAE,KAAK5C,YAJnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ,CADJ,CALJ,EAiBI,oBAAC,MAAD;AACI,QAAA,IAAI,EAAC,SADT;AAEI,QAAA,KAAK,MAFT;AAGI,QAAA,QAAQ,EAAE,CAAC,KAAK3E,KAAL,CAAWqC,UAAZ,IAA0B,KAAKrC,KAAL,CAAWkC,QAHnD;AAII,QAAA,OAAO,EAAE,iBAAA0C,CAAC;AAAA,iBAAI,MAAI,CAAC/B,qBAAL,EAAJ;AAAA,SAJd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAjBJ,EAyBI,oBAAC,MAAD;AACI,QAAA,IAAI,EAAC,MADT;AAEI,QAAA,OAAO,EAAE,iBAAA+B,CAAC;AAAA,iBAAI,MAAI,CAAC/D,QAAL,CAAc;AAAEmC,YAAAA,aAAa,EAAE;AAAjB,WAAd,CAAJ;AAAA,SAFd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAzBJ,CADJ,CAJJ,CADJ,CA3BJ,EAoEK6C,oBApEL,EAqEI,oBAAC,KAAD;AACI,QAAA,MAAM,EAAE,KAAK7F,KAAL,CAAW8D,SADvB,CAEI;AAFJ;AAGI,QAAA,cAAc,EAAE,0BAAI;AAAC,UAAA,MAAI,CAACjD,QAAL,CAAc;AAACiD,YAAAA,SAAS,EAAE;AAAZ,WAAd;AAAkC,SAH3D;AAII,QAAA,KAAK,EAAE0D,YAJX;AAKI,QAAA,YAAY,EAAC,eALjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOI;AAAK,QAAA,KAAK,EAAElB,MAAM,CAACmB,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sDAPJ,EAQI;AAAK,QAAA,KAAK,EAAEnB,MAAM,CAACmB,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kEAA5B,CARJ,EASI;AAAK,QAAA,KAAK,EAAEnB,MAAM,CAACzC,MAAnB;AAA2B,QAAA,GAAG,EAAE,KAAK7D,KAAL,CAAW4D,KAA3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QATJ,CArEJ,EAgFI,oBAAC,KAAD;AAAO,QAAA,IAAI,EAAC,mBAAZ;AAAgC,QAAA,IAAI,EAAE,KAAK5D,KAAL,CAAW0H,OAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAhFJ,EAiFI,oBAAC,KAAD;AAAO,QAAA,IAAI,EAAC,SAAZ;AAAsB,QAAA,IAAI,EAAE,KAAK1H,KAAL,CAAWc,OAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAjFJ,CADJ;AAqFH;;;;EAxVyBjC,S;;AA2V9B,IAAMyH,MAAM,GAAG;AACXQ,EAAAA,cAAc,EAAE;AACZa,IAAAA,eAAe,EAAE7I,MAAM,CAAC8I,cADZ;AAEZC,IAAAA,OAAO,EAAE,KAFG;AAGZC,IAAAA,QAAQ,EAAE;AAHE,GADL;AAMXf,EAAAA,aAAa,EAAE;AACXC,IAAAA,KAAK,EAAElI,MAAM,CAACiJ,YADH;AAEXC,IAAAA,aAAa,EAAE,MAFJ;AAGXC,IAAAA,OAAO,EAAE,MAHE;AAIXC,IAAAA,aAAa,EAAE,SAJJ;AAKXC,IAAAA,oBAAoB,EAAE,eALX;AAMXC,IAAAA,UAAU,EAAE,SAND;AAOXC,IAAAA,cAAc,EAAE;AAPL,GANJ;AAeXlB,EAAAA,aAAa,EAAE;AACXH,IAAAA,KAAK,EAAElI,MAAM,CAACiJ,YADH;AAEXO,IAAAA,SAAS,EAAE,QAFA;AAGXN,IAAAA,aAAa,EAAE;AAHJ,GAfJ;AAoBXzB,EAAAA,WAAW,EAAE;AACT0B,IAAAA,OAAO,EAAE,MADA;AAETM,IAAAA,aAAa,EAAE,KAFN;AAGTP,IAAAA,aAAa,EAAE;AAHN,GApBF;AAyBXxB,EAAAA,aAAa,EAAE;AACXgC,IAAAA,IAAI,EAAE;AADK,GAzBJ;AA4BX/B,EAAAA,MAAM,EAAE;AACJgC,IAAAA,KAAK,EAAE,MADH;AAEJrB,IAAAA,MAAM,EAAE,MAFJ;AAGJsB,IAAAA,YAAY,EAAE;AAHV,GA5BG;AAiCXhC,EAAAA,YAAY,EAAE;AACVuB,IAAAA,OAAO,EAAE,MADC;AAEVM,IAAAA,aAAa,EAAE,QAFL;AAGVC,IAAAA,IAAI,EAAE,IAHI;AAIVG,IAAAA,WAAW,EAAE,KAJH;AAKVC,IAAAA,UAAU,EAAE;AALF,GAjCH;AAwCXjC,EAAAA,IAAI,EAAE;AACFK,IAAAA,KAAK,EAAElI,MAAM,CAACiJ;AADZ,GAxCK;AA2CXlB,EAAAA,WAAW,EAAE;AACTG,IAAAA,KAAK,EAAElI,MAAM,CAAC+J,SADL;AAETC,IAAAA,YAAY,EAAE;AAFL;AA3CF,CAAf;AAiDA,eAAehJ,eAAf","sourcesContent":["import React, { Component } from \"react\";\nimport Colors from \"../../../constants/Colors\";\nimport ItemService from \"../../../service/ItemService\";\nimport \"weui\";\nimport \"react-weui/build/packages/react-weui.css\";\nimport {\n    Button,\n    Popup,\n    Article,\n    CellsTitle,\n    Form,\n    FormCell,\n    CellBody,\n    TextArea,\n    Dialog,\n    Toast\n} from \"react-weui/build/packages\";\nimport UtilsService from \"../../../service/UtilsService\";\nimport { Config } from \"../../../Config\";\nimport AuthService from \"../../../service/AuthService\";\nimport Modal from \"react-modal\";\nclass ArticleComments extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            disabled: false,\n            showToast: false,\n            showLoading: false,\n            toastTimer: null,\n            loadingTimer: null,\n            item: this.props.item,\n            defaultImage: \"../../../static/assets/default_item.png\",\n            newComment: false,\n            showDialog: false,\n            dialog: {\n                title: \"确认删除此条留言？\",\n                buttons: [\n                    {\n                        type: \"default\",\n                        label: \"取消\",\n                        onClick: this.hideDialog.bind(this)\n                    },\n                    {\n                        type: \"warn\",\n                        label: \"确认\",\n                        onClick: this.deleteComment.bind(this)\n                    }\n                ]\n            }\n        };\n        this.handleChange = this.handleChange.bind(this);\n        this.showToast = this.showToast.bind(this);\n    }\n    hideDialog() {\n        this.setState({\n            showDialog: false\n        });\n    }\n    handleChange(e) {\n        this.setState({ newComment: e.target.value });\n    }\n    deleteComment() {\n        this.setState({ showLoading: true });\n        this.hideDialog();\n        let params = {\n            item_url: \"https://www.showmine66.com/ma/i/\" + this.state.item.id\n        };\n        ItemService.updateItemNormalComment(this.state.targetComment, params)\n            .then(response => response.json())\n            .then(responseJson => {\n                this.setState(\n                    {\n                        showLoading: false,\n                        res: responseJson\n                    },\n                    () => {\n                        this.showToast();\n                    }\n                );\n                this.getItemNormalCommentList();\n            })\n            .catch(error => {\n                console.error(error);\n            });\n    }\n    componentWillUnmount(){\n        clearInterval(this.state.interval)\n    }\n\n    getLoginStatus= () => {\n        if(this.state.subscribeLoginLogId) {\n            AuthService.checkLoginStatus(this.state.subscribeLoginLogId || null)\n                .then(response => response.text())\n                .then(resp => {\n                    var res = JSON.parse(resp)\n                    if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n                        this.setState({\n                            loading: true\n                        })\n                        this.loginWithTempCode(res.log.tmp_token.trim())\n                    }\n                })\n        }\n    }\n\n    loginWithTempCode = (tmpToken) => {\n        AuthService.loginWithTempCode(tmpToken)\n            .then(response => response.text())\n            .then(resp => {\n                var res = JSON.parse(resp)\n                if (res.return_code){\n                    localStorage.setItem('userToken', res.return_code);\n                    localStorage.setItem('isLogIn', true);\n                }\n                let params ={};\n                AuthService.getMe(params)\n                    .then((response) => response.json())\n                    .then((responseJson) => {\n                        localStorage.setItem('userObject', JSON.stringify(responseJson));\n                    })\n                    .then(() => {location.reload();\n                    })\n                    .catch((error) => {\n                        console.error(error);\n                    });\n            })\n    }\n\n    componentDidMount() {\n        this.getItemNormalCommentList();\n    }\n    componentWillUnmount() {\n        this.state.loadingTimer && clearTimeout(this.state.loadingTimer);\n        this.state.toastTimer && clearTimeout(this.state.toastTimer);\n    }\n    showToast() {\n        this.setState({ showToast: true });\n\n        this.state.toastTimer = setTimeout(() => {\n            this.setState({ showToast: false });\n        }, 1500);\n    }\n    getItemNormalCommentList = () => {\n        let params = {};\n        ItemService.getItemNormalCommentList(this.state.item.id, params)\n            .then(response => response.json())\n            .then(responseJson => {\n                this.setState({\n                    commentList: responseJson.data\n                });\n            })\n            .catch(error => {\n                console.error(error);\n            });\n    };\n    postItemNormalComment = () => {\n        this.setState({ disabled: true, showLoading: true });\n        let params = {\n            comments: this.state.newComment,\n            item_url: \"https://react.showmine66.com/itemDetails?itemId=\" + this.state.item.id,\n            is_broadcast: false,\n            is_private: false,\n            state_redirect_obj: {\n                url: UtilsService.getWebAddress()\n                // url: \"http://localhost:3000\",\n            },\n            wechat_auth_url:\n                \"http://localhost:8888/a/wu?domain=http%253A%252F%252Flocalhost%253A8888&origurl=http%253A%252F%252Flocalhost%253A8888%252Fma%252Fi%252Ff187861730fbfe9cf62b110013bcfc4d%252F%2523app-top\"\n        };\n        ItemService.postItemNormalComment(this.state.item.id, params)\n            .then(response => response.json())\n            .then(responseJson => {\n                this.setState({\n                    res: responseJson,\n                    newComment: false\n                });\n                this.state.loadingTimer = setTimeout(() => {\n                    this.setState({ showLoading: false }, () => {\n                        this.setState({ fullpage_show: false, disabled: false }, () => {\n                            this.showToast();\n                        });\n                    });\n                }, 1000);\n                this.getItemNormalCommentList();\n            })\n            .catch(error => {\n                console.error(error);\n            });\n    };\n    weChatLogin() {\n        let origUrl = window.location.href;\n        let authUrl = Config.webAddress + \"AuthPage\";\n        AuthService.wechatLogin(origUrl, authUrl, {})\n            .then(response => response.json())\n            .then(responseJson => {\n                window.open(responseJson.auth_url, \"_self\");\n            })\n            .catch(error => {\n                alert(error);\n            });\n    }\n    handleClick = () => {\n        if (this.props.isLogin) {\n            this.setState({ fullpage_show: true });\n        } else {\n            if (UtilsService.openedInWeChat()) {\n                this.weChatLogin()\n            } else {\n                let getLoginStatus = this.getLoginStatus\n                var params = {\n                    companyId: company.id,\n                    itemId: item && item.id\n                }\n                AuthService.getLoginSubscribeQrCode(params)\n                    .then(response => response.text())\n                    .then(resp => {\n                        var res = JSON.parse(resp)\n                        let interval = setInterval(getLoginStatus,1000);\n                        this.setState({\n                            qrUrl: res.qrcode,\n                            subscribeLoginLogId: res.subscribeLoginLogId,\n                            showModal: true,\n                            interval: interval\n                        })\n                    })\n            }\n        }\n    };\n    render() {\n        const isAdmin = this.props.isAdmin ? this.props.isAdmin : false;\n        const commentList = this.state.commentList;\n        let commentListComponent = undefined;\n        if (commentList && commentList.length > 0) {\n            commentListComponent = commentList.map((comment, id) => {\n                let user = comment.created_by;\n                let imageUrl =\n                    user.avatar_img && user.avatar_img > \"\"\n                        ? user.avatar_img\n                        : this.state.defaultImage;\n                return (\n                    <div key={id} style={styles.commentBody}>\n                        <div style={styles.avatarWrapper}>\n                            <img src={imageUrl} style={styles.avatar} />\n                        </div>\n\n                        <div style={styles.nameNComment}>\n                            <p style={styles.name}>{user.nick_name}</p>\n                            <p style={styles.commentText}>{comment.comments}</p>\n                        </div>\n                        {isAdmin ? (\n                            <div>\n                                <Button\n                                    type=\"warn\"\n                                    size=\"small\"\n                                    onClick={e =>\n                                        this.setState({\n                                            showDialog: true,\n                                            targetComment: comment.id\n                                        })\n                                    }\n                                >\n                                    删除\n                                </Button>\n                                <Dialog\n                                    type=\"ios\"\n                                    title={this.state.dialog.title}\n                                    buttons={this.state.dialog.buttons}\n                                    show={this.state.showDialog}\n                                >\n                                    删除后无法撤回\n                                </Dialog>\n                            </div>\n                        ) : (\n                            \"\"\n                        )}\n                    </div>\n                );\n            });\n        }\n\n        return (\n            <div style={styles.commentWrapper}>\n                <Toast icon=\"loading\" show={this.state.showLoading}>\n                    请稍后...\n                </Toast>\n                <Toast icon=\"success-no-circle\" show={this.state.showToast}>\n                    成功\n                </Toast>\n                {commentListComponent ? (\n                    <div style={styles.commentHeader}>\n                        <div>精选留言</div>\n                        <div\n                            style={{ color: Colors.fontColorLink }}\n                            onClick={e => this.handleClick()}\n                        >\n                            写留言\n                        </div>\n                    </div>\n                ) : (\n                    <div style={styles.noCommentHint}>\n                        <div\n                            style={{ color: Colors.fontColorLink }}\n                            onClick={e => this.handleClick()}\n                        >\n                            写留言\n                        </div>\n                    </div>\n                )}\n                <div style={styles.commentHeader}>\n                    <Popup\n                        show={this.state.fullpage_show}\n                        onRequestClose={e => this.setState({ fullpage_show: false })}\n                    >\n                        <div style={{ height: \"100vh\", overflow: \"scroll\" }}>\n                            <Article>\n                                <Toast icon=\"loading\" show={this.state.showLoading}>\n                                    请稍后...\n                                </Toast>\n                                <CellsTitle style={{ marginTop: \"40px\" }}>新建留言</CellsTitle>\n                                <Form style={{ marginBottom: \"20px\" }}>\n                                    <FormCell>\n                                        <CellBody>\n                                            <TextArea\n                                                placeholder=\"留言后将对所有人可见，最多50字\"\n                                                rows=\"3\"\n                                                maxlength=\"50\"\n                                                onChange={this.handleChange}\n                                            ></TextArea>\n                                        </CellBody>\n                                    </FormCell>\n                                </Form>\n                                <Button\n                                    type=\"primary\"\n                                    plain\n                                    disabled={!this.state.newComment || this.state.disabled}\n                                    onClick={e => this.postItemNormalComment()}\n                                >\n                                    发布留言\n                                </Button>\n                                <Button\n                                    type=\"warn\"\n                                    onClick={e => this.setState({ fullpage_show: false })}\n                                >\n                                    取消\n                                </Button>\n                            </Article>\n                        </div>\n                    </Popup>\n                </div>\n                {commentListComponent}\n                <Modal\n                    isOpen={this.state.showModal}\n                    // onAfterOpen={() => {this.getQrCode(item)}}\n                    onRequestClose={()=>{this.setState({showModal: false})}}\n                    style={customStyles}\n                    contentLabel=\"Example Modal\"\n                >\n                    <div style={styles.qrTitle}>扫码关注该公司</div>\n                    <div style={styles.qrTitle}><small>将更及时的收到推送</small></div>\n                    <img style={styles.qrcode} src={this.state.qrUrl}/>\n                </Modal>\n                <Toast icon=\"success-no-circle\" show={this.state.success}>Success</Toast>\n                <Toast icon=\"loading\" show={this.state.loading}>Loading...</Toast>\n            </div>\n        );\n    }\n}\n\nconst styles = {\n    commentWrapper: {\n        backgroundColor: Colors.formBackground,\n        padding: \"4vw\",\n        fontSize: \"14px\"\n    },\n    commentHeader: {\n        color: Colors.formFontGray,\n        paddingBottom: \"20px\",\n        display: \"flex\",\n        WebkitBoxPack: \"justify\",\n        WebkitJustifyContent: \"space-between\",\n        MsFlexPack: \"justify\",\n        justifyContent: \"space-between\"\n    },\n    noCommentHint: {\n        color: Colors.formFontGray,\n        textAlign: \"center\",\n        paddingBottom: \"20px\"\n    },\n    commentBody: {\n        display: \"flex\",\n        flexDirection: \"row\",\n        paddingBottom: \"20px\"\n    },\n    avatarWrapper: {\n        flex: \"1\"\n    },\n    avatar: {\n        width: \"32px\",\n        height: \"32px\",\n        borderRadius: \"4px\"\n    },\n    nameNComment: {\n        display: \"flex\",\n        flexDirection: \"column\",\n        flex: \"10\",\n        paddingLeft: \"3vw\",\n        lineHeight: \"normal\"\n    },\n    name: {\n        color: Colors.formFontGray\n    },\n    commentText: {\n        color: Colors.fontColor,\n        paddingRight: \"5vw\"\n    }\n};\n\nexport default ArticleComments;\n"]},"metadata":{},"sourceType":"module"}