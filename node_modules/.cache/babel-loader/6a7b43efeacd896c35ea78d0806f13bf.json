{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/Zac/Sysbox/SHM/react/shm-react/my-app/pages/itemDetails.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport 'weui';\nimport 'react-weui/build/packages/react-weui.css';\nimport ItemService from '../service/ItemService';\nimport SiteHeader from '../components/Common/SiteHeader';\nimport SiteFooter from \"../components/Common/SiteFooter\";\nimport JieLongDetailComponent from \"../components/ItemDetails/JieLongDetails/JieLongDetailComponent\";\nimport ProductDetailComponent from \"../components/ItemDetails/ProductDetails/ProductDetailComponent\";\nimport ArticleDetailComponent from \"../components/ItemDetails/ArticleDetails/ArticleDetailComponent\";\nimport RegistrationDetailComponent from \"../components/ItemDetails/RegistrationDetails/RegistrationDetailComponent\";\nimport WeChatService from '../service/WeChatService';\nimport CompanyService from '../service/CompanyService';\nimport UtilsService from \"../service/UtilsService\";\nimport { Row, Col, Container } from 'react-bootstrap';\nimport AuthService from \"../service/AuthService\";\nimport { withRouter } from \"next/router\";\nimport ReactGA from 'react-ga';\n\nvar itemDetails =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(itemDetails, _Component);\n\n  function itemDetails(props) {\n    var _this;\n\n    _classCallCheck(this, itemDetails);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(itemDetails).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"recordVisitHistory\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var itemId, from, sharerId, params;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (_this.props.router && _this.props.router.query && _this.props.router.query.from && _this.props.router.query.itemId) {\n                itemId = _this.props.router.query.itemId;\n                from = _this.props.router.query.from;\n                sharerId = _this.props.router.query.sharerId;\n                params = {\n                  itemId: itemId,\n                  from: from,\n                  sharerId: sharerId,\n                  fromWeChat: true // await ItemService.recordVisitHistory(params)\n\n                };\n              }\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"weChatShare\", function () {\n      var item = _this.state.item;\n      var currentUrl = _this.state.currentUrl;\n\n      if (localStorage.getItem('userObject')) {\n        currentUrl = new URL(currentUrl);\n        currentUrl = currentUrl + '&sharerId=' + JSON.parse(localStorage.getItem('userObject')).id;\n      }\n\n      console.log(currentUrl);\n      var imageSize = 'SMALL';\n      var descWithoutHtml = UtilsService.stripHtmlTags(item.description);\n      WeChatService.runWhenWXReady(function () {\n        wx.onMenuShareAppMessage({\n          title: item.title,\n          desc: descWithoutHtml,\n          link: currentUrl,\n          imgUrl: UtilsService.getItemImgUrlWithSize(item, imageSize)\n        });\n        wx.onMenuShareTimeline({\n          title: item.title,\n          link: currentUrl,\n          imgUrl: UtilsService.getItemImgUrlWithSize(item, imageSize)\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginWithTempCode\", function (tmpToken) {\n      AuthService.loginWithTempCode(tmpToken).then(function (response) {\n        return response.text();\n      }).then(function (resp) {\n        var res = JSON.parse(resp);\n\n        if (res.return_code) {\n          localStorage.setItem('userToken', res.return_code);\n          localStorage.setItem('isLogIn', true);\n        }\n\n        var params = {};\n        AuthService.getMe(params).then(function (response) {\n          return response.json();\n        }).then(function (responseJson) {\n          localStorage.setItem('userObject', _JSON$stringify(responseJson));\n        }).then(function () {\n          location.reload();\n        }).catch(function (error) {\n          console.error(error);\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getLoginStatus\", function () {\n      if (!UtilsService.openedInWeChat() && !localStorage.getItem('userToken')) {\n        if (_this.state.subscribeLoginLogId) {\n          AuthService.checkLoginStatus(_this.state.subscribeLoginLogId || null).then(function (response) {\n            return response.text();\n          }).then(function (resp) {\n            var res = JSON.parse(resp);\n\n            if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n              _this.setState({\n                loading: true\n              });\n\n              _this.loginWithTempCode(res.log.tmp_token.trim());\n            }\n          });\n        }\n      } else {\n        clearInterval(_this.state.interval);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCompanyQrCode\", function (item) {\n      // let params = {\n      //     itemId: item.id\n      // };\n      var getLoginStatus = _this.getLoginStatus;\n      var params = {\n        companyId: item && item.company && item.company.id,\n        itemId: item && item.id\n      };\n      AuthService.getLoginSubscribeQrCode(params).then(function (response) {\n        return response.text();\n      }).then(function (response) {\n        var res = JSON.parse(response);\n        var interval = setInterval(getLoginStatus, 1000);\n\n        _this.setState({\n          qrUrl: res.qrcode,\n          subscribeLoginLogId: res.subscribeLoginLogId,\n          interval: interval\n        });\n      });\n    });\n\n    _this.state = {\n      item: _this.props.item,\n      isLogin: false,\n      itemType: _this.props.item.id === 'eab78ee2a24d469dbd09f46dd68e804f' || _this.props.item.id === 'e01a8e15fa5234f20cda8a672047bb76' ? 'REGISTRATION' : _this.props.item.predefinedTags['1']\n    };\n    return _this;\n  }\n\n  _createClass(itemDetails, [{\n    key: \"initializeReactGA\",\n    value: function initializeReactGA() {\n      ReactGA.initialize('UA-101510131-7'); // ReactGA.initialize('UA-154886136-1');\n\n      ReactGA.pageview('/itemDetails');\n      ReactGA.event({\n        category: 'ItemDetails',\n        action: 'View item details'\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.getCompanyQrCode(this.state.item);\n      this.setState({\n        isLogin: localStorage.getItem('isLogIn'),\n        currentUrl: window.location.href\n      }, function () {\n        setTimeout(function () {\n          _this2.weChatShare();\n        }, 300);\n      });\n      this.recordVisitHistory();\n      this.initializeReactGA();\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(object, nextProps) {\n      var _this3 = this;\n\n      this.setState({\n        item: object.item,\n        currentUrl: window.location.href,\n        itemType: object.item.predefinedTags['1']\n      }, function () {\n        setTimeout(function () {\n          _this3.weChatShare();\n        }, 500);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var item = this.state.item ? this.state.item : undefined;\n      var isLogin = this.state.isLogin;\n\n      if (item) {\n        var itemView = function itemView() {\n          switch (_this4.state.itemType) {\n            case 'JIE LONG':\n              return React.createElement(JieLongDetailComponent, {\n                isLogin: isLogin,\n                item: item,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 185\n                },\n                __self: this\n              });\n\n            case 'product':\n              return React.createElement(ProductDetailComponent, {\n                isLogin: isLogin,\n                item: item,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 188\n                },\n                __self: this\n              });\n\n            case 'CONSULTATION':\n              return React.createElement(ArticleDetailComponent, {\n                isLogin: isLogin,\n                item: item,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 191\n                },\n                __self: this\n              });\n\n            case 'REGISTRATION':\n              return React.createElement(RegistrationDetailComponent, {\n                isLogin: isLogin,\n                item: item,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 194\n                },\n                __self: this\n              });\n\n            default:\n              return React.createElement(ProductDetailComponent, {\n                isLogin: isLogin,\n                item: item,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 197\n                },\n                __self: this\n              });\n          }\n        };\n\n        return React.createElement(\"div\", {\n          className: \"App\",\n          key: item.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 202\n          },\n          __self: this\n        }, React.createElement(Container, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 203\n          },\n          __self: this\n        }, React.createElement(Row, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 204\n          },\n          __self: this\n        }, React.createElement(Col, {\n          sm: 12,\n          md: 8,\n          className: \"col-md-offset-2\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }, React.createElement(SiteHeader, {\n          show: this.state.itemType !== 'CONSULTATION',\n          company: item.company ? item.company : undefined,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211\n          },\n          __self: this\n        }), itemView(), React.createElement(SiteFooter, {\n          show: this.state.itemType !== 'CONSULTATION',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213\n          },\n          __self: this\n        })), React.createElement(Col, {\n          sm: 12,\n          md: 2,\n          className: \"sticky\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 215\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: styles.qrTitle,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 216\n          },\n          __self: this\n        }, \"\\u626B\\u7801\\u5173\\u6CE8\\u8BE5\\u516C\\u53F8\"), React.createElement(\"div\", {\n          style: styles.qrTitle,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 217\n          },\n          __self: this\n        }, React.createElement(\"small\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 217\n          },\n          __self: this\n        }, \"\\u5C06\\u66F4\\u53CA\\u65F6\\u7684\\u6536\\u5230\\u63A8\\u9001\")), React.createElement(\"img\", {\n          style: styles.qrcode,\n          src: this.state.qrUrl,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 218\n          },\n          __self: this\n        })))));\n      } else return null;\n    }\n  }]);\n\n  return itemDetails;\n}(Component);\n\n_defineProperty(itemDetails, \"getInitialProps\",\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(_ref2) {\n    var req, query, res, json;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            req = _ref2.req, query = _ref2.query;\n\n            if (!query.itemId) {\n              _context2.next = 7;\n              break;\n            }\n\n            _context2.next = 4;\n            return ItemService.getItemDetail(query.itemId);\n\n          case 4:\n            _context2.t0 = _context2.sent;\n            _context2.next = 10;\n            break;\n\n          case 7:\n            _context2.next = 9;\n            return ItemService.getItemDetail('26aeddb5e3bb4985102e232b35c97bfd');\n\n          case 9:\n            _context2.t0 = _context2.sent;\n\n          case 10:\n            res = _context2.t0;\n            _context2.next = 13;\n            return res.json();\n\n          case 13:\n            json = _context2.sent;\n            return _context2.abrupt(\"return\", {\n              item: json\n            });\n\n          case 15:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function (_x) {\n    return _ref3.apply(this, arguments);\n  };\n}());\n\nvar styles = {\n  qrcode: {\n    width: '100%'\n  },\n  qrTitle: {\n    width: '100%',\n    textAlign: 'center'\n  }\n};\nexport default withRouter(itemDetails);","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM/react/shm-react/my-app/pages/itemDetails.js"],"names":["React","Component","ItemService","SiteHeader","SiteFooter","JieLongDetailComponent","ProductDetailComponent","ArticleDetailComponent","RegistrationDetailComponent","WeChatService","CompanyService","UtilsService","Row","Col","Container","AuthService","withRouter","ReactGA","itemDetails","props","router","query","from","itemId","sharerId","params","fromWeChat","item","state","currentUrl","localStorage","getItem","URL","JSON","parse","id","console","log","imageSize","descWithoutHtml","stripHtmlTags","description","runWhenWXReady","wx","onMenuShareAppMessage","title","desc","link","imgUrl","getItemImgUrlWithSize","onMenuShareTimeline","tmpToken","loginWithTempCode","then","response","text","resp","res","return_code","setItem","getMe","json","responseJson","location","reload","catch","error","openedInWeChat","subscribeLoginLogId","checkLoginStatus","tmp_token","trim","setState","loading","clearInterval","interval","getLoginStatus","companyId","company","getLoginSubscribeQrCode","setInterval","qrUrl","qrcode","isLogin","itemType","predefinedTags","initialize","pageview","event","category","action","getCompanyQrCode","window","href","setTimeout","weChatShare","recordVisitHistory","initializeReactGA","object","nextProps","undefined","itemView","styles","qrTitle","req","getItemDetail","width","textAlign"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport 'weui';\nimport 'react-weui/build/packages/react-weui.css';\nimport ItemService from '../service/ItemService';\nimport SiteHeader from '../components/Common/SiteHeader';\nimport SiteFooter from \"../components/Common/SiteFooter\";\nimport JieLongDetailComponent from \"../components/ItemDetails/JieLongDetails/JieLongDetailComponent\";\nimport ProductDetailComponent from \"../components/ItemDetails/ProductDetails/ProductDetailComponent\";\nimport ArticleDetailComponent from \"../components/ItemDetails/ArticleDetails/ArticleDetailComponent\";\nimport RegistrationDetailComponent from \"../components/ItemDetails/RegistrationDetails/RegistrationDetailComponent\";\nimport WeChatService from '../service/WeChatService';\nimport CompanyService from '../service/CompanyService';\nimport UtilsService from \"../service/UtilsService\";\nimport { Row, Col, Container } from 'react-bootstrap';\nimport AuthService from \"../service/AuthService\";\nimport {withRouter} from \"next/router\";\nimport ReactGA from 'react-ga';\n\n\nclass itemDetails extends Component {\n    constructor(props){\n        super(props);\n        this.state = {\n            item: this.props.item,\n            isLogin: false,\n            itemType: (this.props.item.id === 'eab78ee2a24d469dbd09f46dd68e804f') || (this.props.item.id === 'e01a8e15fa5234f20cda8a672047bb76') ? 'REGISTRATION' : this.props.item.predefinedTags['1']\n        };\n    }\n\n    static getInitialProps = async({ req, query }) => {\n        let res = query.itemId ?\n            await ItemService.getItemDetail(query.itemId) :\n            await ItemService.getItemDetail('26aeddb5e3bb4985102e232b35c97bfd'); // a3067bcbd7521b4965ef8b43394aa011\n        const json = await res.json();\n        return {item: json};\n    };\n\n    initializeReactGA() {\n        ReactGA.initialize('UA-101510131-7');\n        // ReactGA.initialize('UA-154886136-1');\n        ReactGA.pageview('/itemDetails');\n        ReactGA.event({\n            category: 'ItemDetails',\n            action: 'View item details'\n        });\n    }\n\n    componentDidMount() {\n        this.getCompanyQrCode(this.state.item);\n        this.setState({\n            isLogin: localStorage.getItem('isLogIn'),\n            currentUrl: window.location.href\n        }, () => { setTimeout(()=>{\n            this.weChatShare()\n        }, 300);\n        });\n        this.recordVisitHistory();\n        this.initializeReactGA();\n    }\n\n    componentWillReceiveProps(object, nextProps) {\n        this.setState({\n            item: object.item,\n            currentUrl: window.location.href,\n            itemType: object.item.predefinedTags['1']\n        }, () => { setTimeout(()=>{\n            this.weChatShare()\n        }, 500);\n        });\n    }\n\n    recordVisitHistory = async () => {\n        if (this.props.router && this.props.router.query && this.props.router.query.from && this.props.router.query.itemId) {\n            let itemId = this.props.router.query.itemId;\n            let from = this.props.router.query.from;\n            let sharerId = this.props.router.query.sharerId;\n            let params = {\n                itemId,\n                from,\n                sharerId,\n                fromWeChat: true\n            }\n            // await ItemService.recordVisitHistory(params)\n        }\n    }\n\n    weChatShare = () => {\n        let item = this.state.item;\n        let currentUrl = this.state.currentUrl;\n        if (localStorage.getItem('userObject')) {\n            currentUrl = new URL(currentUrl)\n            currentUrl = currentUrl + '&sharerId=' + JSON.parse(localStorage.getItem('userObject')).id\n        }\n        console.log(currentUrl)\n        let imageSize = 'SMALL';\n        let descWithoutHtml = UtilsService.stripHtmlTags(item.description);\n        WeChatService.runWhenWXReady(function () {\n            wx.onMenuShareAppMessage({\n                title: item.title,\n                desc: descWithoutHtml,\n                link: currentUrl,\n                imgUrl: UtilsService.getItemImgUrlWithSize(item, imageSize)\n            });\n            wx.onMenuShareTimeline({\n                title: item.title,\n                link: currentUrl,\n                imgUrl: UtilsService.getItemImgUrlWithSize(item, imageSize)\n            });\n        });\n    };\n\n    loginWithTempCode = (tmpToken) => {\n        AuthService.loginWithTempCode(tmpToken)\n            .then(response => response.text())\n            .then(resp => {\n                var res = JSON.parse(resp)\n                if (res.return_code){\n                    localStorage.setItem('userToken', res.return_code);\n                    localStorage.setItem('isLogIn', true);\n                }\n                let params ={};\n                AuthService.getMe(params)\n                    .then((response) => response.json())\n                    .then((responseJson) => {\n                        localStorage.setItem('userObject', JSON.stringify(responseJson));\n                    })\n                    .then(() => {location.reload();\n                    })\n                    .catch((error) => {\n                        console.error(error);\n                    });\n            })\n    }\n\n    getLoginStatus = () => {\n        if (!UtilsService.openedInWeChat() && !localStorage.getItem('userToken')) {\n            if(this.state.subscribeLoginLogId) {\n                AuthService.checkLoginStatus(this.state.subscribeLoginLogId || null)\n                    .then(response => response.text())\n                    .then(resp => {\n                        var res = JSON.parse(resp)\n                        if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n                            this.setState({\n                                loading: true\n                            })\n                            this.loginWithTempCode(res.log.tmp_token.trim())\n                        }\n                    })\n            }\n        } else {\n            clearInterval(this.state.interval)\n        }\n    }\n\n    getCompanyQrCode =  item => {\n        // let params = {\n        //     itemId: item.id\n        // };\n        var getLoginStatus = this.getLoginStatus\n        var params = {\n            companyId: item && item.company && item.company.id,\n            itemId: item && item.id\n        }\n        AuthService.getLoginSubscribeQrCode( params)\n            .then(response => response.text())\n            .then(response => {\n                var res = JSON.parse(response)\n                let interval = setInterval(getLoginStatus,1000);\n                this.setState({\n                    qrUrl: res.qrcode,\n                    subscribeLoginLogId: res.subscribeLoginLogId,\n                    interval: interval\n                })\n            })\n    }\n\n    render() {\n        const item = this.state.item ? this.state.item : undefined;\n        const isLogin = this.state.isLogin;\n        if (item) {\n            const itemView = () => {\n                switch(this.state.itemType) {\n                    case 'JIE LONG':\n                        return <JieLongDetailComponent isLogin={isLogin} item={item} />;\n\n                    case 'product':\n                        return <ProductDetailComponent isLogin={isLogin} item={item} />;\n\n                    case 'CONSULTATION':\n                        return <ArticleDetailComponent isLogin={isLogin} item={item} />;\n\n                    case 'REGISTRATION':\n                        return <RegistrationDetailComponent isLogin={isLogin} item={item} />;\n\n                    default:\n                        return <ProductDetailComponent isLogin={isLogin} item={item} />;\n                }\n            };\n\n            return (\n                <div className=\"App\" key={item.id}>\n                    <Container>\n                        <Row>\n                            {/*<Col sm=\"12\" lg={{ span: 8, offset: 2 }}>*/}\n                            {/*    <SiteHeader show={this.state.itemType !== 'CONSULTATION'} company={item.company ? item.company : undefined}/>*/}\n                            {/*    { itemView() }*/}\n                            {/*    <SiteFooter show={this.state.itemType !== 'CONSULTATION'}/>*/}\n                            {/*</Col>*/}\n                            <Col sm={12} md={8} className=\"col-md-offset-2\">\n                                <SiteHeader show={this.state.itemType !== 'CONSULTATION'} company={item.company ? item.company : undefined}/>\n                                { itemView() }\n                                <SiteFooter show={this.state.itemType !== 'CONSULTATION'}/>\n                            </Col>\n                            <Col sm={12} md={2} className=\"sticky\">\n                                <div style={styles.qrTitle}>扫码关注该公司</div>\n                                <div style={styles.qrTitle}><small>将更及时的收到推送</small></div>\n                                <img style={styles.qrcode} src={this.state.qrUrl}/>\n                            </Col>\n                        </Row>\n                    </Container>\n                </div>\n\n            );\n        }\n        else return null;\n    }\n}\n\nconst styles = {\n    qrcode: {\n        width: '100%',\n    },\n    qrTitle: {\n        width: '100%',\n        textAlign: 'center'\n    },\n};\n\nexport default withRouter(itemDetails);\n"]},"metadata":{},"sourceType":"module"}