{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React, { Component } from 'react';\nimport ArticleContent from \"./ArticleContent\";\nimport ArticleComments from \"./ArticleComments\";\nimport UtilsService from \"../../../service/UtilsService\";\nimport AuthService from \"../../../service/AuthService\";\nimport { Config } from \"../../../Config\";\nimport EditButton from \"../../../components/ItemDetails/ArticleDetails/EditButton\";\nimport { Button, Toast } from \"react-weui\";\nimport Lang from \"../../../lang/Lang\";\nimport Modal from \"react-modal\";\nvar styles = {\n  loginButton: {\n    width: '100%'\n  }\n};\n\nvar ArticleDetailComponent =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ArticleDetailComponent, _Component);\n\n  function ArticleDetailComponent(props) {\n    var _this;\n\n    _classCallCheck(this, ArticleDetailComponent);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ArticleDetailComponent).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"getLoginStatus\", function () {\n      if (_this.state.subscribeLoginLogId) {\n        AuthService.checkLoginStatus(_this.state.subscribeLoginLogId || null).then(function (response) {\n          return response.text();\n        }).then(function (resp) {\n          var res = JSON.parse(resp);\n\n          if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n            _this.setState({\n              loading: true\n            });\n\n            _this.loginWithTempCode(res.log.tmp_token.trim());\n          }\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginWithTempCode\", function (tmpToken) {\n      AuthService.loginWithTempCode(tmpToken).then(function (response) {\n        return response.text();\n      }).then(function (resp) {\n        var res = JSON.parse(resp);\n\n        if (res.return_code) {\n          localStorage.setItem('userToken', res.return_code);\n          localStorage.setItem('isLogIn', true);\n        }\n\n        var params = {};\n        AuthService.getMe(params).then(function (response) {\n          return response.json();\n        }).then(function (responseJson) {\n          localStorage.setItem('userObject', _JSON$stringify(responseJson));\n        }).then(function () {\n          location.reload();\n        }).catch(function (error) {\n          console.error(error);\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleLogin\", function (item) {\n      if (UtilsService.openedInWeChat()) {\n        _this.weChatLogin();\n      } else {\n        var getLoginStatus = _this.getLoginStatus;\n        var params = {\n          companyId: item && item.company && item.company.id,\n          itemId: item && item.id\n        };\n        AuthService.getLoginSubscribeQrCode(params).then(function (response) {\n          return response.text();\n        }).then(function (resp) {\n          var res = JSON.parse(resp);\n          var interval = setInterval(getLoginStatus, 1000);\n\n          _this.setState({\n            qrUrl: res.qrcode,\n            subscribeLoginLogId: res.subscribeLoginLogId,\n            showModal: true,\n            interval: interval\n          });\n        });\n      }\n    });\n\n    _this.state = {\n      isLogin: _this.props.isLogin ? _this.props.isLogin : undefined,\n      item: _this.props.item\n    };\n    return _this;\n  }\n\n  _createClass(ArticleDetailComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setState({\n        isLogin: localStorage.getItem('isLogIn')\n      }, function () {\n        if (_this2.state.isLogin) {\n          var user = JSON.parse(localStorage.getItem('userObject'));\n\n          _this2.setState({\n            isAdmin: UtilsService.getIsCompanyAdmin(user, _this2.state.item.company_id)\n          });\n        }\n      });\n    }\n  }, {\n    key: \"weChatLogin\",\n    value: function weChatLogin() {\n      var origUrl = window.location.href;\n      var authUrl = Config.webAddress + 'AuthPage';\n      AuthService.wechatLogin(origUrl, authUrl, {}).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        window.open(responseJson.auth_url, \"_self\");\n      }).catch(function (error) {\n        alert(error);\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.state.interval);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var item = this.state.item ? this.state.item : undefined;\n      var isLogin = this.state.isLogin ? this.state.isLogin : false;\n      var isAdmin = this.state.isAdmin ? this.state.isAdmin : false;\n      var customStyles = {\n        content: {\n          top: '50%',\n          left: '50%',\n          right: 'auto',\n          bottom: 'auto',\n          marginRight: '-50%',\n          transform: 'translate(-50%, -50%)'\n        }\n      };\n\n      if (item && item.is_draft === 0 || item.is_draft === 1 && isLogin) {\n        if (item.is_draft === 1 && !isAdmin) {\n          return React.createElement(\"div\", {\n            key: item.id\n          }, \"No Access to view this article.\");\n        } else {\n          if (isLogin) {\n            return React.createElement(\"div\", {\n              key: item.id\n            }, React.createElement(EditButton, {\n              item: item,\n              show: isAdmin\n            }), React.createElement(ArticleContent, {\n              articleDetail: item,\n              isAdmin: isAdmin,\n              isLogin: isLogin\n            }), React.createElement(EditButton, {\n              item: item,\n              show: isAdmin\n            }), React.createElement(ArticleComments, {\n              item: item,\n              isLogin: isLogin,\n              isAdmin: isAdmin\n            }));\n          } else {\n            return React.createElement(\"div\", {\n              key: item.id\n            }, React.createElement(EditButton, {\n              item: item,\n              show: isAdmin\n            }), React.createElement(ArticleContent, {\n              articleDetail: item,\n              isAdmin: isAdmin,\n              isLogin: isLogin\n            }), React.createElement(EditButton, {\n              item: item,\n              show: isAdmin\n            }), React.createElement(\"div\", {\n              key: item.id,\n              style: styles.editButton\n            }, React.createElement(Button, {\n              onClick: function onClick() {\n                return _this3.handleLogin(item);\n              },\n              plain: true\n            }, Lang.translate('LOGIN'))), React.createElement(ArticleComments, {\n              item: item,\n              isLogin: isLogin,\n              isAdmin: isAdmin\n            }), React.createElement(Modal, {\n              isOpen: this.state.showModal // onAfterOpen={() => {this.getQrCode(item)}}\n              ,\n              onRequestClose: function onRequestClose() {\n                _this3.setState({\n                  showModal: false\n                });\n              },\n              style: customStyles,\n              contentLabel: \"Example Modal\"\n            }, React.createElement(\"div\", {\n              style: styles.qrTitle\n            }, \"\\u626B\\u7801\\u5173\\u6CE8\\u8BE5\\u516C\\u53F8\"), React.createElement(\"div\", {\n              style: styles.qrTitle\n            }, React.createElement(\"small\", null, \"\\u5C06\\u66F4\\u53CA\\u65F6\\u7684\\u6536\\u5230\\u63A8\\u9001\")), React.createElement(\"img\", {\n              style: styles.qrcode,\n              src: this.state.qrUrl\n            })), React.createElement(Toast, {\n              icon: \"success-no-circle\",\n              show: this.state.success\n            }, \"Success\"), React.createElement(Toast, {\n              icon: \"loading\",\n              show: this.state.loading\n            }, \"Loading...\"));\n          }\n        }\n      } else return null;\n    }\n  }]);\n\n  return ArticleDetailComponent;\n}(Component);\n\nexport default ArticleDetailComponent;","map":null,"metadata":{},"sourceType":"module"}