{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from 'react';\nimport { Dialog } from \"react-weui\";\nimport UtilsService from '../../../service/UtilsService';\nimport Colors from '../../../constants/Colors';\nimport JielongService from \"../../../service/JielongService\";\nimport Btn from \"../../Common/form/Btn\";\n\nvar RegistrationButtonArea =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(RegistrationButtonArea, _React$Component);\n\n  function RegistrationButtonArea(props) {\n    var _this;\n\n    _classCallCheck(this, RegistrationButtonArea);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(RegistrationButtonArea).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"createJielongComment\", function () {\n      _this.setState({\n        isLoading: true\n      });\n\n      var itemId = _this.state.item.id;\n      var params = {\n        'config': _JSON$stringify(_this.state.formValues),\n        'comments': '',\n        'quantity': 1,\n        'state_redirect_obj': {\n          url: UtilsService.getWebAddress()\n        },\n        'wechat_auth_url': \"https://www.showmine66.com/a/wu?domain=https%253A%252F%252Fwww.showmine66.com&origurl=https%253A%252F%252Fwww.showmine66.com%252Fma%252Fi%252Fdbfcefa936b4cd6d5709953b5ea12673%2523app-top\",\n        'item_url': \"https://react.showmine66.com/itemDetails?itemId=\" + itemId,\n        // 'item_url': \"https://www.showmine66.com/ma/i/\" + itemId,\n        'voucher_base_url': \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",\n        'is_private': false\n      };\n      JielongService.createJielongComment(itemId, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          currentJieLong: responseJson\n        });\n\n        _this.generateVoucher(responseJson.id, _this.state.item);\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updateJielongComment\", function () {\n      _this.setState({\n        isLoading: true\n      }); // TODO change to jieLongId\n\n\n      var jieLongId = _this.state.registrationId;\n      var params = {\n        'config': _JSON$stringify(_this.state.formValues),\n        'comments': '',\n        'quantity': 1,\n        'state_redirect_obj': {\n          url: UtilsService.getWebAddress()\n        },\n        'wechat_auth_url': \"https://www.showmine66.com/a/wu?domain=https%253A%252F%252Fwww.showmine66.com&origurl=https%253A%252F%252Fwww.showmine66.com%252Fma%252Fi%252Fdbfcefa936b4cd6d5709953b5ea12673%2523app-top\",\n        'item_url': \"https://www.showmine66.com/ma/i/\" + _this.state.item.id,\n        'voucher_base_url': \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\",\n        'is_private': false\n      };\n      JielongService.updateJielongComment(jieLongId, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          currentJieLong: responseJson\n        });\n\n        _this.generateVoucher(responseJson.id, _this.state.item);\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"generateVoucher\", function (jieLongId, item) {\n      var itemUrl = \"https://www.showmine66.com/ma/i/\" + item.id;\n      var params = {\n        is_update: false,\n        item_url: itemUrl,\n        voucher_base_url: \"https://www.showmine66.com/ma/jl/vci/VOUCHERID\"\n      };\n      JielongService.generateVoucher(params, jieLongId).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this.setState({\n          voucher: responseJson,\n          isLoading: false\n        }, function () {\n          window.location.reload();\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showHideConfirmDialog\", function () {\n      _this.setState(function (prevState) {\n        return {\n          showConfirmDialog: !prevState.showConfirmDialog\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updateIsEditingStatus\", function () {\n      _this.state.callbackUpdateIsEditing();\n    });\n\n    _this.state = {\n      item: _this.props.item,\n      formValues: _this.props.formValues,\n      isLoading: false,\n      isLogin: _this.props.isLogin,\n      isParticipated: _this.props.isParticipated,\n      registrationId: _this.props.registrationId,\n      showConfirmDialog: false,\n      currentJieLong: {},\n      isValidForm: _this.props.isValidForm,\n      isEditing: _this.props.isEditing,\n      callbackUpdateIsEditing: _this.props.callbackUpdateIsEditing\n    };\n    return _this;\n  }\n\n  _createClass(RegistrationButtonArea, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps, nextContext) {\n      this.setState({\n        item: nextProps.item,\n        isLogin: nextProps.isLogin,\n        formValues: nextProps.formValues,\n        isParticipated: nextProps.isParticipated,\n        registrationId: nextProps.registrationId,\n        isValidForm: nextProps.isValidForm,\n        isEditing: nextProps.isEditing\n      });\n    }\n  }, {\n    key: \"cancelJielong\",\n    value: function cancelJielong() {\n      var _this2 = this;\n\n      this.showHideConfirmDialog();\n      this.setState({\n        isLoading: true\n      });\n      var jieLongId = this.state.registrationId;\n      var url = \"https://www.showmine66.com/ma/i/\" + this.state.item.id;\n      JielongService.cancelJielong(jieLongId, url, {}).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this2.setState({\n          showLoading: false\n        }, function () {\n          window.location.reload();\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          isParticipated = _this$state.isParticipated,\n          isEditing = _this$state.isEditing,\n          isValidForm = _this$state.isValidForm,\n          isLoading = _this$state.isLoading,\n          showConfirmDialog = _this$state.showConfirmDialog;\n      var confirmClearButtons = {\n        title: '取消报名',\n        buttons: [{\n          type: 'default',\n          label: '再想想',\n          onClick: function onClick() {\n            return _this3.showHideConfirmDialog();\n          }\n        }, {\n          type: 'primary',\n          label: '确定',\n          onClick: function onClick() {\n            return _this3.cancelJielong();\n          }\n        }]\n      };\n\n      if (isParticipated) {\n        if (isEditing) {\n          return React.createElement(\"div\", {\n            style: styles.buttonGroupContainer\n          }, React.createElement(\"div\", {\n            style: styles.buttonArea\n          }, React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.updateIsEditingStatus();\n            },\n            title: \"\\u53D6\\u6D88\\u4FEE\\u6539\",\n            loading: isLoading\n          }), React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.updateJielongComment();\n            },\n            disabled: !isValidForm,\n            title: \"\\u786E\\u8BA4\\u4FEE\\u6539\",\n            loading: isLoading\n          })), React.createElement(Dialog, {\n            style: styles.dialog,\n            type: \"ios\",\n            title: confirmClearButtons.title,\n            buttons: confirmClearButtons.buttons,\n            show: showConfirmDialog\n          }, \"\\u786E\\u5B9A\\u53D6\\u6D88\\u62A5\\u540D\\uFF1F\"));\n        } else {\n          return React.createElement(\"div\", {\n            style: styles.buttonGroupContainer\n          }, React.createElement(\"div\", {\n            style: styles.buttonArea\n          }, React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.showHideConfirmDialog();\n            },\n            title: \"\\u53D6\\u6D88\\u62A5\\u540D\",\n            loading: isLoading\n          }), React.createElement(Btn, {\n            onClick: function onClick() {\n              return _this3.updateIsEditingStatus();\n            },\n            title: \"\\u4FEE\\u6539\\u62A5\\u540D\",\n            loading: isLoading\n          })), React.createElement(Dialog, {\n            style: styles.dialog,\n            type: \"ios\",\n            title: confirmClearButtons.title,\n            buttons: confirmClearButtons.buttons,\n            show: showConfirmDialog\n          }, \"\\u786E\\u5B9A\\u53D6\\u6D88\\u62A5\\u540D\\uFF1F\"));\n        }\n      } else {\n        return React.createElement(\"div\", {\n          style: styles.buttonGroupContainer\n        }, React.createElement(Btn, {\n          onClick: function onClick() {\n            _this3.createJielongComment();\n          },\n          disabled: !isValidForm,\n          title: \"\\u7ACB\\u523B\\u62A5\\u540D\",\n          loading: isLoading\n        }));\n      }\n    }\n  }]);\n\n  return RegistrationButtonArea;\n}(React.Component);\n\nvar styles = {\n  buttonGroupContainer: {\n    position: 'fixed',\n    left: 0,\n    bottom: 0,\n    width: '100%',\n    color: '#fff',\n    textAlign: 'center'\n  },\n  dialog: {\n    color: Colors.fontColor\n  },\n  buttonArea: {\n    display: 'flex',\n    flexDirection: 'row'\n  }\n};\nexport default RegistrationButtonArea;","map":null,"metadata":{},"sourceType":"module"}