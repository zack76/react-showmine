{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport { Button, Cells, Cell, CellBody, CellFooter, ActionSheet, Toast } from 'react-weui';\nimport CompanyService from '../service/CompanyService';\nimport UtilsService from '../service/UtilsService';\nimport 'weui';\nimport 'react-weui/build/packages/react-weui.css';\nimport { Config } from '../Config';\nimport Footer from \"../components/Common/SiteFooter\";\nimport CompanyBanner from '../components/Company/CompanyBanner';\nimport SiteHeader from '../components/Common/SiteHeader';\nimport CompanyTitle from '../components/Company/CompanyTitle';\nimport SlideableJieLongList from \"../components/Company/SlideableList/SlideableJieLongList\";\nimport ConsultationList from \"../components/Company/ConsultationList/ConsultationList\";\nimport CompanyInfoSection from \"../components/Company/CompanyInfoSection\";\nimport WeChatService from \"../service/WeChatService\";\nimport { Row, Col, Container } from 'react-bootstrap';\nimport AuthService from \"../service/AuthService\";\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"weChatShare\", function () {\n      var company = _this.state.company;\n      var currentUrl = _this.state.currentUrl;\n      WeChatService.runWhenWXReady(function () {\n        wx.onMenuShareAppMessage({\n          title: company.name,\n          desc: company.description,\n          link: currentUrl,\n          imgUrl: company.logo_img && company.logo_img.url ? company.logo_img.url : '../static/assets/default_item.png'\n        });\n        wx.onMenuShareTimeline({\n          title: company.name,\n          link: currentUrl,\n          imgUrl: company.logo_img && company.logo_img.url ? company.logo_img.url : '../static/assets/default_item.png'\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginWithTempCode\", function (tmpToken) {\n      AuthService.loginWithTempCode(tmpToken).then(function (response) {\n        return response.text();\n      }).then(function (resp) {\n        var res = JSON.parse(resp);\n\n        if (res.return_code) {\n          localStorage.setItem('userToken', res.return_code);\n          localStorage.setItem('isLogIn', true);\n        }\n\n        var params = {};\n        AuthService.getMe(params).then(function (response) {\n          return response.json();\n        }).then(function (responseJson) {\n          localStorage.setItem('userObject', _JSON$stringify(responseJson));\n        }).then(function () {\n          location.reload();\n        }).catch(function (error) {\n          console.error(error);\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getLoginStatus\", function () {\n      if (!UtilsService.openedInWeChat() && !localStorage.getItem('userToken')) {\n        if (_this.state.subscribeLoginLogId) {\n          AuthService.checkLoginStatus(_this.state.subscribeLoginLogId || null).then(function (response) {\n            return response.text();\n          }).then(function (resp) {\n            var res = JSON.parse(resp);\n\n            if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n              _this.setState({\n                loading: true\n              });\n\n              _this.loginWithTempCode(res.log.tmp_token.trim());\n            }\n          });\n        }\n      } else {\n        clearInterval(_this.state.interval);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCompanyQrCode\", function (company) {\n      var getLoginStatus = _this.getLoginStatus;\n      var params = {\n        companyId: company.id\n      };\n      AuthService.getLoginSubscribeQrCode(params).then(function (response) {\n        return response.text();\n      }).then(function (response) {\n        var res = JSON.parse(response);\n        var interval = setInterval(getLoginStatus, 1000);\n\n        _this.setState({\n          qrUrl: res.qrcode,\n          subscribeLoginLogId: res.subscribeLoginLogId,\n          interval: interval\n        });\n      });\n    });\n\n    _this.state = {\n      company: _this.props.company,\n      showLoading: false,\n      isLogin: false\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setState({\n        isLogin: localStorage.getItem('isLogIn')\n      }, function () {\n        setTimeout(function () {\n          _this2.weChatShare();\n        }, 500);\n      });\n      this.getCompanyQrCode(this.state.company);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var company = this.state.company ? this.state.company : undefined;\n      return React.createElement(\"div\", {\n        style: styles.companyWrapper,\n        className: 'custom-font'\n      }, React.createElement(Container, null, React.createElement(Row, null, React.createElement(Col, {\n        sm: 12,\n        md: 8,\n        className: \"col-md-offset-2\"\n      }, React.createElement(SiteHeader, {\n        company: company,\n        show: false\n      }), React.createElement(CompanyBanner, {\n        companyId: company.id\n      }), React.createElement(CompanyTitle, {\n        company: company\n      }), React.createElement(CompanyInfoSection, {\n        company: company,\n        showDivider: true\n      }), React.createElement(SlideableJieLongList, {\n        companyId: company.id,\n        isOngoing: true,\n        showDivider: true\n      }), React.createElement(SlideableJieLongList, {\n        companyId: company.id,\n        isOngoing: false,\n        showDivider: true\n      }), React.createElement(ConsultationList, {\n        companyId: company.id,\n        showDivider: true\n      }), React.createElement(Footer, null)), React.createElement(Col, {\n        sm: 12,\n        md: 2,\n        className: \"sticky\"\n      }, React.createElement(\"div\", {\n        style: styles.qrTitle\n      }, \"\\u626B\\u7801\\u5173\\u6CE8\\u8BE5\\u516C\\u53F8\"), React.createElement(\"div\", {\n        style: styles.qrTitle\n      }, React.createElement(\"small\", null, \"\\u5C06\\u66F4\\u53CA\\u65F6\\u7684\\u6536\\u5230\\u63A8\\u9001\")), React.createElement(\"img\", {\n        style: styles.qrcode,\n        src: this.state.qrUrl\n      })))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\n_defineProperty(App, \"getInitialProps\",\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(_ref) {\n    var res, req, query, homePageUrl, resp, json;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            res = _ref.res, req = _ref.req, query = _ref.query;\n\n            if (query.companyId) {\n              _context.next = 5;\n              break;\n            }\n\n            homePageUrl = 'https://www.showmine.com';\n\n            if (res) {\n              res.writeHead(301, {\n                Location: homePageUrl\n              });\n              res.end();\n            } else {\n              window.location = homePageUrl;\n            }\n\n            return _context.abrupt(\"return\", {});\n\n          case 5:\n            _context.next = 7;\n            return CompanyService.getCompanyDetails(query.companyId);\n\n          case 7:\n            resp = _context.sent;\n            _context.next = 10;\n            return resp.json();\n\n          case 10:\n            json = _context.sent;\n            return _context.abrupt(\"return\", {\n              company: UtilsService.formatRawCompany(json)\n            });\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}());\n\nvar styles = {\n  companyWrapper: {\n    width: '100%'\n  },\n  qrcode: {\n    width: '100%'\n  },\n  qrTitle: {\n    width: '100%',\n    textAlign: 'center'\n  }\n};\nexport default App;","map":null,"metadata":{},"sourceType":"module"}