{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/Zac/Sysbox/SHM_React/shm-react/my-app/pages/index.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport { Button, Cells, Cell, CellBody, CellFooter, ActionSheet, Toast } from 'react-weui';\nimport DetailService from '../service/DetailService';\nimport JielongService from '../service/JielongService';\nimport AuthService from \"../service/AuthService\";\nimport Router from 'next/router'; //import styles\n\nimport 'weui';\nimport 'react-weui/build/packages/react-weui.css'; //import component\n\nimport Swipe from '../components/Swipe';\nimport Head from \"../components/head\";\nimport ProductCardGrid from \"../components/ProductCards/ProductCardGrid\";\nimport ChildrenList from '../components/JieLong/ChildrenList';\nimport JielongContent from '../components/JieLong/JieLongContent';\nimport Footer from \"../components/Footer\";\nimport PaymentService from \"../service/PaymentService\";\nimport Lang from '../lang/Lang';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n    _this.state = {\n      item: _this.props.item,\n      productList: undefined,\n      showLoading: false,\n      userJieLongInfo: '',\n      isLogin: false,\n      iosShow: false,\n      actions: [{\n        label: '取消',\n        onClick: _this.hide.bind(_assertThisInitialized(_this))\n      }]\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"hide\",\n    value: function hide() {\n      this.setState({\n        iosShow: false\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getIsInCurrentJieLong();\n      this.getRelatedProducts();\n      this.setState({\n        isLogin: localStorage.getItem('isLogIn')\n      });\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(object, nextProps) {\n      this.setState({\n        item: object.item\n      });\n    }\n  }, {\n    key: \"getRelatedProducts\",\n    value: function getRelatedProducts() {\n      var _this2 = this;\n\n      var params = this.state.item.company_id + '?is_draft=0&is_sync_to_market=1&page=1&page-size=6';\n      DetailService.getRelatedProducts(params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this2.setState({\n          productList: responseJson\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      return this.state !== nextProps;\n    }\n  }, {\n    key: \"getIsInCurrentJieLong\",\n    value: function getIsInCurrentJieLong() {\n      var _this3 = this;\n\n      var id = this.state.item.id;\n      JielongService.getIsInCurrentJieLong(id).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this3.setState({\n          userJieLongInfo: responseJson\n        });\n\n        console.log(responseJson);\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"cancelJielong\",\n    value: function cancelJielong() {\n      var _this4 = this;\n\n      this.hide();\n      this.setState({\n        showLoading: true\n      });\n      var id = this.state.userJieLongInfo.currentUserJieLong.id;\n      var url = \"https://www.showmine66.com/ma/i/\" + this.state.item.id;\n      var params = {};\n      JielongService.cancelJielong(id, url, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        _this4.setState({\n          showLoading: false\n        });\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"updateJielong\",\n    value: function updateJielong() {\n      var itemId = {\n        itemId: this.state.item.id,\n        is_update: true,\n        jielongId: this.state.userJieLongInfo.currentUserJieLong.id\n      };\n      Router.push({\n        pathname: '/checkoutPage',\n        query: itemId\n      });\n    }\n  }, {\n    key: \"checkLoginStatus\",\n    value: function checkLoginStatus() {\n      var itemId = {\n        itemId: this.state.item.id\n      };\n      var login = localStorage.getItem('isLogIn');\n\n      if (login) {\n        Router.push({\n          pathname: '/checkoutPage',\n          query: itemId\n        });\n      } else {\n        this.weChatLogin();\n      }\n    }\n  }, {\n    key: \"weChatLogin\",\n    value: function weChatLogin() {\n      var origUrl = this.state.item.id;\n      var authUrl = \"http://localhost:3000/AuthPage\";\n      var params = {};\n      AuthService.weChatLogin(origUrl, authUrl, params).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        window.open(responseJson.auth_url, \"_self\");\n      }).catch(function (error) {\n        console.error(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      var userJieLongInfo = this.state.userJieLongInfo;\n      var productList = this.state.productList && this.state.productList.data ? this.state.productList.data : undefined;\n      var item = this.state.item ? this.state.item : undefined;\n      console.log(item.multi_participations);\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }, React.createElement(Head, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, React.createElement(\"meta\", {\n        name: \"viewport\",\n        content: \"initial-scale=1.0, width=device-width\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      })), React.createElement(\"header\", {\n        className: \"App-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        onClick: function onClick() {\n          return Router.push('/loginPage');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, Lang.translate('SHOWMINE'))), React.createElement(\"div\", {\n        className: \"App-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        key: item.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, React.createElement(Swipe, {\n        image: item.images,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      })), React.createElement(JielongContent, {\n        jieLongDetail: item ? item : undefined,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      })), this.state.isLogin && userJieLongInfo && userJieLongInfo.currentUserJieLong && userJieLongInfo.currentUserJieLong.voucher && userJieLongInfo.currentUserJieLong.voucher.refnum ? React.createElement(Cells, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, React.createElement(Cell, {\n        href: userJieLongInfo.currentUserJieLong.voucher.img_url,\n        access: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, React.createElement(CellBody, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"isInJielong-row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"tag-icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, \"\\u53C2\\u52A0\\u6210\\u529F\"), \" \\u60A8\\u7684\\u56DE\\u6267\\u7801\\uFF1A\", React.createElement(\"span\", {\n        className: \"Ref-num\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, userJieLongInfo.currentUserJieLong.voucher.refnum)))), React.createElement(CellFooter, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }))) : null, React.createElement(ChildrenList, {\n        children: item.children ? item.children : undefined,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }), item.company ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"company-info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"company-img\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        height: 100,\n        src: item.company.logo_img.url,\n        role: \"presentation\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"company-content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"company-title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, item.company.name), React.createElement(\"div\", {\n        className: \"company-followers\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }, \"\\u5173\\u6CE8\\u91CF\\uFF1A\", item.company.followers))), React.createElement(\"div\", {\n        className: \"divider\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      })) : null, React.createElement(\"div\", {\n        className: \"related-product\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, React.createElement(ProductCardGrid, {\n        productList: productList,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      })), React.createElement(Footer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"button-area\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, this.state.isLogin && userJieLongInfo && userJieLongInfo.currentUserJieLong && userJieLongInfo.currentUserJieLong.voucher && userJieLongInfo.currentUserJieLong.voucher.refnum ? React.createElement(\"div\", {\n        style: {\n          color: 'black'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"primary\",\n        onClick: function onClick(e) {\n          return _this5.setState({\n            iosShow: true\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, \"\\u4FEE\\u6539\\u8BA2\\u5355\"), React.createElement(ActionSheet, {\n        menus: [{\n          label: '修改团购',\n          onClick: function onClick() {\n            _this5.updateJielong();\n          }\n        }, {\n          label: '取消团购',\n          onClick: function onClick() {\n            _this5.cancelJielong();\n          }\n        }],\n        actions: this.state.actions,\n        show: this.state.iosShow,\n        type: \"ios\",\n        onRequestClose: function onRequestClose(e) {\n          return _this5.setState({\n            iosShow: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }), React.createElement(Toast, {\n        icon: \"loading\",\n        show: this.state.showLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, \"Loading...\")) : React.createElement(Button, {\n        type: \"primary\",\n        className: \"button\",\n        onClick: function onClick() {\n          _this5.checkLoginStatus();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }, \"\\u9A6C\\u4E0A\\u4E0B\\u5355\"))));\n    }\n  }]);\n\n  return App;\n}(Component);\n\n_defineProperty(App, \"getInitialProps\",\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(_ref) {\n    var req, query, res, json;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            req = _ref.req, query = _ref.query;\n            res = '';\n\n            if (!query.itemId) {\n              _context.next = 8;\n              break;\n            }\n\n            _context.next = 5;\n            return DetailService.getDetail(query.itemId);\n\n          case 5:\n            res = _context.sent;\n            _context.next = 11;\n            break;\n\n          case 8:\n            _context.next = 10;\n            return DetailService.getDetail('0f95b4d63b1afa75c3a9e2b3fae27cdf');\n\n          case 10:\n            res = _context.sent;\n\n          case 11:\n            _context.next = 13;\n            return res.json();\n\n          case 13:\n            json = _context.sent;\n            return _context.abrupt(\"return\", {\n              item: json\n            });\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}());\n\nexport default App;","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM_React/shm-react/my-app/pages/index.js"],"names":["React","Component","Button","Cells","Cell","CellBody","CellFooter","ActionSheet","Toast","DetailService","JielongService","AuthService","Router","Swipe","Head","ProductCardGrid","ChildrenList","JielongContent","Footer","PaymentService","Lang","App","props","state","item","productList","undefined","showLoading","userJieLongInfo","isLogin","iosShow","actions","label","onClick","hide","bind","setState","getIsInCurrentJieLong","getRelatedProducts","localStorage","getItem","object","nextProps","params","company_id","then","response","json","responseJson","catch","error","console","id","log","currentUserJieLong","url","cancelJielong","itemId","is_update","jielongId","push","pathname","query","login","weChatLogin","origUrl","authUrl","window","open","auth_url","data","multi_participations","translate","images","voucher","refnum","img_url","children","company","logo_img","name","followers","color","e","updateJielong","checkLoginStatus","req","res","getDetail"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport {Button, Cells, Cell, CellBody, CellFooter, ActionSheet, Toast} from 'react-weui';\nimport DetailService from '../service/DetailService';\nimport JielongService from '../service/JielongService';\nimport AuthService from \"../service/AuthService\";\nimport Router from 'next/router';\n\n\n\n//import styles\nimport 'weui';\nimport 'react-weui/build/packages/react-weui.css';\n\n\n//import component\nimport Swipe from '../components/Swipe'\nimport Head from \"../components/head\";\nimport ProductCardGrid from \"../components/ProductCards/ProductCardGrid\";\nimport ChildrenList from '../components/JieLong/ChildrenList';\nimport JielongContent from '../components/JieLong/JieLongContent';\nimport Footer from \"../components/Footer\";\nimport PaymentService from \"../service/PaymentService\";\nimport Lang from '../lang/Lang';\n\n\n\nclass App extends Component {\n    constructor(props){\n        super(props);\n        this.state = {\n            item: this.props.item,\n            productList: undefined,\n            showLoading: false,\n            userJieLongInfo: '',\n            isLogin: false,\n            iosShow: false,\n            actions: [\n                {\n                    label: '取消',\n                    onClick: this.hide.bind(this)\n                }\n            ],\n        };\n    }\n\n    hide(){\n        this.setState({\n            iosShow: false,\n        });\n    }\n\n    static getInitialProps = async({ req, query }) => {\n        let res = '';\n        if (query.itemId) {\n            res = await DetailService.getDetail(query.itemId);\n        }\n        else {\n            // res = await DetailService.getDetail('a3067bcbd7521b4965ef8b43394aa011');\n            res = await DetailService.getDetail('0f95b4d63b1afa75c3a9e2b3fae27cdf');\n        }\n        const json = await res.json();\n        return { item: json };\n    };\n\n\n    componentDidMount() {\n        this.getIsInCurrentJieLong();\n        this.getRelatedProducts();\n        this.setState({\n            isLogin: localStorage.getItem('isLogIn'),\n        });\n    }\n\n    componentWillReceiveProps(object, nextProps) {\n        this.setState({\n            item: object.item\n        })\n    }\n\n    getRelatedProducts() {\n        let params = this.state.item.company_id + '?is_draft=0&is_sync_to_market=1&page=1&page-size=6';\n        DetailService.getRelatedProducts(params)\n            .then((response) => response.json())\n            .then((responseJson) => {\n                this.setState({\n                    productList: responseJson\n                });\n            })\n            .catch((error) => {\n                console.error(error);\n            });\n    }\n\n    shouldComponentUpdate(nextProps) {\n        return this.state !== nextProps;\n    }\n\n    getIsInCurrentJieLong() {\n        let id = this.state.item.id;\n        JielongService.getIsInCurrentJieLong(id)\n            .then((response) => response.json())\n            .then((responseJson) => {\n                this.setState({\n                    userJieLongInfo: responseJson,\n                });\n                console.log(responseJson);\n            })\n            .catch((error) => {\n                console.error(error);\n            });\n    }\n\n    cancelJielong() {\n        this.hide();\n        this.setState({showLoading: true});\n        let id = this.state.userJieLongInfo.currentUserJieLong.id;\n        let url = \"https://www.showmine66.com/ma/i/\" + this.state.item.id;\n        let params ={};\n        JielongService.cancelJielong(id, url, params)\n            .then((response) => response.json())\n            .then((responseJson) => {\n                this.setState({showLoading: false});\n            })\n            .catch((error) => {\n                console.error(error);\n            });\n    }\n\n    updateJielong() {\n        let itemId = { itemId: this.state.item.id, is_update: true, jielongId: this.state.userJieLongInfo.currentUserJieLong.id};\n        Router.push({\n            pathname: '/checkoutPage',\n            query: itemId,\n        });\n    }\n\n    checkLoginStatus() {\n        let itemId = { itemId: this.state.item.id};\n        let login = localStorage.getItem('isLogIn');\n        if (login) {\n            Router.push({\n                pathname: '/checkoutPage',\n                query: itemId,\n            });\n        }\n        else {\n            this.weChatLogin();\n        }\n    }\n\n    weChatLogin() {\n        let origUrl =this.state.item.id;\n        let authUrl =\"http://localhost:3000/AuthPage\";\n        let params ={};\n        AuthService.weChatLogin(origUrl, authUrl, params)\n            .then((response) => response.json())\n            .then((responseJson) => {\n                window.open(responseJson.auth_url, \"_self\");\n            })\n            .catch((error) => {\n                console.error(error);\n            });\n    }\n\n    render() {\n        const userJieLongInfo = this.state.userJieLongInfo;\n        const productList = this.state.productList && this.state.productList.data ? this.state.productList.data : undefined;\n        const item = this.state.item ? this.state.item : undefined;\n        console.log(item.multi_participations);\n        return (\n            <div className=\"App\">\n                <Head>\n                    <meta name=\"viewport\" content=\"initial-scale=1.0, width=device-width\" />\n                </Head>\n                <header className=\"App-header\">\n                    <div onClick={() => Router.push('/loginPage')}>\n                        {Lang.translate('SHOWMINE')}\n                    </div>\n                </header>\n                <div className='App-body'>\n                    <div className='content'>\n                        <div key={item.id}>\n                            <Swipe image={item.images}/>\n                        </div>\n                        <JielongContent jieLongDetail={item ? item : undefined}/>\n                    </div>\n                    {\n                        this.state.isLogin && userJieLongInfo && userJieLongInfo.currentUserJieLong && userJieLongInfo.currentUserJieLong.voucher && userJieLongInfo.currentUserJieLong.voucher.refnum ?\n                            (\n                                <Cells>\n                                    <Cell href={userJieLongInfo.currentUserJieLong.voucher.img_url} access>\n                                        <CellBody>\n                                            <div className='isInJielong-row'>\n                                                <div><span className='tag-icon'>参加成功</span> 您的回执码：<span className='Ref-num'>{userJieLongInfo.currentUserJieLong.voucher.refnum}</span></div>\n                                            </div>\n                                        </CellBody>\n                                        <CellFooter/>\n                                    </Cell>\n                                </Cells>\n                            )\n                            : null\n                    }\n                    <ChildrenList children={item.children ? item.children : undefined}/>\n                    {item.company ?\n                        (\n                            <div>\n                                <div className='company-info'>\n                                    <div className='company-img'>\n                                        <img height={100} src={item.company.logo_img.url} role=\"presentation\" />\n                                    </div>\n                                    <div className='company-content'>\n                                        <div className='company-title'>{item.company.name}</div>\n                                        <div className='company-followers'>关注量：{item.company.followers}</div>\n                                    </div>\n                                </div>\n                                <div className='divider'/>\n                            </div>)\n                        :\n                        null\n                    }\n\n                    <div className='related-product'>\n                        <ProductCardGrid productList={productList}/>\n                    </div>\n                    <Footer/>\n                    <div className='button-area'>\n                        {this.state.isLogin && userJieLongInfo && userJieLongInfo.currentUserJieLong && userJieLongInfo.currentUserJieLong.voucher && userJieLongInfo.currentUserJieLong.voucher.refnum ?\n                            (\n                                <div style={{color:'black'}}>\n                                    <Button type=\"primary\" onClick={e=>this.setState({iosShow: true})}>修改订单</Button>\n                                    <ActionSheet\n                                        menus={[{\n                                            label: '修改团购',\n                                            onClick: ()=> {this.updateJielong();}\n                                        }, {\n                                            label: '取消团购',\n                                            onClick: ()=> {this.cancelJielong();}\n                                        }]}\n                                        actions={this.state.actions}\n                                        show={this.state.iosShow}\n                                        type=\"ios\"\n                                        onRequestClose={e=>this.setState({iosShow: false})}\n                                    />\n                                    <Toast icon=\"loading\" show={this.state.showLoading}>Loading...</Toast>\n                                </div>\n                            )\n                            :\n                            <Button type=\"primary\" className='button' onClick={()=>{this.checkLoginStatus();}}>马上下单</Button>\n                        }\n                    </div>\n                </div>\n            </div>\n\n        );\n    }\n}\n\nexport default App;\n\n\n\n\n\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}