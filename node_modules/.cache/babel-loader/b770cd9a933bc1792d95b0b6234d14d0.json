{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/ArticleDetails/ArticleDetailComponent.js\";\nimport React, { Component } from 'react';\nimport ArticleContent from \"./ArticleContent\";\nimport ArticleComments from \"./ArticleComments\";\nimport UtilsService from \"../../../service/UtilsService\";\nimport AuthService from \"../../../service/AuthService\";\nimport { Config } from \"../../../Config\";\nimport EditButton from \"../../../components/ItemDetails/ArticleDetails/EditButton\";\nimport { Button, Toast } from \"react-weui\";\nimport Lang from \"../../../lang/Lang\";\nimport Modal from \"react-modal\";\nvar styles = {\n  loginButton: {\n    width: '100%'\n  }\n};\n\nvar ArticleDetailComponent =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ArticleDetailComponent, _Component);\n\n  function ArticleDetailComponent(props) {\n    var _this;\n\n    _classCallCheck(this, ArticleDetailComponent);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ArticleDetailComponent).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"getLoginStatus\", function () {\n      if (_this.state.subscribeLoginLogId) {\n        AuthService.checkLoginStatus(_this.state.subscribeLoginLogId || null).then(function (response) {\n          return response.text();\n        }).then(function (resp) {\n          var res = JSON.parse(resp);\n\n          if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n            _this.setState({\n              loading: true\n            });\n\n            _this.loginWithTempCode(res.log.tmp_token.trim());\n          }\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"loginWithTempCode\", function (tmpToken) {\n      AuthService.loginWithTempCode(tmpToken).then(function (response) {\n        return response.text();\n      }).then(function (resp) {\n        var res = JSON.parse(resp);\n\n        if (res.return_code) {\n          localStorage.setItem('userToken', res.return_code);\n          localStorage.setItem('isLogIn', true);\n        }\n\n        var params = {};\n        AuthService.getMe(params).then(function (response) {\n          return response.json();\n        }).then(function (responseJson) {\n          localStorage.setItem('userObject', _JSON$stringify(responseJson));\n        }).then(function () {\n          location.reload();\n        }).catch(function (error) {\n          console.error(error);\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleLogin\", function (item) {\n      if (UtilsService.openedInWeChat()) {\n        _this.weChatLogin();\n      } else {\n        var getLoginStatus = _this.getLoginStatus;\n        var params = {\n          companyId: item && item.company && item.company.id,\n          itemId: item && item.id\n        };\n        AuthService.getLoginSubscribeQrCode(params).then(function (response) {\n          return response.text();\n        }).then(function (resp) {\n          var res = JSON.parse(resp);\n          var interval = setInterval(getLoginStatus, 1000);\n\n          _this.setState({\n            qrUrl: res.qrcode,\n            subscribeLoginLogId: res.subscribeLoginLogId,\n            showModal: true,\n            interval: interval\n          });\n        });\n      }\n    });\n\n    _this.state = {\n      isLogin: _this.props.isLogin ? _this.props.isLogin : undefined,\n      item: _this.props.item\n    };\n    return _this;\n  }\n\n  _createClass(ArticleDetailComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setState({\n        isLogin: localStorage.getItem('isLogIn')\n      }, function () {\n        if (_this2.state.isLogin) {\n          var user = JSON.parse(localStorage.getItem('userObject'));\n\n          _this2.setState({\n            isAdmin: UtilsService.getIsCompanyAdmin(user, _this2.state.item.company_id)\n          });\n        }\n      });\n    }\n  }, {\n    key: \"weChatLogin\",\n    value: function weChatLogin() {\n      var origUrl = window.location.href;\n      var authUrl = Config.webAddress + 'AuthPage';\n      AuthService.wechatLogin(origUrl, authUrl, {}).then(function (response) {\n        return response.json();\n      }).then(function (responseJson) {\n        window.open(responseJson.auth_url, \"_self\");\n      }).catch(function (error) {\n        alert(error);\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.state.interval);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var item = this.state.item ? this.state.item : undefined;\n      var isLogin = this.state.isLogin ? this.state.isLogin : false;\n      var isAdmin = this.state.isAdmin ? this.state.isAdmin : false;\n      var customStyles = {\n        content: {\n          top: '50%',\n          left: '50%',\n          right: 'auto',\n          bottom: 'auto',\n          marginRight: '-50%',\n          transform: 'translate(-50%, -50%)'\n        }\n      };\n\n      if (item && item.is_draft === 0 || item.is_draft === 1 && isLogin) {\n        if (item.is_draft === 1 && !isAdmin) {\n          return React.createElement(\"div\", {\n            key: item.id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 139\n            },\n            __self: this\n          }, \"No Access to view this article.\");\n        } else {\n          if (isLogin) {\n            return React.createElement(\"div\", {\n              key: item.id,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 146\n              },\n              __self: this\n            }, React.createElement(EditButton, {\n              item: item,\n              show: isAdmin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 147\n              },\n              __self: this\n            }), React.createElement(ArticleContent, {\n              articleDetail: item,\n              isAdmin: isAdmin,\n              isLogin: isLogin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 148\n              },\n              __self: this\n            }), React.createElement(EditButton, {\n              item: item,\n              show: isAdmin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 149\n              },\n              __self: this\n            }), React.createElement(ArticleComments, {\n              item: item,\n              isLogin: isLogin,\n              isAdmin: isAdmin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 150\n              },\n              __self: this\n            }));\n          } else {\n            return React.createElement(\"div\", {\n              key: item.id,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 157\n              },\n              __self: this\n            }, React.createElement(\"div\", {\n              className: \"row\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 158\n              },\n              __self: this\n            }, React.createElement(EditButton, {\n              item: item,\n              show: isAdmin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 159\n              },\n              __self: this\n            }), React.createElement(ArticleContent, {\n              articleDetail: item,\n              isAdmin: isAdmin,\n              isLogin: isLogin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 160\n              },\n              __self: this\n            }), React.createElement(EditButton, {\n              item: item,\n              show: isAdmin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 161\n              },\n              __self: this\n            }), React.createElement(\"div\", {\n              key: item.id,\n              style: styles.editButton,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 162\n              },\n              __self: this\n            }, React.createElement(Button, {\n              onClick: function onClick() {\n                return _this3.handleLogin(item);\n              },\n              plain: true,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 163\n              },\n              __self: this\n            }, Lang.translate('LOGIN')))), React.createElement(ArticleComments, {\n              item: item,\n              isLogin: isLogin,\n              isAdmin: isAdmin,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 171\n              },\n              __self: this\n            }), React.createElement(Modal, {\n              isOpen: this.state.showModal // onAfterOpen={() => {this.getQrCode(item)}}\n              ,\n              onRequestClose: function onRequestClose() {\n                _this3.setState({\n                  showModal: false\n                });\n              },\n              style: customStyles,\n              contentLabel: \"Example Modal\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 172\n              },\n              __self: this\n            }, React.createElement(\"div\", {\n              style: styles.qrTitle,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 179\n              },\n              __self: this\n            }, \"\\u626B\\u7801\\u5173\\u6CE8\\u8BE5\\u516C\\u53F8\"), React.createElement(\"div\", {\n              style: styles.qrTitle,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 180\n              },\n              __self: this\n            }, React.createElement(\"small\", {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 180\n              },\n              __self: this\n            }, \"\\u5C06\\u66F4\\u53CA\\u65F6\\u7684\\u6536\\u5230\\u63A8\\u9001\")), React.createElement(\"img\", {\n              style: styles.qrcode,\n              src: this.state.qrUrl,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 181\n              },\n              __self: this\n            })), React.createElement(Toast, {\n              icon: \"success-no-circle\",\n              show: this.state.success,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 183\n              },\n              __self: this\n            }, \"Success\"), React.createElement(Toast, {\n              icon: \"loading\",\n              show: this.state.loading,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 184\n              },\n              __self: this\n            }, \"Loading...\"));\n          }\n        }\n      } else return null;\n    }\n  }]);\n\n  return ArticleDetailComponent;\n}(Component);\n\nexport default ArticleDetailComponent;","map":{"version":3,"sources":["/Users/Zac/Sysbox/SHM/react/shm-react/my-app/components/ItemDetails/ArticleDetails/ArticleDetailComponent.js"],"names":["React","Component","ArticleContent","ArticleComments","UtilsService","AuthService","Config","EditButton","Button","Toast","Lang","Modal","styles","loginButton","width","ArticleDetailComponent","props","state","subscribeLoginLogId","checkLoginStatus","then","response","text","resp","res","JSON","parse","log","tmp_token","trim","setState","loading","loginWithTempCode","tmpToken","return_code","localStorage","setItem","params","getMe","json","responseJson","location","reload","catch","error","console","item","openedInWeChat","weChatLogin","getLoginStatus","companyId","company","id","itemId","getLoginSubscribeQrCode","interval","setInterval","qrUrl","qrcode","showModal","isLogin","undefined","getItem","user","isAdmin","getIsCompanyAdmin","company_id","origUrl","window","href","authUrl","webAddress","wechatLogin","open","auth_url","alert","clearInterval","customStyles","content","top","left","right","bottom","marginRight","transform","is_draft","editButton","handleLogin","translate","qrTitle","success"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport ArticleContent from \"./ArticleContent\";\nimport ArticleComments from \"./ArticleComments\";\nimport UtilsService from \"../../../service/UtilsService\";\nimport AuthService from \"../../../service/AuthService\";\nimport {Config} from \"../../../Config\";\nimport EditButton from \"../../../components/ItemDetails/ArticleDetails/EditButton\"\nimport {Button, Toast} from \"react-weui\";\nimport Lang from \"../../../lang/Lang\";\nimport Modal from \"react-modal\";\n\nconst styles = {\n    loginButton: {\n        width: '100%'\n    }\n\n};\n\nclass ArticleDetailComponent extends Component {\n    constructor(props){\n        super(props);\n        this.state = {\n            isLogin: this.props.isLogin ? this.props.isLogin : undefined,\n            item: this.props.item\n        };\n    }\n\n    componentDidMount() {\n        this.setState({\n            isLogin: localStorage.getItem('isLogIn'),\n        }, () => {\n            if (this.state.isLogin) {\n                let user = JSON.parse(localStorage.getItem('userObject'));\n                this.setState({\n                    isAdmin:  UtilsService.getIsCompanyAdmin(user, this.state.item.company_id)\n                });\n            }\n        });\n    }\n\n    weChatLogin() {\n        let origUrl = window.location.href;\n        let authUrl = Config.webAddress +'AuthPage';\n        AuthService.wechatLogin(origUrl, authUrl, {})\n            .then((response) => response.json())\n            .then((responseJson) => {\n                window.open(responseJson.auth_url, \"_self\");\n            })\n            .catch((error) => {\n                alert(error);\n            });\n    }\n\n    componentWillUnmount(){\n        clearInterval(this.state.interval)\n    }\n\n    getLoginStatus= () => {\n        if(this.state.subscribeLoginLogId) {\n            AuthService.checkLoginStatus(this.state.subscribeLoginLogId || null)\n                .then(response => response.text())\n                .then(resp => {\n                    var res = JSON.parse(resp)\n                    if (res.log && res.log.tmp_token && res.log.tmp_token.trim() !== '') {\n                        this.setState({\n                            loading: true\n                        })\n                        this.loginWithTempCode(res.log.tmp_token.trim())\n                    }\n                })\n        }\n    }\n\n    loginWithTempCode = (tmpToken) => {\n        AuthService.loginWithTempCode(tmpToken)\n            .then(response => response.text())\n            .then(resp => {\n                var res = JSON.parse(resp)\n                if (res.return_code){\n                    localStorage.setItem('userToken', res.return_code);\n                    localStorage.setItem('isLogIn', true);\n                }\n                let params ={};\n                AuthService.getMe(params)\n                    .then((response) => response.json())\n                    .then((responseJson) => {\n                        localStorage.setItem('userObject', JSON.stringify(responseJson));\n                    })\n                    .then(() => {location.reload();\n                    })\n                    .catch((error) => {\n                        console.error(error);\n                    });\n            })\n    }\n\n    handleLogin =(item) => {\n        if (UtilsService.openedInWeChat()) {\n            this.weChatLogin()\n        } else {\n            let getLoginStatus = this.getLoginStatus\n            var params = {\n                companyId: item && item.company && item.company.id,\n                itemId: item && item.id\n            }\n            AuthService.getLoginSubscribeQrCode(params)\n                .then(response => response.text())\n                .then(resp => {\n                    var res = JSON.parse(resp)\n                    let interval = setInterval(getLoginStatus,1000);\n                    this.setState({\n                        qrUrl: res.qrcode,\n                        subscribeLoginLogId: res.subscribeLoginLogId,\n                        showModal: true,\n                        interval: interval\n                    })\n                })\n        }\n    }\n\n    render() {\n\n        const item = this.state.item ? this.state.item : undefined;\n        const isLogin = this.state.isLogin ? this.state.isLogin : false;\n        const isAdmin = this.state.isAdmin ? this.state.isAdmin : false;\n        const customStyles = {\n            content : {\n                top                   : '50%',\n                left                  : '50%',\n                right                 : 'auto',\n                bottom                : 'auto',\n                marginRight           : '-50%',\n                transform             : 'translate(-50%, -50%)'\n            }\n        };\n        if (item && item.is_draft === 0 || (item.is_draft === 1 && isLogin)) {\n            if (item.is_draft === 1 && !isAdmin) {\n                return (\n                    <div key={item.id}>\n                        No Access to view this article.\n                    </div>\n                )\n            } else {\n                if (isLogin){\n                    return (\n                        <div key={item.id}>\n                            <EditButton item={item} show={isAdmin} />\n                            <ArticleContent articleDetail={item} isAdmin={isAdmin} isLogin={isLogin}/>\n                            <EditButton item={item} show={isAdmin} />\n                            <ArticleComments item={item} isLogin={isLogin} isAdmin={isAdmin}/>\n                        </div>\n                    )\n                }\n                else\n                {\n                    return (\n                        <div key={item.id}>\n                            <div className=\"row\">\n                            <EditButton item={item} show={isAdmin} />\n                            <ArticleContent articleDetail={item} isAdmin={isAdmin} isLogin={isLogin}/>\n                            <EditButton item={item} show={isAdmin} />\n                            <div key={item.id} style={styles.editButton}>\n                                <Button\n                                    onClick={()=> this.handleLogin(item)}\n                                    plain\n                                >\n                                    {Lang.translate('LOGIN')}\n                                </Button>\n                            </div>\n                            </div>\n                            <ArticleComments item={item} isLogin={isLogin} isAdmin={isAdmin}/>\n                            <Modal\n                                isOpen={this.state.showModal}\n                                // onAfterOpen={() => {this.getQrCode(item)}}\n                                onRequestClose={()=>{this.setState({showModal: false})}}\n                                style={customStyles}\n                                contentLabel=\"Example Modal\"\n                            >\n                                <div style={styles.qrTitle}>扫码关注该公司</div>\n                                <div style={styles.qrTitle}><small>将更及时的收到推送</small></div>\n                                <img style={styles.qrcode} src={this.state.qrUrl}/>\n                            </Modal>\n                            <Toast icon=\"success-no-circle\" show={this.state.success}>Success</Toast>\n                            <Toast icon=\"loading\" show={this.state.loading}>Loading...</Toast>\n                        </div>\n                    )\n                }\n\n            }\n        }\n        else return null;\n    }\n}\n\nexport default ArticleDetailComponent;\n"]},"metadata":{},"sourceType":"module"}